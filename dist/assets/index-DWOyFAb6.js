(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const e of c.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&r(e)}).observe(document,{childList:!0,subtree:!0});function i(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=i(s);fetch(s.href,c)}})();const ls={setItem(u,a){return typeof chrome.storage<"u"?chrome.storage.local.set({key:a}):new Promise(i=>i(localStorage.setItem(u,a)))},getItem(u){return typeof chrome.storage<"u"?chrome.storage.local.get([u]):new Promise(a=>a(localStorage.getItem(u)))}};function mu(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}const gu="jssip",yu="JsSIP",Tu="the Javascript SIP library",Su="3.10.1",Eu="https://jssip.net",Cu=["José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)","Iñaki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],bu="lib/JsSIP.d.ts",Au="lib-es5/JsSIP.js",Ru=["sip","websocket","webrtc","node","browser","library"],wu="MIT",Iu={type:"git",url:"https://github.com/versatica/JsSIP.git"},Ou={url:"https://github.com/versatica/JsSIP/issues"},Nu={"@types/events":"^3.0.0","@types/debug":"^4.1.7",debug:"^4.3.1",events:"^3.3.0","sdp-transform":"^2.14.1"},ku={"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},Du={lint:"node npm-scripts.js lint",test:"node npm-scripts.js test",prepublish:"node npm-scripts.js prepublish",release:"node npm-scripts.js release"},fa={name:gu,title:yu,description:Tu,version:Su,homepage:Eu,contributors:Cu,types:bu,main:Au,keywords:Ru,license:wu,repository:Iu,bugs:Ou,dependencies:Nu,devDependencies:ku,scripts:Du};var ni=fa,he={USER_AGENT:"".concat(ni.title," ").concat(ni.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2};function Rn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Rn=function(i){return typeof i}:Rn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Rn(u)}function zn(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Yn(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&$t(u,a)}function Jn(u){var a=ca();return function(){var r=qt(u),s;if(a){var c=qt(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return xu(this,s)}}function xu(u,a){return a&&(Rn(a)==="object"||typeof a=="function")?a:Pu(u)}function Pu(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function St(u){var a=typeof Map=="function"?new Map:void 0;return St=function(r){if(r===null||!Uu(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(r))return a.get(r);a.set(r,s)}function s(){return wn(r,arguments,qt(this).constructor)}return s.prototype=Object.create(r.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),$t(s,r)},St(u)}function wn(u,a,i){return ca()?wn=Reflect.construct:wn=function(s,c,e){var d=[null];d.push.apply(d,c);var m=Function.bind.apply(s,d),f=new m;return e&&$t(f,e.prototype),f},wn.apply(null,arguments)}function ca(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Uu(u){return Function.toString.call(u).indexOf("[native code]")!==-1}function $t(u,a){return $t=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},$t(u,a)}function qt(u){return qt=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},qt(u)}var Mu=function(u){Yn(i,u);var a=Jn(i);function i(r,s){var c;return zn(this,i),c=a.call(this),c.code=1,c.name="CONFIGURATION_ERROR",c.parameter=r,c.value=s,c.message=c.value?"Invalid value ".concat(JSON.stringify(c.value),' for parameter "').concat(c.parameter,'"'):"Missing parameter: ".concat(c.parameter),c}return i}(St(Error)),Hu=function(u){Yn(i,u);var a=Jn(i);function i(r){var s;return zn(this,i),s=a.call(this),s.code=2,s.name="INVALID_STATE_ERROR",s.status=r,s.message="Invalid status: ".concat(r),s}return i}(St(Error)),Lu=function(u){Yn(i,u);var a=Jn(i);function i(r){var s;return zn(this,i),s=a.call(this),s.code=3,s.name="NOT_SUPPORTED_ERROR",s.message=r,s}return i}(St(Error)),Fu=function(u){Yn(i,u);var a=Jn(i);function i(r){var s;return zn(this,i),s=a.call(this),s.code=4,s.name="NOT_READY_ERROR",s.message=r,s}return i}(St(Error)),Qe={ConfigurationError:Mu,InvalidStateError:Hu,NotSupportedError:Lu,NotReadyError:Fu},oe={},Cr,ri;function is(){if(ri)return Cr;ri=1;function u(c,e){if(!(c instanceof e))throw new TypeError("Cannot call a class as a function")}function a(c,e){for(var d=0;d<e.length;d++){var m=e[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,m.key,m)}}function i(c,e,d){return e&&a(c.prototype,e),d&&a(c,d),c}var r=Ze(),s=Pe();return Cr=function(){i(c,null,[{key:"parse",value:function(d){if(d=s.parse(d,"Name_Addr_Header"),d!==-1)return d}}]);function c(e,d,m){if(u(this,c),!e||!(e instanceof r))throw new TypeError('missing or invalid "uri" parameter');this._uri=e,this._parameters={},this.display_name=d;for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&this.setParam(f,m[f])}return i(c,[{key:"setParam",value:function(d,m){d&&(this._parameters[d.toLowerCase()]=typeof m>"u"||m===null?null:m.toString())}},{key:"getParam",value:function(d){if(d)return this._parameters[d.toLowerCase()]}},{key:"hasParam",value:function(d){if(d)return this._parameters.hasOwnProperty(d.toLowerCase())&&!0||!1}},{key:"deleteParam",value:function(d){if(d=d.toLowerCase(),this._parameters.hasOwnProperty(d)){var m=this._parameters[d];return delete this._parameters[d],m}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new c(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"_quote",value:function(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"toString",value:function(){var d=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";d+="<".concat(this._uri.toString(),">");for(var m in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,m)&&(d+=";".concat(m),this._parameters[m]!==null&&(d+="=".concat(this._parameters[m])));return d}},{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(d){this._display_name=d===0?"0":d}}]),c}(),Cr}var br,si;function Pe(){return si||(si=1,br=function(){function u(i){return'"'+i.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var a={parse:function(r,s){var c={CRLF:p,DIGIT:v,ALPHA:g,HEXDIG:S,WSP:E,OCTET:N,DQUOTE:L,SP:U,HTAB:q,alphanum:G,reserved:z,unreserved:Y,mark:ue,escaped:Z,LWS:D,SWS:O,HCOLON:Ie,TEXT_UTF8_TRIM:je,TEXT_UTF8char:be,UTF8_NONASCII:Q,UTF8_CONT:k,LHEX:x,token:A,token_nodot:P,separators:_t,word:Oe,STAR:tt,SLASH:Me,EQUAL:X,LPAREN:nt,RPAREN:rt,RAQUOT:Be,LAQUOT:Ge,COMMA:ee,SEMI:K,COLON:st,LDQUOT:We,RDQUOT:Ve,comment:Ke,ctext:ze,quoted_string:pt,quoted_string_clean:W,qdtext:B,quoted_pair:V,SIP_URI_noparams:J,SIP_URI:ae,uri_scheme:de,uri_scheme_sips:le,uri_scheme_sip:lt,userinfo:Se,user:vs,user_unreserved:Zn,password:ms,hostport:Qt,host:Et,hostname:er,domainlabel:tr,toplabel:gs,IPv6reference:nr,IPv6address:rr,h16:F,ls32:Ee,IPv4address:Ct,dec_octet:bt,port:ys,uri_parameters:Ts,uri_parameter:sr,transport_param:Ss,user_param:Es,method_param:Cs,ttl_param:bs,maddr_param:As,lr_param:Rs,other_param:ws,pname:Is,pvalue:Os,paramchar:At,param_unreserved:Ns,headers:ks,header:Zt,hname:Ds,hvalue:xs,hnv_unreserved:Rt,Request_Response:xa,Request_Line:Ps,Request_URI:Us,absoluteURI:lr,hier_part:Ms,net_path:Hs,abs_path:en,opaque_part:Ls,uric:wt,uric_no_slash:Fs,path_segments:$s,segment:tn,param:ir,pchar:It,scheme:qs,authority:js,srvr:Bs,reg_name:Gs,query:Ws,SIP_Version:ar,INVITEm:Vs,ACKm:Ks,OPTIONSm:zs,BYEm:Ys,CANCELm:Js,REGISTERm:Xs,SUBSCRIBEm:Qs,NOTIFYm:Zs,REFERm:el,Method:nn,Status_Line:tl,Status_Code:nl,extension_code:rl,Reason_Phrase:sl,Allow_Events:Pa,Call_ID:Ua,Contact:Ma,contact_param:rn,name_addr:it,display_name:sn,contact_params:ur,c_p_q:ll,c_p_expires:il,delta_seconds:at,qvalue:al,generic_param:fe,gen_value:ul,Content_Disposition:Ha,disp_type:ol,disp_param:or,handling_param:fl,Content_Encoding:La,Content_Length:Fa,Content_Type:$a,media_type:cl,m_type:hl,discrete_type:dl,composite_type:_l,extension_token:ln,x_token:pl,m_subtype:vl,m_parameter:fr,m_value:ml,CSeq:qa,CSeq_value:gl,Expires:ja,Event:Ba,event_type:Ot,From:Ga,from_param:cr,tag_param:hr,Max_Forwards:Wa,Min_Expires:Va,Name_Addr_Header:Ka,Proxy_Authenticate:za,challenge:dr,other_challenge:yl,auth_param:Nt,digest_cln:an,realm:Tl,realm_value:Sl,domain:El,URI:un,nonce:Cl,nonce_value:bl,opaque:Al,stale:Rl,algorithm:wl,qop_options:Il,qop_value:on,Proxy_Require:Ya,Record_Route:Ja,rec_route:fn,Reason:Xa,reason_param:_r,reason_cause:Ol,Require:Qa,Route:Za,route_param:cn,Subscription_State:eu,substate_value:Nl,subexp_params:pr,event_reason_value:kl,Subject:tu,Supported:nu,To:ru,to_param:vr,Via:su,via_param:hn,via_params:mr,via_ttl:Dl,via_maddr:xl,via_received:Pl,via_branch:Ul,response_port:Ml,rport:Hl,sent_protocol:Ll,protocol_name:Fl,transport:$l,sent_by:ql,via_host:jl,via_port:Bl,ttl:gr,WWW_Authenticate:lu,Session_Expires:iu,s_e_expires:Gl,s_e_params:yr,s_e_refresher:Wl,extension_header:au,header_value:Vl,message_body:uu,uuid_URI:ou,uuid:Kl,hex4:He,hex8:zl,hex12:Yl,Refer_To:fu,Replaces:cu,call_id:Jl,replaces_param:Tr,to_tag:Xl,from_tag:Ql,early_flag:Zl};if(s!==void 0){if(c[s]===void 0)throw new Error("Invalid rule name: "+u(s)+".")}else s="CRLF";var e=0,d=0,m=[];function f(t){e<d||(e>d&&(d=e,m=[]),m.push(t))}function p(){var t;return r.substr(e,2)===`\r
`?(t=`\r
`,e+=2):(t=null,f('"\\r\\n"')),t}function v(){var t;return/^[0-9]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[0-9]")),t}function g(){var t;return/^[a-zA-Z]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[a-zA-Z]")),t}function S(){var t;return/^[0-9a-fA-F]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[0-9a-fA-F]")),t}function E(){var t;return t=U(),t===null&&(t=q()),t}function N(){var t;return/^[\0-\xFF]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[\\0-\\xFF]")),t}function L(){var t;return/^["]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f('["]')),t}function U(){var t;return r.charCodeAt(e)===32?(t=" ",e++):(t=null,f('" "')),t}function q(){var t;return r.charCodeAt(e)===9?(t="	",e++):(t=null,f('"\\t"')),t}function G(){var t;return/^[a-zA-Z0-9]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[a-zA-Z0-9]")),t}function z(){var t;return r.charCodeAt(e)===59?(t=";",e++):(t=null,f('";"')),t===null&&(r.charCodeAt(e)===47?(t="/",e++):(t=null,f('"/"')),t===null&&(r.charCodeAt(e)===63?(t="?",e++):(t=null,f('"?"')),t===null&&(r.charCodeAt(e)===58?(t=":",e++):(t=null,f('":"')),t===null&&(r.charCodeAt(e)===64?(t="@",e++):(t=null,f('"@"')),t===null&&(r.charCodeAt(e)===38?(t="&",e++):(t=null,f('"&"')),t===null&&(r.charCodeAt(e)===61?(t="=",e++):(t=null,f('"="')),t===null&&(r.charCodeAt(e)===43?(t="+",e++):(t=null,f('"+"')),t===null&&(r.charCodeAt(e)===36?(t="$",e++):(t=null,f('"$"')),t===null&&(r.charCodeAt(e)===44?(t=",",e++):(t=null,f('","'))))))))))),t}function Y(){var t;return t=G(),t===null&&(t=ue()),t}function ue(){var t;return r.charCodeAt(e)===45?(t="-",e++):(t=null,f('"-"')),t===null&&(r.charCodeAt(e)===95?(t="_",e++):(t=null,f('"_"')),t===null&&(r.charCodeAt(e)===46?(t=".",e++):(t=null,f('"."')),t===null&&(r.charCodeAt(e)===33?(t="!",e++):(t=null,f('"!"')),t===null&&(r.charCodeAt(e)===126?(t="~",e++):(t=null,f('"~"')),t===null&&(r.charCodeAt(e)===42?(t="*",e++):(t=null,f('"*"')),t===null&&(r.charCodeAt(e)===39?(t="'",e++):(t=null,f(`"'"`)),t===null&&(r.charCodeAt(e)===40?(t="(",e++):(t=null,f('"("')),t===null&&(r.charCodeAt(e)===41?(t=")",e++):(t=null,f('")"')))))))))),t}function Z(){var t,n,l,o,h;return o=e,h=e,r.charCodeAt(e)===37?(t="%",e++):(t=null,f('"%"')),t!==null?(n=S(),n!==null?(l=S(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){return y.join("")}(o,t)),t===null&&(e=o),t}function D(){var t,n,l,o,h,_;for(o=e,h=e,_=e,t=[],n=E();n!==null;)t.push(n),n=E();if(t!==null?(n=p(),n!==null?t=[t,n]:(t=null,e=_)):(t=null,e=_),t=t!==null?t:"",t!==null){if(l=E(),l!==null)for(n=[];l!==null;)n.push(l),l=E();else n=null;n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t!==null&&(t=function(y){return" "}()),t===null&&(e=o),t}function O(){var t;return t=D(),t=t!==null?t:"",t}function Ie(){var t,n,l,o,h;for(o=e,h=e,t=[],n=U(),n===null&&(n=q());n!==null;)t.push(n),n=U(),n===null&&(n=q());return t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return":"}()),t===null&&(e=o),t}function je(){var t,n,l,o,h,_,y;if(h=e,_=e,n=be(),n!==null)for(t=[];n!==null;)t.push(n),n=be();else t=null;if(t!==null){for(n=[],y=e,l=[],o=D();o!==null;)l.push(o),o=D();for(l!==null?(o=be(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;){for(n.push(l),y=e,l=[],o=D();o!==null;)l.push(o),o=D();l!==null?(o=be(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y)}n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){return r.substring(e,C)}(h)),t===null&&(e=h),t}function be(){var t;return/^[!-~]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[!-~]")),t===null&&(t=Q()),t}function Q(){var t;return/^[\x80-\uFFFF]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[\\x80-\\uFFFF]")),t}function k(){var t;return/^[\x80-\xBF]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[\\x80-\\xBF]")),t}function x(){var t;return t=v(),t===null&&(/^[a-f]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[a-f]"))),t}function A(){var t,n,l;if(l=e,n=G(),n===null&&(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n===null&&(r.charCodeAt(e)===46?(n=".",e++):(n=null,f('"."')),n===null&&(r.charCodeAt(e)===33?(n="!",e++):(n=null,f('"!"')),n===null&&(r.charCodeAt(e)===37?(n="%",e++):(n=null,f('"%"')),n===null&&(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n===null&&(r.charCodeAt(e)===95?(n="_",e++):(n=null,f('"_"')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===96?(n="`",e++):(n=null,f('"`"')),n===null&&(r.charCodeAt(e)===39?(n="'",e++):(n=null,f(`"'"`)),n===null&&(r.charCodeAt(e)===126?(n="~",e++):(n=null,f('"~"')))))))))))),n!==null)for(t=[];n!==null;)t.push(n),n=G(),n===null&&(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n===null&&(r.charCodeAt(e)===46?(n=".",e++):(n=null,f('"."')),n===null&&(r.charCodeAt(e)===33?(n="!",e++):(n=null,f('"!"')),n===null&&(r.charCodeAt(e)===37?(n="%",e++):(n=null,f('"%"')),n===null&&(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n===null&&(r.charCodeAt(e)===95?(n="_",e++):(n=null,f('"_"')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===96?(n="`",e++):(n=null,f('"`"')),n===null&&(r.charCodeAt(e)===39?(n="'",e++):(n=null,f(`"'"`)),n===null&&(r.charCodeAt(e)===126?(n="~",e++):(n=null,f('"~"'))))))))))));else t=null;return t!==null&&(t=function(o){return r.substring(e,o)}(l)),t===null&&(e=l),t}function P(){var t,n,l;if(l=e,n=G(),n===null&&(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n===null&&(r.charCodeAt(e)===33?(n="!",e++):(n=null,f('"!"')),n===null&&(r.charCodeAt(e)===37?(n="%",e++):(n=null,f('"%"')),n===null&&(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n===null&&(r.charCodeAt(e)===95?(n="_",e++):(n=null,f('"_"')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===96?(n="`",e++):(n=null,f('"`"')),n===null&&(r.charCodeAt(e)===39?(n="'",e++):(n=null,f(`"'"`)),n===null&&(r.charCodeAt(e)===126?(n="~",e++):(n=null,f('"~"'))))))))))),n!==null)for(t=[];n!==null;)t.push(n),n=G(),n===null&&(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n===null&&(r.charCodeAt(e)===33?(n="!",e++):(n=null,f('"!"')),n===null&&(r.charCodeAt(e)===37?(n="%",e++):(n=null,f('"%"')),n===null&&(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n===null&&(r.charCodeAt(e)===95?(n="_",e++):(n=null,f('"_"')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===96?(n="`",e++):(n=null,f('"`"')),n===null&&(r.charCodeAt(e)===39?(n="'",e++):(n=null,f(`"'"`)),n===null&&(r.charCodeAt(e)===126?(n="~",e++):(n=null,f('"~"')))))))))));else t=null;return t!==null&&(t=function(o){return r.substring(e,o)}(l)),t===null&&(e=l),t}function _t(){var t;return r.charCodeAt(e)===40?(t="(",e++):(t=null,f('"("')),t===null&&(r.charCodeAt(e)===41?(t=")",e++):(t=null,f('")"')),t===null&&(r.charCodeAt(e)===60?(t="<",e++):(t=null,f('"<"')),t===null&&(r.charCodeAt(e)===62?(t=">",e++):(t=null,f('">"')),t===null&&(r.charCodeAt(e)===64?(t="@",e++):(t=null,f('"@"')),t===null&&(r.charCodeAt(e)===44?(t=",",e++):(t=null,f('","')),t===null&&(r.charCodeAt(e)===59?(t=";",e++):(t=null,f('";"')),t===null&&(r.charCodeAt(e)===58?(t=":",e++):(t=null,f('":"')),t===null&&(r.charCodeAt(e)===92?(t="\\",e++):(t=null,f('"\\\\"')),t===null&&(t=L(),t===null&&(r.charCodeAt(e)===47?(t="/",e++):(t=null,f('"/"')),t===null&&(r.charCodeAt(e)===91?(t="[",e++):(t=null,f('"["')),t===null&&(r.charCodeAt(e)===93?(t="]",e++):(t=null,f('"]"')),t===null&&(r.charCodeAt(e)===63?(t="?",e++):(t=null,f('"?"')),t===null&&(r.charCodeAt(e)===61?(t="=",e++):(t=null,f('"="')),t===null&&(r.charCodeAt(e)===123?(t="{",e++):(t=null,f('"{"')),t===null&&(r.charCodeAt(e)===125?(t="}",e++):(t=null,f('"}"')),t===null&&(t=U(),t===null&&(t=q())))))))))))))))))),t}function Oe(){var t,n,l;if(l=e,n=G(),n===null&&(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n===null&&(r.charCodeAt(e)===46?(n=".",e++):(n=null,f('"."')),n===null&&(r.charCodeAt(e)===33?(n="!",e++):(n=null,f('"!"')),n===null&&(r.charCodeAt(e)===37?(n="%",e++):(n=null,f('"%"')),n===null&&(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n===null&&(r.charCodeAt(e)===95?(n="_",e++):(n=null,f('"_"')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===96?(n="`",e++):(n=null,f('"`"')),n===null&&(r.charCodeAt(e)===39?(n="'",e++):(n=null,f(`"'"`)),n===null&&(r.charCodeAt(e)===126?(n="~",e++):(n=null,f('"~"')),n===null&&(r.charCodeAt(e)===40?(n="(",e++):(n=null,f('"("')),n===null&&(r.charCodeAt(e)===41?(n=")",e++):(n=null,f('")"')),n===null&&(r.charCodeAt(e)===60?(n="<",e++):(n=null,f('"<"')),n===null&&(r.charCodeAt(e)===62?(n=">",e++):(n=null,f('">"')),n===null&&(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n===null&&(r.charCodeAt(e)===92?(n="\\",e++):(n=null,f('"\\\\"')),n===null&&(n=L(),n===null&&(r.charCodeAt(e)===47?(n="/",e++):(n=null,f('"/"')),n===null&&(r.charCodeAt(e)===91?(n="[",e++):(n=null,f('"["')),n===null&&(r.charCodeAt(e)===93?(n="]",e++):(n=null,f('"]"')),n===null&&(r.charCodeAt(e)===63?(n="?",e++):(n=null,f('"?"')),n===null&&(r.charCodeAt(e)===123?(n="{",e++):(n=null,f('"{"')),n===null&&(r.charCodeAt(e)===125?(n="}",e++):(n=null,f('"}"'))))))))))))))))))))))))),n!==null)for(t=[];n!==null;)t.push(n),n=G(),n===null&&(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n===null&&(r.charCodeAt(e)===46?(n=".",e++):(n=null,f('"."')),n===null&&(r.charCodeAt(e)===33?(n="!",e++):(n=null,f('"!"')),n===null&&(r.charCodeAt(e)===37?(n="%",e++):(n=null,f('"%"')),n===null&&(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n===null&&(r.charCodeAt(e)===95?(n="_",e++):(n=null,f('"_"')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===96?(n="`",e++):(n=null,f('"`"')),n===null&&(r.charCodeAt(e)===39?(n="'",e++):(n=null,f(`"'"`)),n===null&&(r.charCodeAt(e)===126?(n="~",e++):(n=null,f('"~"')),n===null&&(r.charCodeAt(e)===40?(n="(",e++):(n=null,f('"("')),n===null&&(r.charCodeAt(e)===41?(n=")",e++):(n=null,f('")"')),n===null&&(r.charCodeAt(e)===60?(n="<",e++):(n=null,f('"<"')),n===null&&(r.charCodeAt(e)===62?(n=">",e++):(n=null,f('">"')),n===null&&(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n===null&&(r.charCodeAt(e)===92?(n="\\",e++):(n=null,f('"\\\\"')),n===null&&(n=L(),n===null&&(r.charCodeAt(e)===47?(n="/",e++):(n=null,f('"/"')),n===null&&(r.charCodeAt(e)===91?(n="[",e++):(n=null,f('"["')),n===null&&(r.charCodeAt(e)===93?(n="]",e++):(n=null,f('"]"')),n===null&&(r.charCodeAt(e)===63?(n="?",e++):(n=null,f('"?"')),n===null&&(r.charCodeAt(e)===123?(n="{",e++):(n=null,f('"{"')),n===null&&(r.charCodeAt(e)===125?(n="}",e++):(n=null,f('"}"')))))))))))))))))))))))));else t=null;return t!==null&&(t=function(o){return r.substring(e,o)}(l)),t===null&&(e=l),t}function tt(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===42?(n="*",e++):(n=null,f('"*"')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return"*"}()),t===null&&(e=o),t}function Me(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===47?(n="/",e++):(n=null,f('"/"')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return"/"}()),t===null&&(e=o),t}function X(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return"="}()),t===null&&(e=o),t}function nt(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===40?(n="(",e++):(n=null,f('"("')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return"("}()),t===null&&(e=o),t}function rt(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===41?(n=")",e++):(n=null,f('")"')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return")"}()),t===null&&(e=o),t}function Be(){var t,n,l,o;return l=e,o=e,r.charCodeAt(e)===62?(t=">",e++):(t=null,f('">"')),t!==null?(n=O(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h){return">"}()),t===null&&(e=l),t}function Ge(){var t,n,l,o;return l=e,o=e,t=O(),t!==null?(r.charCodeAt(e)===60?(n="<",e++):(n=null,f('"<"')),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h){return"<"}()),t===null&&(e=l),t}function ee(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===44?(n=",",e++):(n=null,f('","')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return","}()),t===null&&(e=o),t}function K(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===59?(n=";",e++):(n=null,f('";"')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return";"}()),t===null&&(e=o),t}function st(){var t,n,l,o,h;return o=e,h=e,t=O(),t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=O(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return":"}()),t===null&&(e=o),t}function We(){var t,n,l,o;return l=e,o=e,t=O(),t!==null?(n=L(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h){return'"'}()),t===null&&(e=l),t}function Ve(){var t,n,l,o;return l=e,o=e,t=L(),t!==null?(n=O(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h){return'"'}()),t===null&&(e=l),t}function Ke(){var t,n,l,o;if(o=e,t=nt(),t!==null){for(n=[],l=ze(),l===null&&(l=V(),l===null&&(l=Ke()));l!==null;)n.push(l),l=ze(),l===null&&(l=V(),l===null&&(l=Ke()));n!==null?(l=rt(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)}else t=null,e=o;return t}function ze(){var t;return/^[!-']/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[!-']")),t===null&&(/^[*-[]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[*-[]")),t===null&&(/^[\]-~]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[\\]-~]")),t===null&&(t=Q(),t===null&&(t=D())))),t}function pt(){var t,n,l,o,h,_;if(h=e,_=e,t=O(),t!==null)if(n=L(),n!==null){for(l=[],o=B(),o===null&&(o=V());o!==null;)l.push(o),o=B(),o===null&&(o=V());l!==null?(o=L(),o!==null?t=[t,n,l,o]:(t=null,e=_)):(t=null,e=_)}else t=null,e=_;else t=null,e=_;return t!==null&&(t=function(y){return r.substring(e,y)}(h)),t===null&&(e=h),t}function W(){var t,n,l,o,h,_;if(h=e,_=e,t=O(),t!==null)if(n=L(),n!==null){for(l=[],o=B(),o===null&&(o=V());o!==null;)l.push(o),o=B(),o===null&&(o=V());l!==null?(o=L(),o!==null?t=[t,n,l,o]:(t=null,e=_)):(t=null,e=_)}else t=null,e=_;else t=null,e=_;return t!==null&&(t=function(y){var C=r.substring(e,y).trim();return C.substring(1,C.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1")}(h)),t===null&&(e=h),t}function B(){var t;return t=D(),t===null&&(r.charCodeAt(e)===33?(t="!",e++):(t=null,f('"!"')),t===null&&(/^[#-[]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[#-[]")),t===null&&(/^[\]-~]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[\\]-~]")),t===null&&(t=Q())))),t}function V(){var t,n,l;return l=e,r.charCodeAt(e)===92?(t="\\",e++):(t=null,f('"\\\\"')),t!==null?(/^[\0-\t]/.test(r.charAt(e))?(n=r.charAt(e),e++):(n=null,f("[\\0-\\t]")),n===null&&(/^[\x0B-\f]/.test(r.charAt(e))?(n=r.charAt(e),e++):(n=null,f("[\\x0B-\\f]")),n===null&&(/^[\x0E-]/.test(r.charAt(e))?(n=r.charAt(e),e++):(n=null,f("[\\x0E-]")))),n!==null?t=[t,n]:(t=null,e=l)):(t=null,e=l),t}function J(){var t,n,l,o,h,_;return h=e,_=e,t=de(),t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=Se(),l=l!==null?l:"",l!==null?(o=Qt(),o!==null?t=[t,n,l,o]:(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_),t!==null&&(t=function(y){try{T.uri=new ei(T.scheme,T.user,T.host,T.port),delete T.scheme,delete T.user,delete T.host,delete T.host_type,delete T.port}catch{T=-1}}()),t===null&&(e=h),t}function ae(){var t,n,l,o,h,_,y,C;return y=e,C=e,t=de(),t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=Se(),l=l!==null?l:"",l!==null?(o=Qt(),o!==null?(h=Ts(),h!==null?(_=ks(),_=_!==null?_:"",_!==null?t=[t,n,l,o,h,_]:(t=null,e=C)):(t=null,e=C)):(t=null,e=C)):(t=null,e=C)):(t=null,e=C)):(t=null,e=C),t!==null&&(t=function(w){try{T.uri=new ei(T.scheme,T.user,T.host,T.port,T.uri_params,T.uri_headers),delete T.scheme,delete T.user,delete T.host,delete T.host_type,delete T.port,delete T.uri_params,s==="SIP_URI"&&(T=T.uri)}catch{T=-1}}()),t===null&&(e=y),t}function de(){var t;return t=le(),t===null&&(t=lt()),t}function le(){var t,n;return n=e,r.substr(e,4).toLowerCase()==="sips"?(t=r.substr(e,4),e+=4):(t=null,f('"sips"')),t!==null&&(t=function(l,o){T.scheme=o.toLowerCase()}(n,t)),t===null&&(e=n),t}function lt(){var t,n;return n=e,r.substr(e,3).toLowerCase()==="sip"?(t=r.substr(e,3),e+=3):(t=null,f('"sip"')),t!==null&&(t=function(l,o){T.scheme=o.toLowerCase()}(n,t)),t===null&&(e=n),t}function Se(){var t,n,l,o,h,_;return o=e,h=e,t=vs(),t!==null?(_=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=ms(),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_),n=n!==null?n:"",n!==null?(r.charCodeAt(e)===64?(l="@",e++):(l=null,f('"@"')),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y){T.user=decodeURIComponent(r.substring(e-1,y))}(o)),t===null&&(e=o),t}function vs(){var t,n;if(n=Y(),n===null&&(n=Z(),n===null&&(n=Zn())),n!==null)for(t=[];n!==null;)t.push(n),n=Y(),n===null&&(n=Z(),n===null&&(n=Zn()));else t=null;return t}function Zn(){var t;return r.charCodeAt(e)===38?(t="&",e++):(t=null,f('"&"')),t===null&&(r.charCodeAt(e)===61?(t="=",e++):(t=null,f('"="')),t===null&&(r.charCodeAt(e)===43?(t="+",e++):(t=null,f('"+"')),t===null&&(r.charCodeAt(e)===36?(t="$",e++):(t=null,f('"$"')),t===null&&(r.charCodeAt(e)===44?(t=",",e++):(t=null,f('","')),t===null&&(r.charCodeAt(e)===59?(t=";",e++):(t=null,f('";"')),t===null&&(r.charCodeAt(e)===63?(t="?",e++):(t=null,f('"?"')),t===null&&(r.charCodeAt(e)===47?(t="/",e++):(t=null,f('"/"'))))))))),t}function ms(){var t,n,l;for(l=e,t=[],n=Y(),n===null&&(n=Z(),n===null&&(r.charCodeAt(e)===38?(n="&",e++):(n=null,f('"&"')),n===null&&(r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===36?(n="$",e++):(n=null,f('"$"')),n===null&&(r.charCodeAt(e)===44?(n=",",e++):(n=null,f('","'))))))));n!==null;)t.push(n),n=Y(),n===null&&(n=Z(),n===null&&(r.charCodeAt(e)===38?(n="&",e++):(n=null,f('"&"')),n===null&&(r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')),n===null&&(r.charCodeAt(e)===36?(n="$",e++):(n=null,f('"$"')),n===null&&(r.charCodeAt(e)===44?(n=",",e++):(n=null,f('","'))))))));return t!==null&&(t=function(o){T.password=r.substring(e,o)}(l)),t===null&&(e=l),t}function Qt(){var t,n,l,o,h;return o=e,t=Et(),t!==null?(h=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=ys(),l!==null?n=[n,l]:(n=null,e=h)):(n=null,e=h),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t}function Et(){var t,n;return n=e,t=er(),t===null&&(t=Ct(),t===null&&(t=nr())),t!==null&&(t=function(l){return T.host=r.substring(e,l).toLowerCase(),T.host}(n)),t===null&&(e=n),t}function er(){var t,n,l,o,h,_;for(o=e,h=e,t=[],_=e,n=tr(),n!==null?(r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."')),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_);n!==null;)t.push(n),_=e,n=tr(),n!==null?(r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."')),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_);return t!==null?(n=gs(),n!==null?(r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."')),l=l!==null?l:"",l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y){return T.host_type="domain",r.substring(e,y)}(o)),t===null&&(e=o),t}function tr(){var t,n,l,o;if(o=e,t=G(),t!==null){for(n=[],l=G(),l===null&&(r.charCodeAt(e)===45?(l="-",e++):(l=null,f('"-"')),l===null&&(r.charCodeAt(e)===95?(l="_",e++):(l=null,f('"_"'))));l!==null;)n.push(l),l=G(),l===null&&(r.charCodeAt(e)===45?(l="-",e++):(l=null,f('"-"')),l===null&&(r.charCodeAt(e)===95?(l="_",e++):(l=null,f('"_"'))));n!==null?t=[t,n]:(t=null,e=o)}else t=null,e=o;return t}function gs(){var t,n,l,o;if(o=e,t=g(),t!==null){for(n=[],l=G(),l===null&&(r.charCodeAt(e)===45?(l="-",e++):(l=null,f('"-"')),l===null&&(r.charCodeAt(e)===95?(l="_",e++):(l=null,f('"_"'))));l!==null;)n.push(l),l=G(),l===null&&(r.charCodeAt(e)===45?(l="-",e++):(l=null,f('"-"')),l===null&&(r.charCodeAt(e)===95?(l="_",e++):(l=null,f('"_"'))));n!==null?t=[t,n]:(t=null,e=o)}else t=null,e=o;return t}function nr(){var t,n,l,o,h;return o=e,h=e,r.charCodeAt(e)===91?(t="[",e++):(t=null,f('"["')),t!==null?(n=rr(),n!==null?(r.charCodeAt(e)===93?(l="]",e++):(l=null,f('"]"')),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_){return T.host_type="IPv6",r.substring(e,_)}(o)),t===null&&(e=o),t}function rr(){var t,n,l,o,h,_,y,C,w,j,re,Ne,dn,Er,b,$;return Er=e,b=e,t=F(),t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?(r.charCodeAt(e)===58?(o=":",e++):(o=null,f('":"')),o!==null?(h=F(),h!==null?(r.charCodeAt(e)===58?(_=":",e++):(_=null,f('":"')),_!==null?(y=F(),y!==null?(r.charCodeAt(e)===58?(C=":",e++):(C=null,f('":"')),C!==null?(w=F(),w!==null?(r.charCodeAt(e)===58?(j=":",e++):(j=null,f('":"')),j!==null?(re=F(),re!==null?(r.charCodeAt(e)===58?(Ne=":",e++):(Ne=null,f('":"')),Ne!==null?(dn=Ee(),dn!==null?t=[t,n,l,o,h,_,y,C,w,j,re,Ne,dn]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=F(),n!==null?(r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?(r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?(r.charCodeAt(e)===58?(y=":",e++):(y=null,f('":"')),y!==null?(C=F(),C!==null?(r.charCodeAt(e)===58?(w=":",e++):(w=null,f('":"')),w!==null?(j=F(),j!==null?(r.charCodeAt(e)===58?(re=":",e++):(re=null,f('":"')),re!==null?(Ne=Ee(),Ne!==null?t=[t,n,l,o,h,_,y,C,w,j,re,Ne]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=F(),n!==null?(r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?(r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?(r.charCodeAt(e)===58?(y=":",e++):(y=null,f('":"')),y!==null?(C=F(),C!==null?(r.charCodeAt(e)===58?(w=":",e++):(w=null,f('":"')),w!==null?(j=Ee(),j!==null?t=[t,n,l,o,h,_,y,C,w,j]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=F(),n!==null?(r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?(r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?(r.charCodeAt(e)===58?(y=":",e++):(y=null,f('":"')),y!==null?(C=Ee(),C!==null?t=[t,n,l,o,h,_,y,C]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=F(),n!==null?(r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?(r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=Ee(),_!==null?t=[t,n,l,o,h,_]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=F(),n!==null?(r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=Ee(),o!==null?t=[t,n,l,o]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=Ee(),n!==null?t=[t,n]:(t=null,e=b)):(t=null,e=b),t===null&&(b=e,r.substr(e,2)==="::"?(t="::",e+=2):(t=null,f('"::"')),t!==null?(n=F(),n!==null?t=[t,n]:(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?(r.substr(e,2)==="::"?(n="::",e+=2):(n=null,f('"::"')),n!==null?(l=F(),l!==null?(r.charCodeAt(e)===58?(o=":",e++):(o=null,f('":"')),o!==null?(h=F(),h!==null?(r.charCodeAt(e)===58?(_=":",e++):(_=null,f('":"')),_!==null?(y=F(),y!==null?(r.charCodeAt(e)===58?(C=":",e++):(C=null,f('":"')),C!==null?(w=F(),w!==null?(r.charCodeAt(e)===58?(j=":",e++):(j=null,f('":"')),j!==null?(re=Ee(),re!==null?t=[t,n,l,o,h,_,y,C,w,j,re]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?($=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?n=[n,l]:(n=null,e=$)):(n=null,e=$),n=n!==null?n:"",n!==null?(r.substr(e,2)==="::"?(l="::",e+=2):(l=null,f('"::"')),l!==null?(o=F(),o!==null?(r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?(r.charCodeAt(e)===58?(y=":",e++):(y=null,f('":"')),y!==null?(C=F(),C!==null?(r.charCodeAt(e)===58?(w=":",e++):(w=null,f('":"')),w!==null?(j=Ee(),j!==null?t=[t,n,l,o,h,_,y,C,w,j]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?($=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?n=[n,l]:(n=null,e=$)):(n=null,e=$),n=n!==null?n:"",n!==null?($=e,r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?l=[l,o]:(l=null,e=$)):(l=null,e=$),l=l!==null?l:"",l!==null?(r.substr(e,2)==="::"?(o="::",e+=2):(o=null,f('"::"')),o!==null?(h=F(),h!==null?(r.charCodeAt(e)===58?(_=":",e++):(_=null,f('":"')),_!==null?(y=F(),y!==null?(r.charCodeAt(e)===58?(C=":",e++):(C=null,f('":"')),C!==null?(w=Ee(),w!==null?t=[t,n,l,o,h,_,y,C,w]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?($=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?n=[n,l]:(n=null,e=$)):(n=null,e=$),n=n!==null?n:"",n!==null?($=e,r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?l=[l,o]:(l=null,e=$)):(l=null,e=$),l=l!==null?l:"",l!==null?($=e,r.charCodeAt(e)===58?(o=":",e++):(o=null,f('":"')),o!==null?(h=F(),h!==null?o=[o,h]:(o=null,e=$)):(o=null,e=$),o=o!==null?o:"",o!==null?(r.substr(e,2)==="::"?(h="::",e+=2):(h=null,f('"::"')),h!==null?(_=F(),_!==null?(r.charCodeAt(e)===58?(y=":",e++):(y=null,f('":"')),y!==null?(C=Ee(),C!==null?t=[t,n,l,o,h,_,y,C]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?($=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?n=[n,l]:(n=null,e=$)):(n=null,e=$),n=n!==null?n:"",n!==null?($=e,r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?l=[l,o]:(l=null,e=$)):(l=null,e=$),l=l!==null?l:"",l!==null?($=e,r.charCodeAt(e)===58?(o=":",e++):(o=null,f('":"')),o!==null?(h=F(),h!==null?o=[o,h]:(o=null,e=$)):(o=null,e=$),o=o!==null?o:"",o!==null?($=e,r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?h=[h,_]:(h=null,e=$)):(h=null,e=$),h=h!==null?h:"",h!==null?(r.substr(e,2)==="::"?(_="::",e+=2):(_=null,f('"::"')),_!==null?(y=Ee(),y!==null?t=[t,n,l,o,h,_,y]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?($=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?n=[n,l]:(n=null,e=$)):(n=null,e=$),n=n!==null?n:"",n!==null?($=e,r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?l=[l,o]:(l=null,e=$)):(l=null,e=$),l=l!==null?l:"",l!==null?($=e,r.charCodeAt(e)===58?(o=":",e++):(o=null,f('":"')),o!==null?(h=F(),h!==null?o=[o,h]:(o=null,e=$)):(o=null,e=$),o=o!==null?o:"",o!==null?($=e,r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?h=[h,_]:(h=null,e=$)):(h=null,e=$),h=h!==null?h:"",h!==null?($=e,r.charCodeAt(e)===58?(_=":",e++):(_=null,f('":"')),_!==null?(y=F(),y!==null?_=[_,y]:(_=null,e=$)):(_=null,e=$),_=_!==null?_:"",_!==null?(r.substr(e,2)==="::"?(y="::",e+=2):(y=null,f('"::"')),y!==null?(C=F(),C!==null?t=[t,n,l,o,h,_,y,C]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b),t===null&&(b=e,t=F(),t!==null?($=e,r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?n=[n,l]:(n=null,e=$)):(n=null,e=$),n=n!==null?n:"",n!==null?($=e,r.charCodeAt(e)===58?(l=":",e++):(l=null,f('":"')),l!==null?(o=F(),o!==null?l=[l,o]:(l=null,e=$)):(l=null,e=$),l=l!==null?l:"",l!==null?($=e,r.charCodeAt(e)===58?(o=":",e++):(o=null,f('":"')),o!==null?(h=F(),h!==null?o=[o,h]:(o=null,e=$)):(o=null,e=$),o=o!==null?o:"",o!==null?($=e,r.charCodeAt(e)===58?(h=":",e++):(h=null,f('":"')),h!==null?(_=F(),_!==null?h=[h,_]:(h=null,e=$)):(h=null,e=$),h=h!==null?h:"",h!==null?($=e,r.charCodeAt(e)===58?(_=":",e++):(_=null,f('":"')),_!==null?(y=F(),y!==null?_=[_,y]:(_=null,e=$)):(_=null,e=$),_=_!==null?_:"",_!==null?($=e,r.charCodeAt(e)===58?(y=":",e++):(y=null,f('":"')),y!==null?(C=F(),C!==null?y=[y,C]:(y=null,e=$)):(y=null,e=$),y=y!==null?y:"",y!==null?(r.substr(e,2)==="::"?(C="::",e+=2):(C=null,f('"::"')),C!==null?t=[t,n,l,o,h,_,y,C]:(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b)):(t=null,e=b))))))))))))))),t!==null&&(t=function(vu){return T.host_type="IPv6",r.substring(e,vu)}(Er)),t===null&&(e=Er),t}function F(){var t,n,l,o,h;return h=e,t=S(),t!==null?(n=S(),n=n!==null?n:"",n!==null?(l=S(),l=l!==null?l:"",l!==null?(o=S(),o=o!==null?o:"",o!==null?t=[t,n,l,o]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t}function Ee(){var t,n,l,o;return o=e,t=F(),t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=F(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t===null&&(t=Ct()),t}function Ct(){var t,n,l,o,h,_,y,C,w;return C=e,w=e,t=bt(),t!==null?(r.charCodeAt(e)===46?(n=".",e++):(n=null,f('"."')),n!==null?(l=bt(),l!==null?(r.charCodeAt(e)===46?(o=".",e++):(o=null,f('"."')),o!==null?(h=bt(),h!==null?(r.charCodeAt(e)===46?(_=".",e++):(_=null,f('"."')),_!==null?(y=bt(),y!==null?t=[t,n,l,o,h,_,y]:(t=null,e=w)):(t=null,e=w)):(t=null,e=w)):(t=null,e=w)):(t=null,e=w)):(t=null,e=w)):(t=null,e=w),t!==null&&(t=function(j){return T.host_type="IPv4",r.substring(e,j)}(C)),t===null&&(e=C),t}function bt(){var t,n,l,o;return o=e,r.substr(e,2)==="25"?(t="25",e+=2):(t=null,f('"25"')),t!==null?(/^[0-5]/.test(r.charAt(e))?(n=r.charAt(e),e++):(n=null,f("[0-5]")),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t===null&&(o=e,r.charCodeAt(e)===50?(t="2",e++):(t=null,f('"2"')),t!==null?(/^[0-4]/.test(r.charAt(e))?(n=r.charAt(e),e++):(n=null,f("[0-4]")),n!==null?(l=v(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t===null&&(o=e,r.charCodeAt(e)===49?(t="1",e++):(t=null,f('"1"')),t!==null?(n=v(),n!==null?(l=v(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t===null&&(o=e,/^[1-9]/.test(r.charAt(e))?(t=r.charAt(e),e++):(t=null,f("[1-9]")),t!==null?(n=v(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t===null&&(t=v())))),t}function ys(){var t,n,l,o,h,_,y;return _=e,y=e,t=v(),t=t!==null?t:"",t!==null?(n=v(),n=n!==null?n:"",n!==null?(l=v(),l=l!==null?l:"",l!==null?(o=v(),o=o!==null?o:"",o!==null?(h=v(),h=h!==null?h:"",h!==null?t=[t,n,l,o,h]:(t=null,e=y)):(t=null,e=y)):(t=null,e=y)):(t=null,e=y)):(t=null,e=y),t!==null&&(t=function(C,w){return w=parseInt(w.join("")),T.port=w,w}(_,t)),t===null&&(e=_),t}function Ts(){var t,n,l,o;for(t=[],o=e,r.charCodeAt(e)===59?(n=";",e++):(n=null,f('";"')),n!==null?(l=sr(),l!==null?n=[n,l]:(n=null,e=o)):(n=null,e=o);n!==null;)t.push(n),o=e,r.charCodeAt(e)===59?(n=";",e++):(n=null,f('";"')),n!==null?(l=sr(),l!==null?n=[n,l]:(n=null,e=o)):(n=null,e=o);return t}function sr(){var t;return t=Ss(),t===null&&(t=Es(),t===null&&(t=Cs(),t===null&&(t=bs(),t===null&&(t=As(),t===null&&(t=Rs(),t===null&&(t=ws())))))),t}function Ss(){var t,n,l,o;return l=e,o=e,r.substr(e,10).toLowerCase()==="transport="?(t=r.substr(e,10),e+=10):(t=null,f('"transport="')),t!==null?(r.substr(e,3).toLowerCase()==="udp"?(n=r.substr(e,3),e+=3):(n=null,f('"udp"')),n===null&&(r.substr(e,3).toLowerCase()==="tcp"?(n=r.substr(e,3),e+=3):(n=null,f('"tcp"')),n===null&&(r.substr(e,4).toLowerCase()==="sctp"?(n=r.substr(e,4),e+=4):(n=null,f('"sctp"')),n===null&&(r.substr(e,3).toLowerCase()==="tls"?(n=r.substr(e,3),e+=3):(n=null,f('"tls"')),n===null&&(n=A())))),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h,_){T.uri_params||(T.uri_params={}),T.uri_params.transport=_.toLowerCase()}(l,t[1])),t===null&&(e=l),t}function Es(){var t,n,l,o;return l=e,o=e,r.substr(e,5).toLowerCase()==="user="?(t=r.substr(e,5),e+=5):(t=null,f('"user="')),t!==null?(r.substr(e,5).toLowerCase()==="phone"?(n=r.substr(e,5),e+=5):(n=null,f('"phone"')),n===null&&(r.substr(e,2).toLowerCase()==="ip"?(n=r.substr(e,2),e+=2):(n=null,f('"ip"')),n===null&&(n=A())),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h,_){T.uri_params||(T.uri_params={}),T.uri_params.user=_.toLowerCase()}(l,t[1])),t===null&&(e=l),t}function Cs(){var t,n,l,o;return l=e,o=e,r.substr(e,7).toLowerCase()==="method="?(t=r.substr(e,7),e+=7):(t=null,f('"method="')),t!==null?(n=nn(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h,_){T.uri_params||(T.uri_params={}),T.uri_params.method=_}(l,t[1])),t===null&&(e=l),t}function bs(){var t,n,l,o;return l=e,o=e,r.substr(e,4).toLowerCase()==="ttl="?(t=r.substr(e,4),e+=4):(t=null,f('"ttl="')),t!==null?(n=gr(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h,_){T.params||(T.params={}),T.params.ttl=_}(l,t[1])),t===null&&(e=l),t}function As(){var t,n,l,o;return l=e,o=e,r.substr(e,6).toLowerCase()==="maddr="?(t=r.substr(e,6),e+=6):(t=null,f('"maddr="')),t!==null?(n=Et(),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t!==null&&(t=function(h,_){T.uri_params||(T.uri_params={}),T.uri_params.maddr=_}(l,t[1])),t===null&&(e=l),t}function Rs(){var t,n,l,o,h,_;return o=e,h=e,r.substr(e,2).toLowerCase()==="lr"?(t=r.substr(e,2),e+=2):(t=null,f('"lr"')),t!==null?(_=e,r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n!==null?(l=A(),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y){T.uri_params||(T.uri_params={}),T.uri_params.lr=void 0}()),t===null&&(e=o),t}function ws(){var t,n,l,o,h,_;return o=e,h=e,t=Is(),t!==null?(_=e,r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n!==null?(l=Os(),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y,C,w){T.uri_params||(T.uri_params={}),typeof w>"u"?w=void 0:w=w[1],T.uri_params[C.toLowerCase()]=w}(o,t[0],t[1])),t===null&&(e=o),t}function Is(){var t,n,l;if(l=e,n=At(),n!==null)for(t=[];n!==null;)t.push(n),n=At();else t=null;return t!==null&&(t=function(o,h){return h.join("")}(l,t)),t===null&&(e=l),t}function Os(){var t,n,l;if(l=e,n=At(),n!==null)for(t=[];n!==null;)t.push(n),n=At();else t=null;return t!==null&&(t=function(o,h){return h.join("")}(l,t)),t===null&&(e=l),t}function At(){var t;return t=Ns(),t===null&&(t=Y(),t===null&&(t=Z())),t}function Ns(){var t;return r.charCodeAt(e)===91?(t="[",e++):(t=null,f('"["')),t===null&&(r.charCodeAt(e)===93?(t="]",e++):(t=null,f('"]"')),t===null&&(r.charCodeAt(e)===47?(t="/",e++):(t=null,f('"/"')),t===null&&(r.charCodeAt(e)===58?(t=":",e++):(t=null,f('":"')),t===null&&(r.charCodeAt(e)===38?(t="&",e++):(t=null,f('"&"')),t===null&&(r.charCodeAt(e)===43?(t="+",e++):(t=null,f('"+"')),t===null&&(r.charCodeAt(e)===36?(t="$",e++):(t=null,f('"$"')))))))),t}function ks(){var t,n,l,o,h,_,y;if(_=e,r.charCodeAt(e)===63?(t="?",e++):(t=null,f('"?"')),t!==null)if(n=Zt(),n!==null){for(l=[],y=e,r.charCodeAt(e)===38?(o="&",e++):(o=null,f('"&"')),o!==null?(h=Zt(),h!==null?o=[o,h]:(o=null,e=y)):(o=null,e=y);o!==null;)l.push(o),y=e,r.charCodeAt(e)===38?(o="&",e++):(o=null,f('"&"')),o!==null?(h=Zt(),h!==null?o=[o,h]:(o=null,e=y)):(o=null,e=y);l!==null?t=[t,n,l]:(t=null,e=_)}else t=null,e=_;else t=null,e=_;return t}function Zt(){var t,n,l,o,h;return o=e,h=e,t=Ds(),t!==null?(r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n!==null?(l=xs(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y,C){y=y.join("").toLowerCase(),C=C.join(""),T.uri_headers||(T.uri_headers={}),T.uri_headers[y]?T.uri_headers[y].push(C):T.uri_headers[y]=[C]}(o,t[0],t[2])),t===null&&(e=o),t}function Ds(){var t,n;if(n=Rt(),n===null&&(n=Y(),n===null&&(n=Z())),n!==null)for(t=[];n!==null;)t.push(n),n=Rt(),n===null&&(n=Y(),n===null&&(n=Z()));else t=null;return t}function xs(){var t,n;for(t=[],n=Rt(),n===null&&(n=Y(),n===null&&(n=Z()));n!==null;)t.push(n),n=Rt(),n===null&&(n=Y(),n===null&&(n=Z()));return t}function Rt(){var t;return r.charCodeAt(e)===91?(t="[",e++):(t=null,f('"["')),t===null&&(r.charCodeAt(e)===93?(t="]",e++):(t=null,f('"]"')),t===null&&(r.charCodeAt(e)===47?(t="/",e++):(t=null,f('"/"')),t===null&&(r.charCodeAt(e)===63?(t="?",e++):(t=null,f('"?"')),t===null&&(r.charCodeAt(e)===58?(t=":",e++):(t=null,f('":"')),t===null&&(r.charCodeAt(e)===43?(t="+",e++):(t=null,f('"+"')),t===null&&(r.charCodeAt(e)===36?(t="$",e++):(t=null,f('"$"')))))))),t}function xa(){var t;return t=tl(),t===null&&(t=Ps()),t}function Ps(){var t,n,l,o,h,_;return _=e,t=nn(),t!==null?(n=U(),n!==null?(l=Us(),l!==null?(o=U(),o!==null?(h=ar(),h!==null?t=[t,n,l,o,h]:(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_),t}function Us(){var t;return t=ae(),t===null&&(t=lr()),t}function lr(){var t,n,l,o;return o=e,t=qs(),t!==null?(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n!==null?(l=Ms(),l===null&&(l=Ls()),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function Ms(){var t,n,l,o,h;return o=e,t=Hs(),t===null&&(t=en()),t!==null?(h=e,r.charCodeAt(e)===63?(n="?",e++):(n=null,f('"?"')),n!==null?(l=Ws(),l!==null?n=[n,l]:(n=null,e=h)):(n=null,e=h),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t}function Hs(){var t,n,l,o;return o=e,r.substr(e,2)==="//"?(t="//",e+=2):(t=null,f('"//"')),t!==null?(n=js(),n!==null?(l=en(),l=l!==null?l:"",l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function en(){var t,n,l;return l=e,r.charCodeAt(e)===47?(t="/",e++):(t=null,f('"/"')),t!==null?(n=$s(),n!==null?t=[t,n]:(t=null,e=l)):(t=null,e=l),t}function Ls(){var t,n,l,o;if(o=e,t=Fs(),t!==null){for(n=[],l=wt();l!==null;)n.push(l),l=wt();n!==null?t=[t,n]:(t=null,e=o)}else t=null,e=o;return t}function wt(){var t;return t=z(),t===null&&(t=Y(),t===null&&(t=Z())),t}function Fs(){var t;return t=Y(),t===null&&(t=Z(),t===null&&(r.charCodeAt(e)===59?(t=";",e++):(t=null,f('";"')),t===null&&(r.charCodeAt(e)===63?(t="?",e++):(t=null,f('"?"')),t===null&&(r.charCodeAt(e)===58?(t=":",e++):(t=null,f('":"')),t===null&&(r.charCodeAt(e)===64?(t="@",e++):(t=null,f('"@"')),t===null&&(r.charCodeAt(e)===38?(t="&",e++):(t=null,f('"&"')),t===null&&(r.charCodeAt(e)===61?(t="=",e++):(t=null,f('"="')),t===null&&(r.charCodeAt(e)===43?(t="+",e++):(t=null,f('"+"')),t===null&&(r.charCodeAt(e)===36?(t="$",e++):(t=null,f('"$"')),t===null&&(r.charCodeAt(e)===44?(t=",",e++):(t=null,f('","')))))))))))),t}function $s(){var t,n,l,o,h,_;if(h=e,t=tn(),t!==null){for(n=[],_=e,r.charCodeAt(e)===47?(l="/",e++):(l=null,f('"/"')),l!==null?(o=tn(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,r.charCodeAt(e)===47?(l="/",e++):(l=null,f('"/"')),l!==null?(o=tn(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function tn(){var t,n,l,o,h,_;for(h=e,t=[],n=It();n!==null;)t.push(n),n=It();if(t!==null){for(n=[],_=e,r.charCodeAt(e)===59?(l=";",e++):(l=null,f('";"')),l!==null?(o=ir(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,r.charCodeAt(e)===59?(l=";",e++):(l=null,f('";"')),l!==null?(o=ir(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function ir(){var t,n;for(t=[],n=It();n!==null;)t.push(n),n=It();return t}function It(){var t;return t=Y(),t===null&&(t=Z(),t===null&&(r.charCodeAt(e)===58?(t=":",e++):(t=null,f('":"')),t===null&&(r.charCodeAt(e)===64?(t="@",e++):(t=null,f('"@"')),t===null&&(r.charCodeAt(e)===38?(t="&",e++):(t=null,f('"&"')),t===null&&(r.charCodeAt(e)===61?(t="=",e++):(t=null,f('"="')),t===null&&(r.charCodeAt(e)===43?(t="+",e++):(t=null,f('"+"')),t===null&&(r.charCodeAt(e)===36?(t="$",e++):(t=null,f('"$"')),t===null&&(r.charCodeAt(e)===44?(t=",",e++):(t=null,f('","')))))))))),t}function qs(){var t,n,l,o,h;if(o=e,h=e,t=g(),t!==null){for(n=[],l=g(),l===null&&(l=v(),l===null&&(r.charCodeAt(e)===43?(l="+",e++):(l=null,f('"+"')),l===null&&(r.charCodeAt(e)===45?(l="-",e++):(l=null,f('"-"')),l===null&&(r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."'))))));l!==null;)n.push(l),l=g(),l===null&&(l=v(),l===null&&(r.charCodeAt(e)===43?(l="+",e++):(l=null,f('"+"')),l===null&&(r.charCodeAt(e)===45?(l="-",e++):(l=null,f('"-"')),l===null&&(r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."'))))));n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t!==null&&(t=function(_){T.scheme=r.substring(e,_)}(o)),t===null&&(e=o),t}function js(){var t;return t=Bs(),t===null&&(t=Gs()),t}function Bs(){var t,n,l,o;return l=e,o=e,t=Se(),t!==null?(r.charCodeAt(e)===64?(n="@",e++):(n=null,f('"@"')),n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t=t!==null?t:"",t!==null?(n=Qt(),n!==null?t=[t,n]:(t=null,e=l)):(t=null,e=l),t=t!==null?t:"",t}function Gs(){var t,n;if(n=Y(),n===null&&(n=Z(),n===null&&(r.charCodeAt(e)===36?(n="$",e++):(n=null,f('"$"')),n===null&&(r.charCodeAt(e)===44?(n=",",e++):(n=null,f('","')),n===null&&(r.charCodeAt(e)===59?(n=";",e++):(n=null,f('";"')),n===null&&(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n===null&&(r.charCodeAt(e)===64?(n="@",e++):(n=null,f('"@"')),n===null&&(r.charCodeAt(e)===38?(n="&",e++):(n=null,f('"&"')),n===null&&(r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"'))))))))))),n!==null)for(t=[];n!==null;)t.push(n),n=Y(),n===null&&(n=Z(),n===null&&(r.charCodeAt(e)===36?(n="$",e++):(n=null,f('"$"')),n===null&&(r.charCodeAt(e)===44?(n=",",e++):(n=null,f('","')),n===null&&(r.charCodeAt(e)===59?(n=";",e++):(n=null,f('";"')),n===null&&(r.charCodeAt(e)===58?(n=":",e++):(n=null,f('":"')),n===null&&(r.charCodeAt(e)===64?(n="@",e++):(n=null,f('"@"')),n===null&&(r.charCodeAt(e)===38?(n="&",e++):(n=null,f('"&"')),n===null&&(r.charCodeAt(e)===61?(n="=",e++):(n=null,f('"="')),n===null&&(r.charCodeAt(e)===43?(n="+",e++):(n=null,f('"+"')))))))))));else t=null;return t}function Ws(){var t,n;for(t=[],n=wt();n!==null;)t.push(n),n=wt();return t}function ar(){var t,n,l,o,h,_,y,C;if(y=e,C=e,r.substr(e,3).toLowerCase()==="sip"?(t=r.substr(e,3),e+=3):(t=null,f('"SIP"')),t!==null)if(r.charCodeAt(e)===47?(n="/",e++):(n=null,f('"/"')),n!==null){if(o=v(),o!==null)for(l=[];o!==null;)l.push(o),o=v();else l=null;if(l!==null)if(r.charCodeAt(e)===46?(o=".",e++):(o=null,f('"."')),o!==null){if(_=v(),_!==null)for(h=[];_!==null;)h.push(_),_=v();else h=null;h!==null?t=[t,n,l,o,h]:(t=null,e=C)}else t=null,e=C;else t=null,e=C}else t=null,e=C;else t=null,e=C;return t!==null&&(t=function(w){T.sip_version=r.substring(e,w)}(y)),t===null&&(e=y),t}function Vs(){var t;return r.substr(e,6)==="INVITE"?(t="INVITE",e+=6):(t=null,f('"INVITE"')),t}function Ks(){var t;return r.substr(e,3)==="ACK"?(t="ACK",e+=3):(t=null,f('"ACK"')),t}function zs(){var t;return r.substr(e,7)==="OPTIONS"?(t="OPTIONS",e+=7):(t=null,f('"OPTIONS"')),t}function Ys(){var t;return r.substr(e,3)==="BYE"?(t="BYE",e+=3):(t=null,f('"BYE"')),t}function Js(){var t;return r.substr(e,6)==="CANCEL"?(t="CANCEL",e+=6):(t=null,f('"CANCEL"')),t}function Xs(){var t;return r.substr(e,8)==="REGISTER"?(t="REGISTER",e+=8):(t=null,f('"REGISTER"')),t}function Qs(){var t;return r.substr(e,9)==="SUBSCRIBE"?(t="SUBSCRIBE",e+=9):(t=null,f('"SUBSCRIBE"')),t}function Zs(){var t;return r.substr(e,6)==="NOTIFY"?(t="NOTIFY",e+=6):(t=null,f('"NOTIFY"')),t}function el(){var t;return r.substr(e,5)==="REFER"?(t="REFER",e+=5):(t=null,f('"REFER"')),t}function nn(){var t,n;return n=e,t=Vs(),t===null&&(t=Ks(),t===null&&(t=zs(),t===null&&(t=Ys(),t===null&&(t=Js(),t===null&&(t=Xs(),t===null&&(t=Qs(),t===null&&(t=Zs(),t===null&&(t=el(),t===null&&(t=A()))))))))),t!==null&&(t=function(l){return T.method=r.substring(e,l),T.method}(n)),t===null&&(e=n),t}function tl(){var t,n,l,o,h,_;return _=e,t=ar(),t!==null?(n=U(),n!==null?(l=nl(),l!==null?(o=U(),o!==null?(h=sl(),h!==null?t=[t,n,l,o,h]:(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_),t}function nl(){var t,n;return n=e,t=rl(),t!==null&&(t=function(l,o){T.status_code=parseInt(o.join(""))}(n,t)),t===null&&(e=n),t}function rl(){var t,n,l,o;return o=e,t=v(),t!==null?(n=v(),n!==null?(l=v(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function sl(){var t,n,l;for(l=e,t=[],n=z(),n===null&&(n=Y(),n===null&&(n=Z(),n===null&&(n=Q(),n===null&&(n=k(),n===null&&(n=U(),n===null&&(n=q()))))));n!==null;)t.push(n),n=z(),n===null&&(n=Y(),n===null&&(n=Z(),n===null&&(n=Q(),n===null&&(n=k(),n===null&&(n=U(),n===null&&(n=q()))))));return t!==null&&(t=function(o){T.reason_phrase=r.substring(e,o)}(l)),t===null&&(e=l),t}function Pa(){var t,n,l,o,h,_;if(h=e,t=Ot(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=Ot(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=Ot(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Ua(){var t,n,l,o,h,_;return o=e,h=e,t=Oe(),t!==null?(_=e,r.charCodeAt(e)===64?(n="@",e++):(n=null,f('"@"')),n!==null?(l=Oe(),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y){T=r.substring(e,y)}(o)),t===null&&(e=o),t}function Ma(){var t,n,l,o,h,_,y;if(h=e,t=tt(),t===null)if(_=e,t=rn(),t!==null){for(n=[],y=e,l=ee(),l!==null?(o=rn(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=ee(),l!==null?(o=rn(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){var w,j;for(j=T.multi_header.length,w=0;w<j;w++)if(T.multi_header[w].parsed===null){T=null;break}T!==null?T=T.multi_header:T=-1}()),t===null&&(e=h),t}function rn(){var t,n,l,o,h,_,y;if(h=e,_=e,t=J(),t===null&&(t=it()),t!==null){for(n=[],y=e,l=K(),l!==null?(o=ur(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=ur(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){var w;T.multi_header||(T.multi_header=[]);try{w=new vt(T.uri,T.display_name,T.params),delete T.uri,delete T.display_name,delete T.params}catch{w=null}T.multi_header.push({possition:e,offset:C,parsed:w})}(h)),t===null&&(e=h),t}function it(){var t,n,l,o,h;return h=e,t=sn(),t=t!==null?t:"",t!==null?(n=Ge(),n!==null?(l=ae(),l!==null?(o=Be(),o!==null?t=[t,n,l,o]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t}function sn(){var t,n,l,o,h,_,y;if(h=e,_=e,t=A(),t!==null){for(n=[],y=e,l=D(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=D(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t===null&&(t=W()),t!==null&&(t=function(C,w){typeof w=="string"?T.display_name=w:T.display_name=w[1].reduce(function(j,re){return j+re[0]+re[1]},w[0])}(h,t)),t===null&&(e=h),t}function ur(){var t;return t=ll(),t===null&&(t=il(),t===null&&(t=fe())),t}function ll(){var t,n,l,o,h;return o=e,h=e,r.substr(e,1).toLowerCase()==="q"?(t=r.substr(e,1),e++):(t=null,f('"q"')),t!==null?(n=X(),n!==null?(l=al(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.params||(T.params={}),T.params.q=y}(o,t[2])),t===null&&(e=o),t}function il(){var t,n,l,o,h;return o=e,h=e,r.substr(e,7).toLowerCase()==="expires"?(t=r.substr(e,7),e+=7):(t=null,f('"expires"')),t!==null?(n=X(),n!==null?(l=at(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.params||(T.params={}),T.params.expires=y}(o,t[2])),t===null&&(e=o),t}function at(){var t,n,l;if(l=e,n=v(),n!==null)for(t=[];n!==null;)t.push(n),n=v();else t=null;return t!==null&&(t=function(o,h){return parseInt(h.join(""))}(l,t)),t===null&&(e=l),t}function al(){var t,n,l,o,h,_,y,C;return _=e,y=e,r.charCodeAt(e)===48?(t="0",e++):(t=null,f('"0"')),t!==null?(C=e,r.charCodeAt(e)===46?(n=".",e++):(n=null,f('"."')),n!==null?(l=v(),l=l!==null?l:"",l!==null?(o=v(),o=o!==null?o:"",o!==null?(h=v(),h=h!==null?h:"",h!==null?n=[n,l,o,h]:(n=null,e=C)):(n=null,e=C)):(n=null,e=C)):(n=null,e=C),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=y)):(t=null,e=y),t!==null&&(t=function(w){return parseFloat(r.substring(e,w))}(_)),t===null&&(e=_),t}function fe(){var t,n,l,o,h,_;return o=e,h=e,t=A(),t!==null?(_=e,n=X(),n!==null?(l=ul(),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y,C,w){T.params||(T.params={}),typeof w>"u"?w=void 0:w=w[1],T.params[C.toLowerCase()]=w}(o,t[0],t[1])),t===null&&(e=o),t}function ul(){var t;return t=A(),t===null&&(t=Et(),t===null&&(t=pt())),t}function Ha(){var t,n,l,o,h,_;if(h=e,t=ol(),t!==null){for(n=[],_=e,l=K(),l!==null?(o=or(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=K(),l!==null?(o=or(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function ol(){var t;return r.substr(e,6).toLowerCase()==="render"?(t=r.substr(e,6),e+=6):(t=null,f('"render"')),t===null&&(r.substr(e,7).toLowerCase()==="session"?(t=r.substr(e,7),e+=7):(t=null,f('"session"')),t===null&&(r.substr(e,4).toLowerCase()==="icon"?(t=r.substr(e,4),e+=4):(t=null,f('"icon"')),t===null&&(r.substr(e,5).toLowerCase()==="alert"?(t=r.substr(e,5),e+=5):(t=null,f('"alert"')),t===null&&(t=A())))),t}function or(){var t;return t=fl(),t===null&&(t=fe()),t}function fl(){var t,n,l,o;return o=e,r.substr(e,8).toLowerCase()==="handling"?(t=r.substr(e,8),e+=8):(t=null,f('"handling"')),t!==null?(n=X(),n!==null?(r.substr(e,8).toLowerCase()==="optional"?(l=r.substr(e,8),e+=8):(l=null,f('"optional"')),l===null&&(r.substr(e,8).toLowerCase()==="required"?(l=r.substr(e,8),e+=8):(l=null,f('"required"')),l===null&&(l=A())),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function La(){var t,n,l,o,h,_;if(h=e,t=A(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Fa(){var t,n,l;if(l=e,n=v(),n!==null)for(t=[];n!==null;)t.push(n),n=v();else t=null;return t!==null&&(t=function(o,h){T=parseInt(h.join(""))}(l,t)),t===null&&(e=l),t}function $a(){var t,n;return n=e,t=cl(),t!==null&&(t=function(l){T=r.substring(e,l)}(n)),t===null&&(e=n),t}function cl(){var t,n,l,o,h,_,y,C;if(y=e,t=hl(),t!==null)if(n=Me(),n!==null)if(l=vl(),l!==null){for(o=[],C=e,h=K(),h!==null?(_=fr(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);h!==null;)o.push(h),C=e,h=K(),h!==null?(_=fr(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);o!==null?t=[t,n,l,o]:(t=null,e=y)}else t=null,e=y;else t=null,e=y;else t=null,e=y;return t}function hl(){var t;return t=dl(),t===null&&(t=_l()),t}function dl(){var t;return r.substr(e,4).toLowerCase()==="text"?(t=r.substr(e,4),e+=4):(t=null,f('"text"')),t===null&&(r.substr(e,5).toLowerCase()==="image"?(t=r.substr(e,5),e+=5):(t=null,f('"image"')),t===null&&(r.substr(e,5).toLowerCase()==="audio"?(t=r.substr(e,5),e+=5):(t=null,f('"audio"')),t===null&&(r.substr(e,5).toLowerCase()==="video"?(t=r.substr(e,5),e+=5):(t=null,f('"video"')),t===null&&(r.substr(e,11).toLowerCase()==="application"?(t=r.substr(e,11),e+=11):(t=null,f('"application"')),t===null&&(t=ln()))))),t}function _l(){var t;return r.substr(e,7).toLowerCase()==="message"?(t=r.substr(e,7),e+=7):(t=null,f('"message"')),t===null&&(r.substr(e,9).toLowerCase()==="multipart"?(t=r.substr(e,9),e+=9):(t=null,f('"multipart"')),t===null&&(t=ln())),t}function ln(){var t;return t=A(),t===null&&(t=pl()),t}function pl(){var t,n,l;return l=e,r.substr(e,2).toLowerCase()==="x-"?(t=r.substr(e,2),e+=2):(t=null,f('"x-"')),t!==null?(n=A(),n!==null?t=[t,n]:(t=null,e=l)):(t=null,e=l),t}function vl(){var t;return t=ln(),t===null&&(t=A()),t}function fr(){var t,n,l,o;return o=e,t=A(),t!==null?(n=X(),n!==null?(l=ml(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function ml(){var t;return t=A(),t===null&&(t=pt()),t}function qa(){var t,n,l,o;return o=e,t=gl(),t!==null?(n=D(),n!==null?(l=nn(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function gl(){var t,n,l;if(l=e,n=v(),n!==null)for(t=[];n!==null;)t.push(n),n=v();else t=null;return t!==null&&(t=function(o,h){T.value=parseInt(h.join(""))}(l,t)),t===null&&(e=l),t}function ja(){var t,n;return n=e,t=at(),t!==null&&(t=function(l,o){T=o}(n,t)),t===null&&(e=n),t}function Ba(){var t,n,l,o,h,_,y;if(h=e,_=e,t=Ot(),t!==null){for(n=[],y=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C,w){T.event=w.join("").toLowerCase()}(h,t[0])),t===null&&(e=h),t}function Ot(){var t,n,l,o,h,_;if(h=e,t=P(),t!==null){for(n=[],_=e,r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."')),l!==null?(o=P(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,r.charCodeAt(e)===46?(l=".",e++):(l=null,f('"."')),l!==null?(o=P(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Ga(){var t,n,l,o,h,_,y;if(h=e,_=e,t=J(),t===null&&(t=it()),t!==null){for(n=[],y=e,l=K(),l!==null?(o=cr(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=cr(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){var w=T.tag;try{T=new vt(T.uri,T.display_name,T.params),w&&T.setParam("tag",w)}catch{T=-1}}()),t===null&&(e=h),t}function cr(){var t;return t=hr(),t===null&&(t=fe()),t}function hr(){var t,n,l,o,h;return o=e,h=e,r.substr(e,3).toLowerCase()==="tag"?(t=r.substr(e,3),e+=3):(t=null,f('"tag"')),t!==null?(n=X(),n!==null?(l=A(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.tag=y}(o,t[2])),t===null&&(e=o),t}function Wa(){var t,n,l;if(l=e,n=v(),n!==null)for(t=[];n!==null;)t.push(n),n=v();else t=null;return t!==null&&(t=function(o,h){T=parseInt(h.join(""))}(l,t)),t===null&&(e=l),t}function Va(){var t,n;return n=e,t=at(),t!==null&&(t=function(l,o){T=o}(n,t)),t===null&&(e=n),t}function Ka(){var t,n,l,o,h,_,y,C,w,j;for(C=e,w=e,t=[],n=sn();n!==null;)t.push(n),n=sn();if(t!==null)if(n=Ge(),n!==null)if(l=ae(),l!==null)if(o=Be(),o!==null){for(h=[],j=e,_=K(),_!==null?(y=fe(),y!==null?_=[_,y]:(_=null,e=j)):(_=null,e=j);_!==null;)h.push(_),j=e,_=K(),_!==null?(y=fe(),y!==null?_=[_,y]:(_=null,e=j)):(_=null,e=j);h!==null?t=[t,n,l,o,h]:(t=null,e=w)}else t=null,e=w;else t=null,e=w;else t=null,e=w;else t=null,e=w;return t!==null&&(t=function(re){try{T=new vt(T.uri,T.display_name,T.params)}catch{T=-1}}()),t===null&&(e=C),t}function za(){var t;return t=dr(),t}function dr(){var t,n,l,o,h,_,y,C;if(y=e,r.substr(e,6).toLowerCase()==="digest"?(t=r.substr(e,6),e+=6):(t=null,f('"Digest"')),t!==null)if(n=D(),n!==null)if(l=an(),l!==null){for(o=[],C=e,h=ee(),h!==null?(_=an(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);h!==null;)o.push(h),C=e,h=ee(),h!==null?(_=an(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);o!==null?t=[t,n,l,o]:(t=null,e=y)}else t=null,e=y;else t=null,e=y;else t=null,e=y;return t===null&&(t=yl()),t}function yl(){var t,n,l,o,h,_,y,C;if(y=e,t=A(),t!==null)if(n=D(),n!==null)if(l=Nt(),l!==null){for(o=[],C=e,h=ee(),h!==null?(_=Nt(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);h!==null;)o.push(h),C=e,h=ee(),h!==null?(_=Nt(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);o!==null?t=[t,n,l,o]:(t=null,e=y)}else t=null,e=y;else t=null,e=y;else t=null,e=y;return t}function Nt(){var t,n,l,o;return o=e,t=A(),t!==null?(n=X(),n!==null?(l=A(),l===null&&(l=pt()),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function an(){var t;return t=Tl(),t===null&&(t=El(),t===null&&(t=Cl(),t===null&&(t=Al(),t===null&&(t=Rl(),t===null&&(t=wl(),t===null&&(t=Il(),t===null&&(t=Nt()))))))),t}function Tl(){var t,n,l,o;return o=e,r.substr(e,5).toLowerCase()==="realm"?(t=r.substr(e,5),e+=5):(t=null,f('"realm"')),t!==null?(n=X(),n!==null?(l=Sl(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function Sl(){var t,n;return n=e,t=W(),t!==null&&(t=function(l,o){T.realm=o}(n,t)),t===null&&(e=n),t}function El(){var t,n,l,o,h,_,y,C,w;if(C=e,r.substr(e,6).toLowerCase()==="domain"?(t=r.substr(e,6),e+=6):(t=null,f('"domain"')),t!==null)if(n=X(),n!==null)if(l=We(),l!==null)if(o=un(),o!==null){if(h=[],w=e,y=U(),y!==null)for(_=[];y!==null;)_.push(y),y=U();else _=null;for(_!==null?(y=un(),y!==null?_=[_,y]:(_=null,e=w)):(_=null,e=w);_!==null;){if(h.push(_),w=e,y=U(),y!==null)for(_=[];y!==null;)_.push(y),y=U();else _=null;_!==null?(y=un(),y!==null?_=[_,y]:(_=null,e=w)):(_=null,e=w)}h!==null?(_=Ve(),_!==null?t=[t,n,l,o,h,_]:(t=null,e=C)):(t=null,e=C)}else t=null,e=C;else t=null,e=C;else t=null,e=C;else t=null,e=C;return t}function un(){var t;return t=lr(),t===null&&(t=en()),t}function Cl(){var t,n,l,o;return o=e,r.substr(e,5).toLowerCase()==="nonce"?(t=r.substr(e,5),e+=5):(t=null,f('"nonce"')),t!==null?(n=X(),n!==null?(l=bl(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function bl(){var t,n;return n=e,t=W(),t!==null&&(t=function(l,o){T.nonce=o}(n,t)),t===null&&(e=n),t}function Al(){var t,n,l,o,h;return o=e,h=e,r.substr(e,6).toLowerCase()==="opaque"?(t=r.substr(e,6),e+=6):(t=null,f('"opaque"')),t!==null?(n=X(),n!==null?(l=W(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.opaque=y}(o,t[2])),t===null&&(e=o),t}function Rl(){var t,n,l,o,h;return o=e,r.substr(e,5).toLowerCase()==="stale"?(t=r.substr(e,5),e+=5):(t=null,f('"stale"')),t!==null?(n=X(),n!==null?(h=e,r.substr(e,4).toLowerCase()==="true"?(l=r.substr(e,4),e+=4):(l=null,f('"true"')),l!==null&&(l=function(_){T.stale=!0}()),l===null&&(e=h),l===null&&(h=e,r.substr(e,5).toLowerCase()==="false"?(l=r.substr(e,5),e+=5):(l=null,f('"false"')),l!==null&&(l=function(_){T.stale=!1}()),l===null&&(e=h)),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function wl(){var t,n,l,o,h;return o=e,h=e,r.substr(e,9).toLowerCase()==="algorithm"?(t=r.substr(e,9),e+=9):(t=null,f('"algorithm"')),t!==null?(n=X(),n!==null?(r.substr(e,3).toLowerCase()==="md5"?(l=r.substr(e,3),e+=3):(l=null,f('"MD5"')),l===null&&(r.substr(e,8).toLowerCase()==="md5-sess"?(l=r.substr(e,8),e+=8):(l=null,f('"MD5-sess"')),l===null&&(l=A())),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.algorithm=y.toUpperCase()}(o,t[2])),t===null&&(e=o),t}function Il(){var t,n,l,o,h,_,y,C,w,j;if(C=e,r.substr(e,3).toLowerCase()==="qop"?(t=r.substr(e,3),e+=3):(t=null,f('"qop"')),t!==null)if(n=X(),n!==null)if(l=We(),l!==null){if(w=e,o=on(),o!==null){for(h=[],j=e,r.charCodeAt(e)===44?(_=",",e++):(_=null,f('","')),_!==null?(y=on(),y!==null?_=[_,y]:(_=null,e=j)):(_=null,e=j);_!==null;)h.push(_),j=e,r.charCodeAt(e)===44?(_=",",e++):(_=null,f('","')),_!==null?(y=on(),y!==null?_=[_,y]:(_=null,e=j)):(_=null,e=j);h!==null?o=[o,h]:(o=null,e=w)}else o=null,e=w;o!==null?(h=Ve(),h!==null?t=[t,n,l,o,h]:(t=null,e=C)):(t=null,e=C)}else t=null,e=C;else t=null,e=C;else t=null,e=C;return t}function on(){var t,n;return n=e,r.substr(e,8).toLowerCase()==="auth-int"?(t=r.substr(e,8),e+=8):(t=null,f('"auth-int"')),t===null&&(r.substr(e,4).toLowerCase()==="auth"?(t=r.substr(e,4),e+=4):(t=null,f('"auth"')),t===null&&(t=A())),t!==null&&(t=function(l,o){T.qop||(T.qop=[]),T.qop.push(o.toLowerCase())}(n,t)),t===null&&(e=n),t}function Ya(){var t,n,l,o,h,_;if(h=e,t=A(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Ja(){var t,n,l,o,h,_,y;if(h=e,_=e,t=fn(),t!==null){for(n=[],y=e,l=ee(),l!==null?(o=fn(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=ee(),l!==null?(o=fn(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){var w,j;for(j=T.multi_header.length,w=0;w<j;w++)if(T.multi_header[w].parsed===null){T=null;break}T!==null?T=T.multi_header:T=-1}()),t===null&&(e=h),t}function fn(){var t,n,l,o,h,_,y;if(h=e,_=e,t=it(),t!==null){for(n=[],y=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){var w;T.multi_header||(T.multi_header=[]);try{w=new vt(T.uri,T.display_name,T.params),delete T.uri,delete T.display_name,delete T.params}catch{w=null}T.multi_header.push({possition:e,offset:C,parsed:w})}(h)),t===null&&(e=h),t}function Xa(){var t,n,l,o,h,_,y;if(h=e,_=e,r.substr(e,3).toLowerCase()==="sip"?(t=r.substr(e,3),e+=3):(t=null,f('"SIP"')),t===null&&(t=A()),t!==null){for(n=[],y=e,l=K(),l!==null?(o=_r(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=_r(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C,w){if(T.protocol=w.toLowerCase(),T.params||(T.params={}),T.params.text&&T.params.text[0]==='"'){var j=T.params.text;T.text=j.substring(1,j.length-1),delete T.params.text}}(h,t[0])),t===null&&(e=h),t}function _r(){var t;return t=Ol(),t===null&&(t=fe()),t}function Ol(){var t,n,l,o,h,_;if(h=e,_=e,r.substr(e,5).toLowerCase()==="cause"?(t=r.substr(e,5),e+=5):(t=null,f('"cause"')),t!==null)if(n=X(),n!==null){if(o=v(),o!==null)for(l=[];o!==null;)l.push(o),o=v();else l=null;l!==null?t=[t,n,l]:(t=null,e=_)}else t=null,e=_;else t=null,e=_;return t!==null&&(t=function(y,C){T.cause=parseInt(C.join(""))}(h,t[2])),t===null&&(e=h),t}function Qa(){var t,n,l,o,h,_;if(h=e,t=A(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Za(){var t,n,l,o,h,_;if(h=e,t=cn(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=cn(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=cn(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function cn(){var t,n,l,o,h,_;if(h=e,t=it(),t!==null){for(n=[],_=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function eu(){var t,n,l,o,h,_;if(h=e,t=Nl(),t!==null){for(n=[],_=e,l=K(),l!==null?(o=pr(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=K(),l!==null?(o=pr(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Nl(){var t,n;return n=e,r.substr(e,6).toLowerCase()==="active"?(t=r.substr(e,6),e+=6):(t=null,f('"active"')),t===null&&(r.substr(e,7).toLowerCase()==="pending"?(t=r.substr(e,7),e+=7):(t=null,f('"pending"')),t===null&&(r.substr(e,10).toLowerCase()==="terminated"?(t=r.substr(e,10),e+=10):(t=null,f('"terminated"')),t===null&&(t=A()))),t!==null&&(t=function(l){T.state=r.substring(e,l)}(n)),t===null&&(e=n),t}function pr(){var t,n,l,o,h;return o=e,h=e,r.substr(e,6).toLowerCase()==="reason"?(t=r.substr(e,6),e+=6):(t=null,f('"reason"')),t!==null?(n=X(),n!==null?(l=kl(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){typeof y<"u"&&(T.reason=y)}(o,t[2])),t===null&&(e=o),t===null&&(o=e,h=e,r.substr(e,7).toLowerCase()==="expires"?(t=r.substr(e,7),e+=7):(t=null,f('"expires"')),t!==null?(n=X(),n!==null?(l=at(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){typeof y<"u"&&(T.expires=y)}(o,t[2])),t===null&&(e=o),t===null&&(o=e,h=e,r.substr(e,11).toLowerCase()==="retry_after"?(t=r.substr(e,11),e+=11):(t=null,f('"retry_after"')),t!==null?(n=X(),n!==null?(l=at(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){typeof y<"u"&&(T.retry_after=y)}(o,t[2])),t===null&&(e=o),t===null&&(t=fe()))),t}function kl(){var t;return r.substr(e,11).toLowerCase()==="deactivated"?(t=r.substr(e,11),e+=11):(t=null,f('"deactivated"')),t===null&&(r.substr(e,9).toLowerCase()==="probation"?(t=r.substr(e,9),e+=9):(t=null,f('"probation"')),t===null&&(r.substr(e,8).toLowerCase()==="rejected"?(t=r.substr(e,8),e+=8):(t=null,f('"rejected"')),t===null&&(r.substr(e,7).toLowerCase()==="timeout"?(t=r.substr(e,7),e+=7):(t=null,f('"timeout"')),t===null&&(r.substr(e,6).toLowerCase()==="giveup"?(t=r.substr(e,6),e+=6):(t=null,f('"giveup"')),t===null&&(r.substr(e,10).toLowerCase()==="noresource"?(t=r.substr(e,10),e+=10):(t=null,f('"noresource"')),t===null&&(r.substr(e,9).toLowerCase()==="invariant"?(t=r.substr(e,9),e+=9):(t=null,f('"invariant"')),t===null&&(t=A()))))))),t}function tu(){var t;return t=je(),t=t!==null?t:"",t}function nu(){var t,n,l,o,h,_;if(h=e,t=A(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=A(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t=t!==null?t:"",t}function ru(){var t,n,l,o,h,_,y;if(h=e,_=e,t=J(),t===null&&(t=it()),t!==null){for(n=[],y=e,l=K(),l!==null?(o=vr(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=vr(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){var w=T.tag;try{T=new vt(T.uri,T.display_name,T.params),w&&T.setParam("tag",w)}catch{T=-1}}()),t===null&&(e=h),t}function vr(){var t;return t=hr(),t===null&&(t=fe()),t}function su(){var t,n,l,o,h,_;if(h=e,t=hn(),t!==null){for(n=[],_=e,l=ee(),l!==null?(o=hn(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=ee(),l!==null?(o=hn(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function hn(){var t,n,l,o,h,_,y,C;if(y=e,t=Ll(),t!==null)if(n=D(),n!==null)if(l=ql(),l!==null){for(o=[],C=e,h=K(),h!==null?(_=mr(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);h!==null;)o.push(h),C=e,h=K(),h!==null?(_=mr(),_!==null?h=[h,_]:(h=null,e=C)):(h=null,e=C);o!==null?t=[t,n,l,o]:(t=null,e=y)}else t=null,e=y;else t=null,e=y;else t=null,e=y;return t}function mr(){var t;return t=Dl(),t===null&&(t=xl(),t===null&&(t=Pl(),t===null&&(t=Ul(),t===null&&(t=Ml(),t===null&&(t=fe()))))),t}function Dl(){var t,n,l,o,h;return o=e,h=e,r.substr(e,3).toLowerCase()==="ttl"?(t=r.substr(e,3),e+=3):(t=null,f('"ttl"')),t!==null?(n=X(),n!==null?(l=gr(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.ttl=y}(o,t[2])),t===null&&(e=o),t}function xl(){var t,n,l,o,h;return o=e,h=e,r.substr(e,5).toLowerCase()==="maddr"?(t=r.substr(e,5),e+=5):(t=null,f('"maddr"')),t!==null?(n=X(),n!==null?(l=Et(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.maddr=y}(o,t[2])),t===null&&(e=o),t}function Pl(){var t,n,l,o,h;return o=e,h=e,r.substr(e,8).toLowerCase()==="received"?(t=r.substr(e,8),e+=8):(t=null,f('"received"')),t!==null?(n=X(),n!==null?(l=Ct(),l===null&&(l=rr()),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.received=y}(o,t[2])),t===null&&(e=o),t}function Ul(){var t,n,l,o,h;return o=e,h=e,r.substr(e,6).toLowerCase()==="branch"?(t=r.substr(e,6),e+=6):(t=null,f('"branch"')),t!==null?(n=X(),n!==null?(l=A(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.branch=y}(o,t[2])),t===null&&(e=o),t}function Ml(){var t,n,l,o,h;return o=e,r.substr(e,5).toLowerCase()==="rport"?(t=r.substr(e,5),e+=5):(t=null,f('"rport"')),t!==null?(h=e,n=X(),n!==null?(l=Hl(),l!==null?n=[n,l]:(n=null,e=h)):(n=null,e=h),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t}function Hl(){var t,n,l,o,h,_,y;return _=e,y=e,t=v(),t=t!==null?t:"",t!==null?(n=v(),n=n!==null?n:"",n!==null?(l=v(),l=l!==null?l:"",l!==null?(o=v(),o=o!==null?o:"",o!==null?(h=v(),h=h!==null?h:"",h!==null?t=[t,n,l,o,h]:(t=null,e=y)):(t=null,e=y)):(t=null,e=y)):(t=null,e=y)):(t=null,e=y),t!==null&&(t=function(C,w){T.rport=parseInt(w.join(""))}(_,t)),t===null&&(e=_),t}function Ll(){var t,n,l,o,h,_;return _=e,t=Fl(),t!==null?(n=Me(),n!==null?(l=A(),l!==null?(o=Me(),o!==null?(h=$l(),h!==null?t=[t,n,l,o,h]:(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_)):(t=null,e=_),t}function Fl(){var t,n;return n=e,r.substr(e,3).toLowerCase()==="sip"?(t=r.substr(e,3),e+=3):(t=null,f('"SIP"')),t===null&&(t=A()),t!==null&&(t=function(l,o){T.protocol=o}(n,t)),t===null&&(e=n),t}function $l(){var t,n;return n=e,r.substr(e,3).toLowerCase()==="udp"?(t=r.substr(e,3),e+=3):(t=null,f('"UDP"')),t===null&&(r.substr(e,3).toLowerCase()==="tcp"?(t=r.substr(e,3),e+=3):(t=null,f('"TCP"')),t===null&&(r.substr(e,3).toLowerCase()==="tls"?(t=r.substr(e,3),e+=3):(t=null,f('"TLS"')),t===null&&(r.substr(e,4).toLowerCase()==="sctp"?(t=r.substr(e,4),e+=4):(t=null,f('"SCTP"')),t===null&&(t=A())))),t!==null&&(t=function(l,o){T.transport=o}(n,t)),t===null&&(e=n),t}function ql(){var t,n,l,o,h;return o=e,t=jl(),t!==null?(h=e,n=st(),n!==null?(l=Bl(),l!==null?n=[n,l]:(n=null,e=h)):(n=null,e=h),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=o)):(t=null,e=o),t}function jl(){var t,n;return n=e,t=Ct(),t===null&&(t=nr(),t===null&&(t=er())),t!==null&&(t=function(l){T.host=r.substring(e,l)}(n)),t===null&&(e=n),t}function Bl(){var t,n,l,o,h,_,y;return _=e,y=e,t=v(),t=t!==null?t:"",t!==null?(n=v(),n=n!==null?n:"",n!==null?(l=v(),l=l!==null?l:"",l!==null?(o=v(),o=o!==null?o:"",o!==null?(h=v(),h=h!==null?h:"",h!==null?t=[t,n,l,o,h]:(t=null,e=y)):(t=null,e=y)):(t=null,e=y)):(t=null,e=y)):(t=null,e=y),t!==null&&(t=function(C,w){T.port=parseInt(w.join(""))}(_,t)),t===null&&(e=_),t}function gr(){var t,n,l,o,h;return o=e,h=e,t=v(),t!==null?(n=v(),n=n!==null?n:"",n!==null?(l=v(),l=l!==null?l:"",l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){return parseInt(y.join(""))}(o,t)),t===null&&(e=o),t}function lu(){var t;return t=dr(),t}function iu(){var t,n,l,o,h,_;if(h=e,t=Gl(),t!==null){for(n=[],_=e,l=K(),l!==null?(o=yr(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=K(),l!==null?(o=yr(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Gl(){var t,n;return n=e,t=at(),t!==null&&(t=function(l,o){T.expires=o}(n,t)),t===null&&(e=n),t}function yr(){var t;return t=Wl(),t===null&&(t=fe()),t}function Wl(){var t,n,l,o,h;return o=e,h=e,r.substr(e,9).toLowerCase()==="refresher"?(t=r.substr(e,9),e+=9):(t=null,f('"refresher"')),t!==null?(n=X(),n!==null?(r.substr(e,3).toLowerCase()==="uac"?(l=r.substr(e,3),e+=3):(l=null,f('"uac"')),l===null&&(r.substr(e,3).toLowerCase()==="uas"?(l=r.substr(e,3),e+=3):(l=null,f('"uas"'))),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.refresher=y.toLowerCase()}(o,t[2])),t===null&&(e=o),t}function au(){var t,n,l,o;return o=e,t=A(),t!==null?(n=Ie(),n!==null?(l=Vl(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function Vl(){var t,n;for(t=[],n=be(),n===null&&(n=k(),n===null&&(n=D()));n!==null;)t.push(n),n=be(),n===null&&(n=k(),n===null&&(n=D()));return t}function uu(){var t,n;for(t=[],n=N();n!==null;)t.push(n),n=N();return t}function ou(){var t,n,l;return l=e,r.substr(e,5)==="uuid:"?(t="uuid:",e+=5):(t=null,f('"uuid:"')),t!==null?(n=Kl(),n!==null?t=[t,n]:(t=null,e=l)):(t=null,e=l),t}function Kl(){var t,n,l,o,h,_,y,C,w,j,re;return j=e,re=e,t=zl(),t!==null?(r.charCodeAt(e)===45?(n="-",e++):(n=null,f('"-"')),n!==null?(l=He(),l!==null?(r.charCodeAt(e)===45?(o="-",e++):(o=null,f('"-"')),o!==null?(h=He(),h!==null?(r.charCodeAt(e)===45?(_="-",e++):(_=null,f('"-"')),_!==null?(y=He(),y!==null?(r.charCodeAt(e)===45?(C="-",e++):(C=null,f('"-"')),C!==null?(w=Yl(),w!==null?t=[t,n,l,o,h,_,y,C,w]:(t=null,e=re)):(t=null,e=re)):(t=null,e=re)):(t=null,e=re)):(t=null,e=re)):(t=null,e=re)):(t=null,e=re)):(t=null,e=re)):(t=null,e=re),t!==null&&(t=function(Ne,dn){T=r.substring(e+5,Ne)}(j,t[0])),t===null&&(e=j),t}function He(){var t,n,l,o,h;return h=e,t=S(),t!==null?(n=S(),n!==null?(l=S(),l!==null?(o=S(),o!==null?t=[t,n,l,o]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t}function zl(){var t,n,l;return l=e,t=He(),t!==null?(n=He(),n!==null?t=[t,n]:(t=null,e=l)):(t=null,e=l),t}function Yl(){var t,n,l,o;return o=e,t=He(),t!==null?(n=He(),n!==null?(l=He(),l!==null?t=[t,n,l]:(t=null,e=o)):(t=null,e=o)):(t=null,e=o),t}function fu(){var t,n,l,o,h,_,y;if(h=e,_=e,t=J(),t===null&&(t=it()),t!==null){for(n=[],y=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);l!==null;)n.push(l),y=e,l=K(),l!==null?(o=fe(),o!==null?l=[l,o]:(l=null,e=y)):(l=null,e=y);n!==null?t=[t,n]:(t=null,e=_)}else t=null,e=_;return t!==null&&(t=function(C){try{T=new vt(T.uri,T.display_name,T.params)}catch{T=-1}}()),t===null&&(e=h),t}function cu(){var t,n,l,o,h,_;if(h=e,t=Jl(),t!==null){for(n=[],_=e,l=K(),l!==null?(o=Tr(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);l!==null;)n.push(l),_=e,l=K(),l!==null?(o=Tr(),o!==null?l=[l,o]:(l=null,e=_)):(l=null,e=_);n!==null?t=[t,n]:(t=null,e=h)}else t=null,e=h;return t}function Jl(){var t,n,l,o,h,_;return o=e,h=e,t=Oe(),t!==null?(_=e,r.charCodeAt(e)===64?(n="@",e++):(n=null,f('"@"')),n!==null?(l=Oe(),l!==null?n=[n,l]:(n=null,e=_)):(n=null,e=_),n=n!==null?n:"",n!==null?t=[t,n]:(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(y){T.call_id=r.substring(e,y)}(o)),t===null&&(e=o),t}function Tr(){var t;return t=Xl(),t===null&&(t=Ql(),t===null&&(t=Zl(),t===null&&(t=fe()))),t}function Xl(){var t,n,l,o,h;return o=e,h=e,r.substr(e,6)==="to-tag"?(t="to-tag",e+=6):(t=null,f('"to-tag"')),t!==null?(n=X(),n!==null?(l=A(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.to_tag=y}(o,t[2])),t===null&&(e=o),t}function Ql(){var t,n,l,o,h;return o=e,h=e,r.substr(e,8)==="from-tag"?(t="from-tag",e+=8):(t=null,f('"from-tag"')),t!==null?(n=X(),n!==null?(l=A(),l!==null?t=[t,n,l]:(t=null,e=h)):(t=null,e=h)):(t=null,e=h),t!==null&&(t=function(_,y){T.from_tag=y}(o,t[2])),t===null&&(e=o),t}function Zl(){var t,n;return n=e,r.substr(e,10)==="early-only"?(t="early-only",e+=10):(t=null,f('"early-only"')),t!==null&&(t=function(l){T.early_only=!0}()),t===null&&(e=n),t}function hu(t){t.sort();for(var n=null,l=[],o=0;o<t.length;o++)t[o]!==n&&(l.push(t[o]),n=t[o]);return l}function du(){for(var t=1,n=1,l=!1,o=0;o<Math.max(e,d);o++){var h=r.charAt(o);h===`
`?(l||t++,n=1,l=!1):h==="\r"||h==="\u2028"||h==="\u2029"?(t++,n=1,l=!0):(n++,l=!1)}return{line:t,column:n}}var ei=Ze(),vt=is(),T={},_u=c[s]();if(_u===null||e!==r.length){var Sr=Math.max(e,d),pu=Sr<r.length?r.charAt(Sr):null,ti=du();return new this.SyntaxError(hu(m),pu,Sr,ti.line,ti.column),-1}return T},toSource:function(){return this._source}};return a.SyntaxError=function(i,r,s,c,e){function d(m,f){var p,v;switch(m.length){case 0:p="end of input";break;case 1:p=m[0];break;default:p=m.slice(0,m.length-1).join(", ")+" or "+m[m.length-1]}return v=f?u(f):"end of input","Expected "+p+" but "+v+" found."}this.name="SyntaxError",this.expected=i,this.found=r,this.message=d(i,r),this.offset=s,this.line=c,this.column=e},a.SyntaxError.prototype=Error.prototype,a}()),br}var Ar,li;function Ze(){if(li)return Ar;li=1;function u(f,p){var v;if(typeof Symbol>"u"||f[Symbol.iterator]==null){if(Array.isArray(f)||(v=a(f))||p&&f&&typeof f.length=="number"){v&&(f=v);var g=0,S=function(){};return{s:S,n:function(){return g>=f.length?{done:!0}:{done:!1,value:f[g++]}},e:function(q){throw q},f:S}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=!0,N=!1,L;return{s:function(){v=f[Symbol.iterator]()},n:function(){var q=v.next();return E=q.done,q},e:function(q){N=!0,L=q},f:function(){try{!E&&v.return!=null&&v.return()}finally{if(N)throw L}}}}function a(f,p){if(f){if(typeof f=="string")return i(f,p);var v=Object.prototype.toString.call(f).slice(8,-1);if(v==="Object"&&f.constructor&&(v=f.constructor.name),v==="Map"||v==="Set")return Array.from(f);if(v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v))return i(f,p)}}function i(f,p){(p==null||p>f.length)&&(p=f.length);for(var v=0,g=new Array(p);v<p;v++)g[v]=f[v];return g}function r(f,p){if(!(f instanceof p))throw new TypeError("Cannot call a class as a function")}function s(f,p){for(var v=0;v<p.length;v++){var g=p[v];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(f,g.key,g)}}function c(f,p,v){return p&&s(f.prototype,p),v&&s(f,v),f}var e=he,d=ye(),m=Pe();return Ar=function(){c(f,null,[{key:"parse",value:function(v){if(v=m.parse(v,"SIP_URI"),v!==-1)return v}}]);function f(p,v,g,S){var E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},N=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(r(this,f),!g)throw new TypeError('missing or invalid "host" parameter');this._parameters={},this._headers={},this._scheme=p||e.SIP,this._user=v,this._host=g,this._port=S;for(var L in E)Object.prototype.hasOwnProperty.call(E,L)&&this.setParam(L,E[L]);for(var U in N)Object.prototype.hasOwnProperty.call(N,U)&&this.setHeader(U,N[U])}return c(f,[{key:"setParam",value:function(v,g){v&&(this._parameters[v.toLowerCase()]=typeof g>"u"||g===null?null:g.toString())}},{key:"getParam",value:function(v){if(v)return this._parameters[v.toLowerCase()]}},{key:"hasParam",value:function(v){if(v)return this._parameters.hasOwnProperty(v.toLowerCase())&&!0||!1}},{key:"deleteParam",value:function(v){if(v=v.toLowerCase(),this._parameters.hasOwnProperty(v)){var g=this._parameters[v];return delete this._parameters[v],g}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(v,g){this._headers[d.headerize(v)]=Array.isArray(g)?g:[g]}},{key:"getHeader",value:function(v){if(v)return this._headers[d.headerize(v)]}},{key:"hasHeader",value:function(v){if(v)return this._headers.hasOwnProperty(d.headerize(v))&&!0||!1}},{key:"deleteHeader",value:function(v){if(v=d.headerize(v),this._headers.hasOwnProperty(v)){var g=this._headers[v];return delete this._headers[v],g}}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new f(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var v=[],g="".concat(this._scheme,":");this._user&&(g+="".concat(d.escapeUser(this._user),"@")),g+=this._host,(this._port||this._port===0)&&(g+=":".concat(this._port));for(var S in this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,S)&&(g+=";".concat(S),this._parameters[S]!==null&&(g+="=".concat(this._parameters[S])));for(var E in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,E)){var N=u(this._headers[E]),L;try{for(N.s();!(L=N.n()).done;){var U=L.value;v.push("".concat(E,"=").concat(U))}}catch(q){N.e(q)}finally{N.f()}}return v.length>0&&(g+="?".concat(v.join("&"))),g}},{key:"toAor",value:function(v){var g="".concat(this._scheme,":");return this._user&&(g+="".concat(d.escapeUser(this._user),"@")),g+=this._host,v&&(this._port||this._port===0)&&(g+=":".concat(this._port)),g}},{key:"scheme",get:function(){return this._scheme},set:function(v){this._scheme=v.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(v){this._user=v}},{key:"host",get:function(){return this._host},set:function(v){this._host=v.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(v){this._port=v===0?v:parseInt(v,10)||null}}]),f}(),Ar}var ii;function ye(){if(ii)return oe;ii=1;function u(p){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(g){return typeof g}:u=function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},u(p)}function a(p,v){var g;if(typeof Symbol>"u"||p[Symbol.iterator]==null){if(Array.isArray(p)||(g=i(p))||v&&p&&typeof p.length=="number"){g&&(p=g);var S=0,E=function(){};return{s:E,n:function(){return S>=p.length?{done:!0}:{done:!1,value:p[S++]}},e:function(G){throw G},f:E}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var N=!0,L=!1,U;return{s:function(){g=p[Symbol.iterator]()},n:function(){var G=g.next();return N=G.done,G},e:function(G){L=!0,U=G},f:function(){try{!N&&g.return!=null&&g.return()}finally{if(L)throw U}}}}function i(p,v){if(p){if(typeof p=="string")return r(p,v);var g=Object.prototype.toString.call(p).slice(8,-1);if(g==="Object"&&p.constructor&&(g=p.constructor.name),g==="Map"||g==="Set")return Array.from(p);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return r(p,v)}}function r(p,v){(v==null||v>p.length)&&(v=p.length);for(var g=0,S=new Array(v);g<v;g++)S[g]=p[g];return S}var s=he,c=Ze(),e=Pe();oe.str_utf8_length=function(p){return unescape(encodeURIComponent(p)).length};var d=oe.isFunction=function(p){return p!==void 0?Object.prototype.toString.call(p)==="[object Function]":!1};oe.isString=function(p){return p!==void 0?Object.prototype.toString.call(p)==="[object String]":!1},oe.isDecimal=function(p){return!isNaN(p)&&parseFloat(p)===parseInt(p,10)},oe.isEmpty=function(p){return p===null||p===""||p===void 0||Array.isArray(p)&&p.length===0||typeof p=="number"&&isNaN(p)},oe.hasMethods=function(p){for(var v=arguments.length,g=new Array(v>1?v-1:0),S=1;S<v;S++)g[S-1]=arguments[S];for(var E=0,N=g;E<N.length;E++){var L=N[E];if(d(p[L]))return!1}return!0};var m=oe.createRandomToken=function(p){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32,g,S,E="";for(g=0;g<p;g++)S=Math.random()*v|0,E+=S.toString(v);return E};oe.newTag=function(){return m(10)},oe.newUUID=function(){var p="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(v){var g=Math.random()*16|0,S=v==="x"?g:g&3|8;return S.toString(16)});return p},oe.hostType=function(p){if(p){if(p=e.parse(p,"host"),p!==-1)return p.host_type}else return};var f=oe.escapeUser=function(p){return encodeURIComponent(decodeURIComponent(p)).replace(/%3A/ig,":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")};return oe.normalizeTarget=function(p,v){if(p){if(p instanceof c)return p;if(typeof p=="string"){var g=p.split("@"),S,E;switch(g.length){case 1:if(!v)return;S=p,E=v;break;case 2:S=g[0],E=g[1];break;default:S=g.slice(0,g.length-1).join("@"),E=g[g.length-1]}S=S.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(S)&&(S=S.replace(/[-.()]/g,"")),p="".concat(s.SIP,":").concat(f(S),"@").concat(E);var N;return(N=c.parse(p))?N:void 0}else return}else return},oe.headerize=function(p){var v={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},g=p.toLowerCase().replace(/_/g,"-").split("-"),S="",E=g.length,N;for(N=0;N<E;N++)N!==0&&(S+="-"),S+=g[N].charAt(0).toUpperCase()+g[N].substring(1);return v[S]&&(S=v[S]),S},oe.sipErrorCause=function(p){for(var v in s.SIP_ERROR_CAUSES)if(s.SIP_ERROR_CAUSES[v].indexOf(p)!==-1)return s.causes[v];return s.causes.SIP_FAILURE_CODE},oe.getRandomTestNetIP=function(){function p(v,g){return Math.floor(Math.random()*(g-v+1)+v)}return"192.0.2.".concat(p(1,254))},oe.calculateMD5=function(p){function v(W,B){return W<<B|W>>>32-B}function g(W,B){var V=W&2147483648,J=B&2147483648,ae=W&1073741824,de=B&1073741824,le=(W&1073741823)+(B&1073741823);return ae&de?le^2147483648^V^J:ae|de?le&1073741824?le^3221225472^V^J:le^1073741824^V^J:le^V^J}function S(W,B,V){return W&B|~W&V}function E(W,B,V){return W&V|B&~V}function N(W,B,V){return W^B^V}function L(W,B,V){return B^(W|~V)}function U(W,B,V,J,ae,de,le){return W=g(W,g(g(S(B,V,J),ae),le)),g(v(W,de),B)}function q(W,B,V,J,ae,de,le){return W=g(W,g(g(E(B,V,J),ae),le)),g(v(W,de),B)}function G(W,B,V,J,ae,de,le){return W=g(W,g(g(N(B,V,J),ae),le)),g(v(W,de),B)}function z(W,B,V,J,ae,de,le){return W=g(W,g(g(L(B,V,J),ae),le)),g(v(W,de),B)}function Y(W){for(var B,V=W.length,J=V+8,ae=(J-J%64)/64,de=(ae+1)*16,le=new Array(de-1),lt=0,Se=0;Se<V;)B=(Se-Se%4)/4,lt=Se%4*8,le[B]=le[B]|W.charCodeAt(Se)<<lt,Se++;return B=(Se-Se%4)/4,lt=Se%4*8,le[B]=le[B]|128<<lt,le[de-2]=V<<3,le[de-1]=V>>>29,le}function ue(W){var B="",V="",J,ae;for(ae=0;ae<=3;ae++)J=W>>>ae*8&255,V="0".concat(J.toString(16)),B=B+V.substr(V.length-2,2);return B}function Z(W){for(var B="",V=0;V<W.length;V++){var J=W.charCodeAt(V);J<128?B+=String.fromCharCode(J):J>127&&J<2048?(B+=String.fromCharCode(J>>6|192),B+=String.fromCharCode(J&63|128)):(B+=String.fromCharCode(J>>12|224),B+=String.fromCharCode(J>>6&63|128),B+=String.fromCharCode(J&63|128))}return B}var D=[],O,Ie,je,be,Q,k,x,A,P,_t=7,Oe=12,tt=17,Me=22,X=5,nt=9,rt=14,Be=20,Ge=4,ee=11,K=16,st=23,We=6,Ve=10,Ke=15,ze=21;for(p=Z(p),D=Y(p),k=1732584193,x=4023233417,A=2562383102,P=271733878,O=0;O<D.length;O+=16)Ie=k,je=x,be=A,Q=P,k=U(k,x,A,P,D[O+0],_t,3614090360),P=U(P,k,x,A,D[O+1],Oe,3905402710),A=U(A,P,k,x,D[O+2],tt,606105819),x=U(x,A,P,k,D[O+3],Me,3250441966),k=U(k,x,A,P,D[O+4],_t,4118548399),P=U(P,k,x,A,D[O+5],Oe,1200080426),A=U(A,P,k,x,D[O+6],tt,2821735955),x=U(x,A,P,k,D[O+7],Me,4249261313),k=U(k,x,A,P,D[O+8],_t,1770035416),P=U(P,k,x,A,D[O+9],Oe,2336552879),A=U(A,P,k,x,D[O+10],tt,4294925233),x=U(x,A,P,k,D[O+11],Me,2304563134),k=U(k,x,A,P,D[O+12],_t,1804603682),P=U(P,k,x,A,D[O+13],Oe,4254626195),A=U(A,P,k,x,D[O+14],tt,2792965006),x=U(x,A,P,k,D[O+15],Me,1236535329),k=q(k,x,A,P,D[O+1],X,4129170786),P=q(P,k,x,A,D[O+6],nt,3225465664),A=q(A,P,k,x,D[O+11],rt,643717713),x=q(x,A,P,k,D[O+0],Be,3921069994),k=q(k,x,A,P,D[O+5],X,3593408605),P=q(P,k,x,A,D[O+10],nt,38016083),A=q(A,P,k,x,D[O+15],rt,3634488961),x=q(x,A,P,k,D[O+4],Be,3889429448),k=q(k,x,A,P,D[O+9],X,568446438),P=q(P,k,x,A,D[O+14],nt,3275163606),A=q(A,P,k,x,D[O+3],rt,4107603335),x=q(x,A,P,k,D[O+8],Be,1163531501),k=q(k,x,A,P,D[O+13],X,2850285829),P=q(P,k,x,A,D[O+2],nt,4243563512),A=q(A,P,k,x,D[O+7],rt,1735328473),x=q(x,A,P,k,D[O+12],Be,2368359562),k=G(k,x,A,P,D[O+5],Ge,4294588738),P=G(P,k,x,A,D[O+8],ee,2272392833),A=G(A,P,k,x,D[O+11],K,1839030562),x=G(x,A,P,k,D[O+14],st,4259657740),k=G(k,x,A,P,D[O+1],Ge,2763975236),P=G(P,k,x,A,D[O+4],ee,1272893353),A=G(A,P,k,x,D[O+7],K,4139469664),x=G(x,A,P,k,D[O+10],st,3200236656),k=G(k,x,A,P,D[O+13],Ge,681279174),P=G(P,k,x,A,D[O+0],ee,3936430074),A=G(A,P,k,x,D[O+3],K,3572445317),x=G(x,A,P,k,D[O+6],st,76029189),k=G(k,x,A,P,D[O+9],Ge,3654602809),P=G(P,k,x,A,D[O+12],ee,3873151461),A=G(A,P,k,x,D[O+15],K,530742520),x=G(x,A,P,k,D[O+2],st,3299628645),k=z(k,x,A,P,D[O+0],We,4096336452),P=z(P,k,x,A,D[O+7],Ve,1126891415),A=z(A,P,k,x,D[O+14],Ke,2878612391),x=z(x,A,P,k,D[O+5],ze,4237533241),k=z(k,x,A,P,D[O+12],We,1700485571),P=z(P,k,x,A,D[O+3],Ve,2399980690),A=z(A,P,k,x,D[O+10],Ke,4293915773),x=z(x,A,P,k,D[O+1],ze,2240044497),k=z(k,x,A,P,D[O+8],We,1873313359),P=z(P,k,x,A,D[O+15],Ve,4264355552),A=z(A,P,k,x,D[O+6],Ke,2734768916),x=z(x,A,P,k,D[O+13],ze,1309151649),k=z(k,x,A,P,D[O+4],We,4149444226),P=z(P,k,x,A,D[O+11],Ve,3174756917),A=z(A,P,k,x,D[O+2],Ke,718787259),x=z(x,A,P,k,D[O+9],ze,3951481745),k=g(k,Ie),x=g(x,je),A=g(A,be),P=g(P,Q);var pt=ue(k)+ue(x)+ue(A)+ue(P);return pt.toLowerCase()},oe.closeMediaStream=function(p){if(p)try{var v;if(p.getTracks){v=p.getTracks();var g=a(v),S;try{for(g.s();!(S=g.n()).done;){var E=S.value;E.stop()}}catch(Y){g.e(Y)}finally{g.f()}}else{v=p.getAudioTracks();var N=a(v),L;try{for(N.s();!(L=N.n()).done;){var U=L.value;U.stop()}}catch(Y){N.e(Y)}finally{N.f()}v=p.getVideoTracks();var q=a(v),G;try{for(q.s();!(G=q.n()).done;){var z=G.value;z.stop()}}catch(Y){q.e(Y)}finally{q.f()}}}catch{(typeof p.stop=="function"||u(p.stop)==="object")&&p.stop()}},oe.cloneArray=function(p){return p&&p.slice()||[]},oe.cloneObject=function(p){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return p&&Object.assign({},p)||v},oe}var as={exports:{}},Tt=typeof Reflect=="object"?Reflect:null,ai=Tt&&typeof Tt.apply=="function"?Tt.apply:function(a,i,r){return Function.prototype.apply.call(a,i,r)},In;Tt&&typeof Tt.ownKeys=="function"?In=Tt.ownKeys:Object.getOwnPropertySymbols?In=function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))}:In=function(a){return Object.getOwnPropertyNames(a)};function $u(u){console&&console.warn&&console.warn(u)}var ha=Number.isNaN||function(a){return a!==a};function te(){te.init.call(this)}as.exports=te;as.exports.once=Gu;te.EventEmitter=te;te.prototype._events=void 0;te.prototype._eventsCount=0;te.prototype._maxListeners=void 0;var ui=10;function Xn(u){if(typeof u!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof u)}Object.defineProperty(te,"defaultMaxListeners",{enumerable:!0,get:function(){return ui},set:function(u){if(typeof u!="number"||u<0||ha(u))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+u+".");ui=u}});te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};te.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||ha(a))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this};function da(u){return u._maxListeners===void 0?te.defaultMaxListeners:u._maxListeners}te.prototype.getMaxListeners=function(){return da(this)};te.prototype.emit=function(a){for(var i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);var s=a==="error",c=this._events;if(c!==void 0)s=s&&c.error===void 0;else if(!s)return!1;if(s){var e;if(i.length>0&&(e=i[0]),e instanceof Error)throw e;var d=new Error("Unhandled error."+(e?" ("+e.message+")":""));throw d.context=e,d}var m=c[a];if(m===void 0)return!1;if(typeof m=="function")ai(m,this,i);else for(var f=m.length,p=ga(m,f),r=0;r<f;++r)ai(p[r],this,i);return!0};function _a(u,a,i,r){var s,c,e;if(Xn(i),c=u._events,c===void 0?(c=u._events=Object.create(null),u._eventsCount=0):(c.newListener!==void 0&&(u.emit("newListener",a,i.listener?i.listener:i),c=u._events),e=c[a]),e===void 0)e=c[a]=i,++u._eventsCount;else if(typeof e=="function"?e=c[a]=r?[i,e]:[e,i]:r?e.unshift(i):e.push(i),s=da(u),s>0&&e.length>s&&!e.warned){e.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+e.length+" "+String(a)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=u,d.type=a,d.count=e.length,$u(d)}return u}te.prototype.addListener=function(a,i){return _a(this,a,i,!1)};te.prototype.on=te.prototype.addListener;te.prototype.prependListener=function(a,i){return _a(this,a,i,!0)};function qu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function pa(u,a,i){var r={fired:!1,wrapFn:void 0,target:u,type:a,listener:i},s=qu.bind(r);return s.listener=i,r.wrapFn=s,s}te.prototype.once=function(a,i){return Xn(i),this.on(a,pa(this,a,i)),this};te.prototype.prependOnceListener=function(a,i){return Xn(i),this.prependListener(a,pa(this,a,i)),this};te.prototype.removeListener=function(a,i){var r,s,c,e,d;if(Xn(i),s=this._events,s===void 0)return this;if(r=s[a],r===void 0)return this;if(r===i||r.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete s[a],s.removeListener&&this.emit("removeListener",a,r.listener||i));else if(typeof r!="function"){for(c=-1,e=r.length-1;e>=0;e--)if(r[e]===i||r[e].listener===i){d=r[e].listener,c=e;break}if(c<0)return this;c===0?r.shift():ju(r,c),r.length===1&&(s[a]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",a,d||i)}return this};te.prototype.off=te.prototype.removeListener;te.prototype.removeAllListeners=function(a){var i,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[a]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[a]),this;if(arguments.length===0){var c=Object.keys(r),e;for(s=0;s<c.length;++s)e=c[s],e!=="removeListener"&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=r[a],typeof i=="function")this.removeListener(a,i);else if(i!==void 0)for(s=i.length-1;s>=0;s--)this.removeListener(a,i[s]);return this};function va(u,a,i){var r=u._events;if(r===void 0)return[];var s=r[a];return s===void 0?[]:typeof s=="function"?i?[s.listener||s]:[s]:i?Bu(s):ga(s,s.length)}te.prototype.listeners=function(a){return va(this,a,!0)};te.prototype.rawListeners=function(a){return va(this,a,!1)};te.listenerCount=function(u,a){return typeof u.listenerCount=="function"?u.listenerCount(a):ma.call(u,a)};te.prototype.listenerCount=ma;function ma(u){var a=this._events;if(a!==void 0){var i=a[u];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}te.prototype.eventNames=function(){return this._eventsCount>0?In(this._events):[]};function ga(u,a){for(var i=new Array(a),r=0;r<a;++r)i[r]=u[r];return i}function ju(u,a){for(;a+1<u.length;a++)u[a]=u[a+1];u.pop()}function Bu(u){for(var a=new Array(u.length),i=0;i<a.length;++i)a[i]=u[i].listener||u[i];return a}function Gu(u,a){return new Promise(function(i,r){function s(e){u.removeListener(a,c),r(e)}function c(){typeof u.removeListener=="function"&&u.removeListener("error",s),i([].slice.call(arguments))}ya(u,a,c,{once:!0}),a!=="error"&&Wu(u,s,{once:!0})})}function Wu(u,a,i){typeof u.on=="function"&&ya(u,"error",a,i)}function ya(u,a,i,r){if(typeof u.on=="function")r.once?u.once(a,i):u.on(a,i);else if(typeof u.addEventListener=="function")u.addEventListener(a,function s(c){r.once&&u.removeEventListener(a,s),i(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof u)}var et=as.exports,Vr={exports:{}},Rr,oi;function Vu(){if(oi)return Rr;oi=1;var u=1e3,a=u*60,i=a*60,r=i*24,s=r*7,c=r*365.25;Rr=function(p,v){v=v||{};var g=typeof p;if(g==="string"&&p.length>0)return e(p);if(g==="number"&&isFinite(p))return v.long?m(p):d(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))};function e(p){if(p=String(p),!(p.length>100)){var v=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(v){var g=parseFloat(v[1]),S=(v[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return g*c;case"weeks":case"week":case"w":return g*s;case"days":case"day":case"d":return g*r;case"hours":case"hour":case"hrs":case"hr":case"h":return g*i;case"minutes":case"minute":case"mins":case"min":case"m":return g*a;case"seconds":case"second":case"secs":case"sec":case"s":return g*u;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}function d(p){var v=Math.abs(p);return v>=r?Math.round(p/r)+"d":v>=i?Math.round(p/i)+"h":v>=a?Math.round(p/a)+"m":v>=u?Math.round(p/u)+"s":p+"ms"}function m(p){var v=Math.abs(p);return v>=r?f(p,v,r,"day"):v>=i?f(p,v,i,"hour"):v>=a?f(p,v,a,"minute"):v>=u?f(p,v,u,"second"):p+" ms"}function f(p,v,g,S){var E=v>=g*1.5;return Math.round(p/g)+" "+S+(E?"s":"")}return Rr}function Ku(u){i.debug=i,i.default=i,i.coerce=m,i.disable=c,i.enable=s,i.enabled=e,i.humanize=Vu(),i.destroy=f,Object.keys(u).forEach(p=>{i[p]=u[p]}),i.names=[],i.skips=[],i.formatters={};function a(p){let v=0;for(let g=0;g<p.length;g++)v=(v<<5)-v+p.charCodeAt(g),v|=0;return i.colors[Math.abs(v)%i.colors.length]}i.selectColor=a;function i(p){let v,g=null,S,E;function N(...L){if(!N.enabled)return;const U=N,q=Number(new Date),G=q-(v||q);U.diff=G,U.prev=v,U.curr=q,v=q,L[0]=i.coerce(L[0]),typeof L[0]!="string"&&L.unshift("%O");let z=0;L[0]=L[0].replace(/%([a-zA-Z%])/g,(ue,Z)=>{if(ue==="%%")return"%";z++;const D=i.formatters[Z];if(typeof D=="function"){const O=L[z];ue=D.call(U,O),L.splice(z,1),z--}return ue}),i.formatArgs.call(U,L),(U.log||i.log).apply(U,L)}return N.namespace=p,N.useColors=i.useColors(),N.color=i.selectColor(p),N.extend=r,N.destroy=i.destroy,Object.defineProperty(N,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(S!==i.namespaces&&(S=i.namespaces,E=i.enabled(p)),E),set:L=>{g=L}}),typeof i.init=="function"&&i.init(N),N}function r(p,v){const g=i(this.namespace+(typeof v>"u"?":":v)+p);return g.log=this.log,g}function s(p){i.save(p),i.namespaces=p,i.names=[],i.skips=[];let v;const g=(typeof p=="string"?p:"").split(/[\s,]+/),S=g.length;for(v=0;v<S;v++)g[v]&&(p=g[v].replace(/\*/g,".*?"),p[0]==="-"?i.skips.push(new RegExp("^"+p.slice(1)+"$")):i.names.push(new RegExp("^"+p+"$")))}function c(){const p=[...i.names.map(d),...i.skips.map(d).map(v=>"-"+v)].join(",");return i.enable(""),p}function e(p){if(p[p.length-1]==="*")return!0;let v,g;for(v=0,g=i.skips.length;v<g;v++)if(i.skips[v].test(p))return!1;for(v=0,g=i.names.length;v<g;v++)if(i.names[v].test(p))return!0;return!1}function d(p){return p.toString().substring(2,p.toString().length-2).replace(/\.\*\?$/,"*")}function m(p){return p instanceof Error?p.stack||p.message:p}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}var zu=Ku;(function(u,a){var i={};a.formatArgs=s,a.save=c,a.load=e,a.useColors=r,a.storage=d(),a.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),a.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+u.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;f.splice(1,0,p,"color: inherit");let v=0,g=0;f[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(v++,S==="%c"&&(g=v))}),f.splice(g,0,p)}a.log=console.debug||console.log||(()=>{});function c(f){try{f?a.storage.setItem("debug",f):a.storage.removeItem("debug")}catch{}}function e(){let f;try{f=a.storage.getItem("debug")}catch{}return!f&&typeof process<"u"&&"env"in process&&(f=i.DEBUG),f}function d(){try{return localStorage}catch{}}u.exports=zu(a);const{formatters:m}=u.exports;m.j=function(f){try{return JSON.stringify(f)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}})(Vr,Vr.exports);var us=Vr.exports;function Yu(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function fi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Ju(u,a,i){return a&&fi(u.prototype,a),i&&fi(u,i),u}var mt=us,gt="JsSIP",_e=function(){function u(a){Yu(this,u),a?(this._debug=mt.default("".concat(gt,":").concat(a)),this._warn=mt.default("".concat(gt,":WARN:").concat(a)),this._error=mt.default("".concat(gt,":ERROR:").concat(a))):(this._debug=mt.default(gt),this._warn=mt.default("".concat(gt,":WARN")),this._error=mt.default("".concat(gt,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return Ju(u,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),u}(),Ue={},Ta={},Sa={exports:{}},ci=Sa.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(u){return u.encoding?"rtpmap:%d %s/%s/%s":u.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(u){return u.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(u){return u.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(u){return"extmap:%d"+(u.direction?"/%s":"%v")+(u["encrypt-uri"]?" %s":"%v")+" %s"+(u.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(u){return u.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(u){var a="candidate:%s %d %s %d %s %d typ %s";return a+=u.raddr!=null?" raddr %s rport %d":"%v%v",a+=u.tcptype!=null?" tcptype %s":"%v",u.generation!=null&&(a+=" generation %d"),a+=u["network-id"]!=null?" network-id %d":"%v",a+=u["network-cost"]!=null?" network-cost %d":"%v",a}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(u){var a="ssrc:%d";return u.attribute!=null&&(a+=" %s",u.value!=null&&(a+=":%s")),a}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(u){return u.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(u){return u.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(u){return"imageattr:%s %s %s"+(u.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(u){return"simulcast:%s %s"+(u.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(u){return"ts-refclk:%s"+(u.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(u){var a="mediaclk:";return a+=u.id!=null?"id=%s %s":"%v%s",a+=u.mediaClockValue!=null?"=%s":"",a+=u.rateNumerator!=null?" rate=%s":"",a+=u.rateDenominator!=null?"/%s":"",a}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(ci).forEach(function(u){var a=ci[u];a.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})});var Ea=Sa.exports;(function(u){var a=function(d){return String(Number(d))===d?Number(d):d},i=function(d,m,f,p){if(p&&!f)m[p]=a(d[1]);else for(var v=0;v<f.length;v+=1)d[v+1]!=null&&(m[f[v]]=a(d[v+1]))},r=function(d,m,f){var p=d.name&&d.names;d.push&&!m[d.push]?m[d.push]=[]:p&&!m[d.name]&&(m[d.name]={});var v=d.push?{}:p?m[d.name]:m;i(f.match(d.reg),v,d.names,d.name),d.push&&m[d.push].push(v)},s=Ea,c=RegExp.prototype.test.bind(/^([a-z])=(.*)/);u.parse=function(d){var m={},f=[],p=m;return d.split(/(\r\n|\r|\n)/).filter(c).forEach(function(v){var g=v[0],S=v.slice(2);g==="m"&&(f.push({rtp:[],fmtp:[]}),p=f[f.length-1]);for(var E=0;E<(s[g]||[]).length;E+=1){var N=s[g][E];if(N.reg.test(S))return r(N,p,S)}}),m.media=f,m};var e=function(d,m){var f=m.split(/=(.+)/,2);return f.length===2?d[f[0]]=a(f[1]):f.length===1&&m.length>1&&(d[f[0]]=void 0),d};u.parseParams=function(d){return d.split(/;\s?/).reduce(e,{})},u.parseFmtpConfig=u.parseParams,u.parsePayloads=function(d){return d.toString().split(" ").map(Number)},u.parseRemoteCandidates=function(d){for(var m=[],f=d.split(" ").map(a),p=0;p<f.length;p+=3)m.push({component:f[p],ip:f[p+1],port:f[p+2]});return m},u.parseImageAttributes=function(d){return d.split(" ").map(function(m){return m.substring(1,m.length-1).split(",").reduce(e,{})})},u.parseSimulcastStreamList=function(d){return d.split(";").map(function(m){return m.split(",").map(function(f){var p,v=!1;return f[0]!=="~"?p=a(f):(p=a(f.substring(1,f.length)),v=!0),{scid:p,paused:v}})})}})(Ta);var wr=Ea,Xu=/%[sdv%]/g,Qu=function(u){var a=1,i=arguments,r=i.length;return u.replace(Xu,function(s){if(a>=r)return s;var c=i[a];switch(a+=1,s){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}})},kt=function(u,a,i){var r=a.format instanceof Function?a.format(a.push?i:i[a.name]):a.format,s=[u+"="+r];if(a.names)for(var c=0;c<a.names.length;c+=1){var e=a.names[c];a.name?s.push(i[a.name][e]):s.push(i[a.names[c]])}else s.push(i[a.name]);return Qu.apply(null,s)},Zu=["v","o","s","i","u","e","p","c","b","t","r","z","a"],eo=["i","c","b","a"],to=function(u,a){a=a||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(c){c.payloads==null&&(c.payloads="")});var i=a.outerOrder||Zu,r=a.innerOrder||eo,s=[];return i.forEach(function(c){wr[c].forEach(function(e){e.name in u&&u[e.name]!=null?s.push(kt(c,e,u)):e.push in u&&u[e.push]!=null&&u[e.push].forEach(function(d){s.push(kt(c,e,d))})})}),u.media.forEach(function(c){s.push(kt("m",wr.m[0],c)),r.forEach(function(e){wr[e].forEach(function(d){d.name in c&&c[d.name]!=null?s.push(kt(e,d,c)):d.push in c&&c[d.push]!=null&&c[d.push].forEach(function(m){s.push(kt(e,d,m))})})})}),s.join(`\r
`)+`\r
`},dt=Ta,no=to;Ue.write=no;Ue.parse=dt.parse;Ue.parseParams=dt.parseParams;Ue.parseFmtpConfig=dt.parseFmtpConfig;Ue.parsePayloads=dt.parsePayloads;Ue.parseRemoteCandidates=dt.parseRemoteCandidates;Ue.parseImageAttributes=dt.parseImageAttributes;Ue.parseSimulcastStreamList=dt.parseSimulcastStreamList;function On(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?On=function(i){return typeof i}:On=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},On(u)}function os(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&Kr(u,a)}function Kr(u,a){return Kr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Kr(u,a)}function fs(u){var a=lo();return function(){var r=Fn(u),s;if(a){var c=Fn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return ro(this,s)}}function ro(u,a){return a&&(On(a)==="object"||typeof a=="function")?a:so(u)}function so(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function lo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Fn(u){return Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Fn(u)}function Re(u,a){var i;if(typeof Symbol>"u"||u[Symbol.iterator]==null){if(Array.isArray(u)||(i=io(u))||a&&u&&typeof u.length=="number"){i&&(u=i);var r=0,s=function(){};return{s,n:function(){return r>=u.length?{done:!0}:{done:!1,value:u[r++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,e=!1,d;return{s:function(){i=u[Symbol.iterator]()},n:function(){var f=i.next();return c=f.done,f},e:function(f){e=!0,d=f},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(e)throw d}}}}function io(u,a){if(u){if(typeof u=="string")return hi(u,a);var i=Object.prototype.toString.call(u).slice(8,-1);if(i==="Object"&&u.constructor&&(i=u.constructor.name),i==="Map"||i==="Set")return Array.from(u);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return hi(u,a)}}function hi(u,a){(a==null||a>u.length)&&(a=u.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=u[i];return r}function Bt(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function di(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Qn(u,a,i){return a&&di(u.prototype,a),i&&di(u,i),u}var Ca=Ue,ao=_e,me=he,ce=ye(),_i=is(),uo=Pe(),Ir=new ao("SIPMessage"),ba=function(){function u(a,i,r,s,c,e){if(Bt(this,u),!a||!i||!r)return null;s=s||{},this.ua=r,this.headers={},this.method=a,this.ruri=i,this.body=e,this.extraHeaders=ce.cloneArray(c),this.ua.configuration.extra_headers&&(this.extraHeaders=this.extraHeaders.concat(this.ua.configuration.extra_headers)),s.route_set?this.setHeader("route",s.route_set):r.configuration.use_preloaded_route&&this.setHeader("route","<".concat(r.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",me.MAX_FORWARDS);var d=s.to_uri||i,m=s.to_tag?{tag:s.to_tag}:null,f=typeof s.to_display_name<"u"?s.to_display_name:null;this.to=new _i(d,f,m),this.setHeader("to",this.to.toString());var p=s.from_uri||r.configuration.uri,v={tag:s.from_tag||ce.newTag()},g;typeof s.from_display_name<"u"?g=s.from_display_name:r.configuration.display_name?g=r.configuration.display_name:g=null,this.from=new _i(p,g,v),this.setHeader("from",this.from.toString());var S=s.call_id||r.configuration.jssip_id+ce.createRandomToken(15);this.call_id=S,this.setHeader("call-id",S);var E=s.cseq||Math.floor(Math.random()*1e4);this.cseq=E,this.setHeader("cseq","".concat(E," ").concat(a))}return Qn(u,[{key:"setHeader",value:function(i,r){for(var s=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),c=0;c<this.extraHeaders.length;c++)s.test(this.extraHeaders[c])&&this.extraHeaders.splice(c,1);this.headers[ce.headerize(i)]=Array.isArray(r)?r:[r]}},{key:"getHeader",value:function(i){var r=this.headers[ce.headerize(i)];if(r){if(r[0])return r[0]}else{var s=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),c=Re(this.extraHeaders),e;try{for(c.s();!(e=c.n()).done;){var d=e.value;if(s.test(d))return d.substring(d.indexOf(":")+1).trim()}}catch(m){c.e(m)}finally{c.f()}}}},{key:"getHeaders",value:function(i){var r=this.headers[ce.headerize(i)],s=[];if(r){var c=Re(r),e;try{for(c.s();!(e=c.n()).done;){var d=e.value;s.push(d)}}catch(g){c.e(g)}finally{c.f()}return s}else{var m=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),f=Re(this.extraHeaders),p;try{for(f.s();!(p=f.n()).done;){var v=p.value;m.test(v)&&s.push(v.substring(v.indexOf(":")+1).trim())}}catch(g){f.e(g)}finally{f.f()}return s}}},{key:"hasHeader",value:function(i){if(this.headers[ce.headerize(i)])return!0;var r=new RegExp("^\\s*".concat(i,"\\s*:"),"i"),s=Re(this.extraHeaders),c;try{for(s.s();!(c=s.n()).done;){var e=c.value;if(r.test(e))return!0}}catch(d){s.e(d)}finally{s.f()}return!1}},{key:"parseSDP",value:function(i){return!i&&this.sdp?this.sdp:(this.sdp=Ca.parse(this.body||""),this.sdp)}},{key:"toString",value:function(){var i="".concat(this.method," ").concat(this.ruri,` SIP/2.0\r
`);for(var r in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,r)){var s=Re(this.headers[r]),c;try{for(s.s();!(c=s.n()).done;){var e=c.value;i+="".concat(r,": ").concat(e,`\r
`)}}catch(S){s.e(S)}finally{s.f()}}var d=Re(this.extraHeaders),m;try{for(d.s();!(m=d.n()).done;){var f=m.value;i+="".concat(f.trim(),`\r
`)}}catch(S){d.e(S)}finally{d.f()}var p=[];switch(this.method){case me.REGISTER:p.push("path","gruu");break;case me.INVITE:this.ua.configuration.session_timers&&p.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&p.push("gruu"),p.push("ice","replaces");break;case me.UPDATE:this.ua.configuration.session_timers&&p.push("timer"),p.push("ice");break}p.push("outbound");var v=this.ua.configuration.user_agent||me.USER_AGENT;if(i+="Allow: ".concat(me.ALLOWED_METHODS,`\r
`),i+="Supported: ".concat(p,`\r
`),i+="User-Agent: ".concat(v,`\r
`),this.body){var g=ce.str_utf8_length(this.body);i+="Content-Length: ".concat(g,`\r
\r
`),i+=this.body}else i+=`Content-Length: 0\r
\r
`;return i}},{key:"clone",value:function(){var i=new u(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(r){i.headers[r]=this.headers[r].slice()},this),i.body=this.body,i.extraHeaders=ce.cloneArray(this.extraHeaders),i.to=this.to,i.from=this.from,i.call_id=this.call_id,i.cseq=this.cseq,i}}]),u}(),oo=function(u){os(i,u);var a=fs(i);function i(r,s,c,e,d){var m;return Bt(this,i),m=a.call(this,me.INVITE,r,s,c,e,d),m.transaction=null,m}return Qn(i,[{key:"cancel",value:function(s){this.transaction.cancel(s)}},{key:"clone",value:function(){var s=new i(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(c){s.headers[c]=this.headers[c].slice()},this),s.body=this.body,s.extraHeaders=ce.cloneArray(this.extraHeaders),s.to=this.to,s.from=this.from,s.call_id=this.call_id,s.cseq=this.cseq,s.transaction=this.transaction,s}}]),i}(ba),Aa=function(){function u(){Bt(this,u),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}return Qn(u,[{key:"addHeader",value:function(i,r){var s={raw:r};i=ce.headerize(i),this.headers[i]?this.headers[i].push(s):this.headers[i]=[s]}},{key:"getHeader",value:function(i){var r=this.headers[ce.headerize(i)];if(r){if(r[0])return r[0].raw}else return}},{key:"getHeaders",value:function(i){var r=this.headers[ce.headerize(i)],s=[];if(!r)return[];var c=Re(r),e;try{for(c.s();!(e=c.n()).done;){var d=e.value;s.push(d.raw)}}catch(m){c.e(m)}finally{c.f()}return s}},{key:"hasHeader",value:function(i){return!!this.headers[ce.headerize(i)]}},{key:"parseHeader",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(i=ce.headerize(i),this.headers[i]){if(r>=this.headers[i].length){Ir.debug('not so many "'.concat(i,'" headers present'));return}}else{Ir.debug('header "'.concat(i,'" not present'));return}var s=this.headers[i][r],c=s.raw;if(s.parsed)return s.parsed;var e=uo.parse(c,i.replace(/-/g,"_"));if(e===-1){this.headers[i].splice(r,1),Ir.debug('error parsing "'.concat(i,'" header field with value "').concat(c,'"'));return}else return s.parsed=e,e}},{key:"s",value:function(i,r){return this.parseHeader(i,r)}},{key:"setHeader",value:function(i,r){var s={raw:r};this.headers[ce.headerize(i)]=[s]}},{key:"parseSDP",value:function(i){return!i&&this.sdp?this.sdp:(this.sdp=Ca.parse(this.body||""),this.sdp)}},{key:"toString",value:function(){return this.data}}]),u}(),fo=function(u){os(i,u);var a=fs(i);function i(r){var s;return Bt(this,i),s=a.call(this),s.ua=r,s.headers={},s.ruri=null,s.transport=null,s.server_transaction=null,s}return Qn(i,[{key:"reply",value:function(s,c,e,d,m,f){var p=[],v=this.getHeader("To");if(s=s||null,c=c||null,!s||s<100||s>699)throw new TypeError("Invalid status_code: ".concat(s));if(c&&typeof c!="string"&&!(c instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(c));c=c||me.REASON_PHRASE[s]||"",e=ce.cloneArray(e),this.ua.configuration.extra_headers&&(e=e.concat(this.ua.configuration.extra_headers));var g="SIP/2.0 ".concat(s," ").concat(c,`\r
`);if(this.method===me.INVITE&&s>100&&s<=200){var S=this.getHeaders("record-route"),E=Re(S),N;try{for(E.s();!(N=E.n()).done;){var L=N.value;g+="Record-Route: ".concat(L,`\r
`)}}catch(O){E.e(O)}finally{E.f()}}var U=this.getHeaders("via"),q=Re(U),G;try{for(q.s();!(G=q.n()).done;){var z=G.value;g+="Via: ".concat(z,`\r
`)}}catch(O){q.e(O)}finally{q.f()}!this.to_tag&&s>100?v+=";tag=".concat(ce.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(v+=";tag=".concat(this.to_tag)),g+="To: ".concat(v,`\r
`),g+="From: ".concat(this.getHeader("From"),`\r
`),g+="Call-ID: ".concat(this.call_id,`\r
`),g+="CSeq: ".concat(this.cseq," ").concat(this.method,`\r
`);var Y=Re(e),ue;try{for(Y.s();!(ue=Y.n()).done;){var Z=ue.value;g+="".concat(Z.trim(),`\r
`)}}catch(O){Y.e(O)}finally{Y.f()}switch(this.method){case me.INVITE:this.ua.configuration.session_timers&&p.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&p.push("gruu"),p.push("ice","replaces");break;case me.UPDATE:this.ua.configuration.session_timers&&p.push("timer"),d&&p.push("ice"),p.push("replaces")}if(p.push("outbound"),this.method===me.OPTIONS?(g+="Allow: ".concat(me.ALLOWED_METHODS,`\r
`),g+="Accept: ".concat(me.ACCEPTED_BODY_TYPES,`\r
`)):s===405?g+="Allow: ".concat(me.ALLOWED_METHODS,`\r
`):s===415&&(g+="Accept: ".concat(me.ACCEPTED_BODY_TYPES,`\r
`)),g+="Supported: ".concat(p,`\r
`),d){var D=ce.str_utf8_length(d);g+=`Content-Type: application/sdp\r
`,g+="Content-Length: ".concat(D,`\r
\r
`),g+=d}else g+="Content-Length: ".concat(0,`\r
\r
`);this.server_transaction.receiveResponse(s,g,m,f)}},{key:"reply_sl",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=this.getHeaders("via");if(!s||s<100||s>699)throw new TypeError("Invalid status_code: ".concat(s));if(c&&typeof c!="string"&&!(c instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(c));c=c||me.REASON_PHRASE[s]||"";var d="SIP/2.0 ".concat(s," ").concat(c,`\r
`),m=Re(e),f;try{for(m.s();!(f=m.n()).done;){var p=f.value;d+="Via: ".concat(p,`\r
`)}}catch(N){m.e(N)}finally{m.f()}var v=this.getHeader("To");if(!this.to_tag&&s>100?v+=";tag=".concat(ce.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(v+=";tag=".concat(this.to_tag)),d+="To: ".concat(v,`\r
`),d+="From: ".concat(this.getHeader("From"),`\r
`),d+="Call-ID: ".concat(this.call_id,`\r
`),d+="CSeq: ".concat(this.cseq," ").concat(this.method,`\r
`),this.ua.configuration.extra_headers){var g=Re(this.ua.configuration.extra_headers),S;try{for(g.s();!(S=g.n()).done;){var E=S.value;d+="".concat(E.trim(),`\r
`)}}catch(N){g.e(N)}finally{g.f()}}d+="Content-Length: ".concat(0,`\r
\r
`),this.transport.send(d)}}]),i}(Aa),co=function(u){os(i,u);var a=fs(i);function i(){var r;return Bt(this,i),r=a.call(this),r.headers={},r.status_code=null,r.reason_phrase=null,r}return i}(Aa),qe={OutgoingRequest:ba,InitialOutgoingInviteRequest:oo,IncomingRequest:fo,IncomingResponse:co};function ho(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function pi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function _o(u,a,i){return a&&pi(u.prototype,a),i&&pi(u,i),u}var po=_e,Le=ye(),we=new po("DigestAuthentication"),vo=function(){function u(a){ho(this,u),this._credentials=a,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}return _o(u,[{key:"get",value:function(i){switch(i){case"realm":return this._realm;case"ha1":return this._ha1;default:we.warn('get() | cannot get "%s" parameter',i);return}}},{key:"authenticate",value:function(i,r){var s=i.method,c=i.ruri,e=i.body,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(this._algorithm=r.algorithm,this._realm=r.realm,this._nonce=r.nonce,this._opaque=r.opaque,this._stale=r.stale,this._algorithm){if(this._algorithm!=="MD5")return we.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return we.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return we.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return we.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return we.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(r.qop)if(r.qop.indexOf("auth-int")>-1)this._qop="auth-int";else if(r.qop.indexOf("auth")>-1)this._qop="auth";else return we.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this._qop=null;this._method=s,this._uri=c,this._cnonce=d||Le.createRandomToken(12),this._nc+=1;var m=Number(this._nc).toString(16);this._ncHex="00000000".substr(0,8-m.length)+m,this._nc===4294967296&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=Le.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1;var f,p;return this._qop==="auth"?(f="".concat(this._method,":").concat(this._uri),p=Le.calculateMD5(f),we.debug('authenticate() | using qop=auth [a2:"%s"]',f),this._response=Le.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(p))):this._qop==="auth-int"?(f="".concat(this._method,":").concat(this._uri,":").concat(Le.calculateMD5(e||"")),p=Le.calculateMD5(f),we.debug('authenticate() | using qop=auth-int [a2:"%s"]',f),this._response=Le.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(p))):this._qop===null&&(f="".concat(this._method,":").concat(this._uri),p=Le.calculateMD5(f),we.debug('authenticate() | using qop=null [a2:"%s"]',f),this._response=Le.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(p))),we.debug("authenticate() | response generated"),!0}},{key:"toString",value:function(){var i=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return i.push("algorithm=".concat(this._algorithm)),i.push('username="'.concat(this._credentials.username,'"')),i.push('realm="'.concat(this._realm,'"')),i.push('nonce="'.concat(this._nonce,'"')),i.push('uri="'.concat(this._uri,'"')),i.push('response="'.concat(this._response,'"')),this._opaque&&i.push('opaque="'.concat(this._opaque,'"')),this._qop&&(i.push("qop=".concat(this._qop)),i.push('cnonce="'.concat(this._cnonce,'"')),i.push("nc=".concat(this._ncHex))),"Digest ".concat(i.join(", "))}}]),u}(),Fe=500,mo=4e3,vi=5e3,Ra={T1:Fe,T2:mo,T4:vi,TIMER_B:64*Fe,TIMER_D:0*Fe,TIMER_F:64*Fe,TIMER_H:64*Fe,TIMER_I:0*Fe,TIMER_J:0*Fe,TIMER_K:0*vi,TIMER_L:64*Fe,TIMER_M:64*Fe,PROVISIONAL_RESPONSE_INTERVAL:6e4};function Nn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Nn=function(i){return typeof i}:Nn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Nn(u)}function Gt(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function mi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Wt(u,a,i){return a&&mi(u.prototype,a),i&&mi(u,i),u}function Vt(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&zr(u,a)}function zr(u,a){return zr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},zr(u,a)}function Kt(u){var a=yo();return function(){var r=$n(u),s;if(a){var c=$n(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return go(this,s)}}function go(u,a){return a&&(Nn(a)==="object"||typeof a=="function")?a:Xe(u)}function Xe(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function yo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function $n(u){return $n=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},$n(u)}var zt=et.EventEmitter,Yt=_e,Ft=he,gi=qe,xe=Ra,yi=new Yt("NonInviteClientTransaction"),_n=new Yt("InviteClientTransaction"),To=new Yt("AckClientTransaction"),Ti=new Yt("NonInviteServerTransaction"),pn=new Yt("InviteServerTransaction"),H={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},So=function(u){Vt(i,u);var a=Kt(i);function i(r,s,c,e){var d;Gt(this,i),d=a.call(this),d.type=H.NON_INVITE_CLIENT,d.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),d.ua=r,d.transport=s,d.request=c,d.eventHandlers=e;var m="SIP/2.0/".concat(s.via_transport);return m+=" ".concat(r.configuration.via_host,";branch=").concat(d.id),d.request.setHeader("via",m),d.ua.newTransaction(Xe(d)),d}return Wt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"send",value:function(){var s=this;this.stateChanged(H.STATUS_TRYING),this.F=setTimeout(function(){s.timer_F()},xe.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){yi.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){yi.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(s){var c=this,e=s.status_code;if(e<200)switch(this.state){case H.STATUS_TRYING:case H.STATUS_PROCEEDING:this.stateChanged(H.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(s);break}else switch(this.state){case H.STATUS_TRYING:case H.STATUS_PROCEEDING:this.stateChanged(H.STATUS_COMPLETED),clearTimeout(this.F),e===408?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(s),this.K=setTimeout(function(){c.timer_K()},xe.TIMER_K);break;case H.STATUS_COMPLETED:break}}},{key:"C",get:function(){return H}}]),i}(zt),Eo=function(u){Vt(i,u);var a=Kt(i);function i(r,s,c,e){var d;Gt(this,i),d=a.call(this),d.type=H.INVITE_CLIENT,d.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),d.ua=r,d.transport=s,d.request=c,d.eventHandlers=e,c.transaction=Xe(d);var m="SIP/2.0/".concat(s.via_transport);return m+=" ".concat(r.configuration.via_host,";branch=").concat(d.id),d.request.setHeader("via",m),d.ua.newTransaction(Xe(d)),d}return Wt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"send",value:function(){var s=this;this.stateChanged(H.STATUS_CALLING),this.B=setTimeout(function(){s.timer_B()},xe.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==H.STATUS_ACCEPTED&&(_n.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){_n.debug("Timer M expired for transaction ".concat(this.id)),this.state===H.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){_n.debug("Timer B expired for transaction ".concat(this.id)),this.state===H.STATUS_CALLING&&(this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){_n.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(s){var c=this,e=new gi.OutgoingRequest(Ft.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});e.setHeader("from",this.request.getHeader("from")),e.setHeader("via",this.request.getHeader("via")),e.setHeader("to",s.getHeader("to")),this.D=setTimeout(function(){c.timer_D()},xe.TIMER_D),this.transport.send(e)}},{key:"cancel",value:function(s){if(this.state===H.STATUS_PROCEEDING){var c=new gi.OutgoingRequest(Ft.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});c.setHeader("from",this.request.getHeader("from")),c.setHeader("via",this.request.getHeader("via")),c.setHeader("to",this.request.getHeader("to")),s&&c.setHeader("reason",s),this.transport.send(c)}}},{key:"receiveResponse",value:function(s){var c=this,e=s.status_code;if(e>=100&&e<=199)switch(this.state){case H.STATUS_CALLING:this.stateChanged(H.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(s);break;case H.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(s);break}else if(e>=200&&e<=299)switch(this.state){case H.STATUS_CALLING:case H.STATUS_PROCEEDING:this.stateChanged(H.STATUS_ACCEPTED),this.M=setTimeout(function(){c.timer_M()},xe.TIMER_M),this.eventHandlers.onReceiveResponse(s);break;case H.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(s);break}else if(e>=300&&e<=699)switch(this.state){case H.STATUS_CALLING:case H.STATUS_PROCEEDING:this.stateChanged(H.STATUS_COMPLETED),this.sendACK(s),this.eventHandlers.onReceiveResponse(s);break;case H.STATUS_COMPLETED:this.sendACK(s);break}}},{key:"C",get:function(){return H}}]),i}(zt),Co=function(u){Vt(i,u);var a=Kt(i);function i(r,s,c,e){var d;Gt(this,i),d=a.call(this),d.id="z9hG4bK".concat(Math.floor(Math.random()*1e7)),d.transport=s,d.request=c,d.eventHandlers=e;var m="SIP/2.0/".concat(s.via_transport);return m+=" ".concat(r.configuration.via_host,";branch=").concat(d.id),d.request.setHeader("via",m),d}return Wt(i,[{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){To.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}},{key:"C",get:function(){return H}}]),i}(zt),bo=function(u){Vt(i,u);var a=Kt(i);function i(r,s,c){var e;return Gt(this,i),e=a.call(this),e.type=H.NON_INVITE_SERVER,e.id=c.via_branch,e.ua=r,e.transport=s,e.request=c,e.last_response="",c.server_transaction=Xe(e),e.state=H.STATUS_TRYING,r.newTransaction(Xe(e)),e}return Wt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"timer_J",value:function(){Ti.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,Ti.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.J),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(s,c,e,d){var m=this;if(s===100)switch(this.state){case H.STATUS_TRYING:this.stateChanged(H.STATUS_PROCEEDING),this.transport.send(c)||this.onTransportError();break;case H.STATUS_PROCEEDING:this.last_response=c,this.transport.send(c)?e&&e():(this.onTransportError(),d&&d());break}else if(s>=200&&s<=699)switch(this.state){case H.STATUS_TRYING:case H.STATUS_PROCEEDING:this.stateChanged(H.STATUS_COMPLETED),this.last_response=c,this.J=setTimeout(function(){m.timer_J()},xe.TIMER_J),this.transport.send(c)?e&&e():(this.onTransportError(),d&&d());break;case H.STATUS_COMPLETED:break}}},{key:"C",get:function(){return H}}]),i}(zt),Ao=function(u){Vt(i,u);var a=Kt(i);function i(r,s,c){var e;return Gt(this,i),e=a.call(this),e.type=H.INVITE_SERVER,e.id=c.via_branch,e.ua=r,e.transport=s,e.request=c,e.last_response="",c.server_transaction=Xe(e),e.state=H.STATUS_PROCEEDING,r.newTransaction(Xe(e)),e.resendProvisionalTimer=null,c.reply(100),e}return Wt(i,[{key:"stateChanged",value:function(s){this.state=s,this.emit("stateChanged")}},{key:"timer_H",value:function(){pn.debug("Timer H expired for transaction ".concat(this.id)),this.state===H.STATUS_COMPLETED&&pn.debug("ACK not received, dialog will be terminated"),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_L",value:function(){pn.debug("Timer L expired for transaction ".concat(this.id)),this.state===H.STATUS_ACCEPTED&&(this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,pn.debug("transport error occurred, deleting transaction ".concat(this.id)),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(H.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(s,c,e,d){var m=this;if(s>=100&&s<=199)switch(this.state){case H.STATUS_PROCEEDING:this.transport.send(c)||this.onTransportError(),this.last_response=c;break}if(s>100&&s<=199&&this.state===H.STATUS_PROCEEDING)this.resendProvisionalTimer===null&&(this.resendProvisionalTimer=setInterval(function(){m.resend_provisional()},xe.PROVISIONAL_RESPONSE_INTERVAL));else if(s>=200&&s<=299)switch(this.state){case H.STATUS_PROCEEDING:this.stateChanged(H.STATUS_ACCEPTED),this.last_response=c,this.L=setTimeout(function(){m.timer_L()},xe.TIMER_L),this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case H.STATUS_ACCEPTED:this.transport.send(c)?e&&e():(this.onTransportError(),d&&d());break}else if(s>=300&&s<=699)switch(this.state){case H.STATUS_PROCEEDING:this.resendProvisionalTimer!==null&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(c)?(this.stateChanged(H.STATUS_COMPLETED),this.H=setTimeout(function(){m.timer_H()},xe.TIMER_H),e&&e()):(this.onTransportError(),d&&d());break}}},{key:"C",get:function(){return H}}]),i}(zt);function Ro(u,a){var i=u._transactions,r;switch(a.method){case Ft.INVITE:if(r=i.ist[a.via_branch],r){switch(r.state){case H.STATUS_PROCEEDING:r.transport.send(r.last_response);break;case H.STATUS_ACCEPTED:break}return!0}break;case Ft.ACK:if(r=i.ist[a.via_branch],r){if(r.state===H.STATUS_ACCEPTED)return!1;if(r.state===H.STATUS_COMPLETED)return r.state=H.STATUS_CONFIRMED,r.I=setTimeout(function(){r.timer_I()},xe.TIMER_I),!0}else return!1;break;case Ft.CANCEL:return r=i.ist[a.via_branch],r?(a.reply_sl(200),r.state!==H.STATUS_PROCEEDING):(a.reply_sl(481),!0);default:if(r=i.nist[a.via_branch],r){switch(r.state){case H.STATUS_TRYING:break;case H.STATUS_PROCEEDING:case H.STATUS_COMPLETED:r.transport.send(r.last_response);break}return!0}break}}var Jt={C:H,NonInviteClientTransaction:So,InviteClientTransaction:Eo,AckClientTransaction:Co,NonInviteServerTransaction:bo,InviteServerTransaction:Ao,checkTransaction:Ro};function wo(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Si(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Io(u,a,i){return a&&Si(u.prototype,a),i&&Si(u,i),u}var Oo=_e,Ei=he,No=vo,Or=Jt,ko=new Oo("RequestSender"),Nr={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}},Xt=function(){function u(a,i,r){wo(this,u),this._ua=a,this._eventHandlers=r,this._method=i.method,this._request=i,this._auth=null,this._challenged=!1,this._staled=!1;for(var s in Nr)Object.prototype.hasOwnProperty.call(Nr,s)&&(this._eventHandlers[s]||(this._eventHandlers[s]=Nr[s]));a.status===a.C.STATUS_USER_CLOSED&&(this._method!==Ei.BYE||this._method!==Ei.ACK)&&this._eventHandlers.onTransportError()}return Io(u,[{key:"send",value:function(){var i=this,r={onRequestTimeout:function(){i._eventHandlers.onRequestTimeout()},onTransportError:function(){i._eventHandlers.onTransportError()},onReceiveResponse:function(c){i._receiveResponse(c)}};switch(this._method){case"INVITE":this.clientTransaction=new Or.InviteClientTransaction(this._ua,this._ua.transport,this._request,r);break;case"ACK":this.clientTransaction=new Or.AckClientTransaction(this._ua,this._ua.transport,this._request,r);break;default:this.clientTransaction=new Or.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,r)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}},{key:"_receiveResponse",value:function(i){var r,s,c=i.status_code;if((c===401||c===407)&&(this._ua.configuration.password!==null||this._ua.configuration.ha1!==null)){if(i.status_code===401?(r=i.parseHeader("www-authenticate"),s="authorization"):(r=i.parseHeader("proxy-authenticate"),s="proxy-authorization"),!r){ko.debug("".concat(i.status_code," with wrong or missing challenge, cannot authenticate")),this._eventHandlers.onReceiveResponse(i);return}if(!this._challenged||!this._staled&&r.stale===!0){if(this._auth||(this._auth=new No({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,r)){this._eventHandlers.onReceiveResponse(i);return}this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),r.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(s,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(i)}else this._eventHandlers.onReceiveResponse(i)}}]),u}();function Do(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Ci(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function xo(u,a,i){return a&&Ci(u.prototype,a),i&&Ci(u,i),u}var Po=_e,kr=ye(),ut=he,bi=qe,Ai=Xt,Dt=new Po("Registrator"),vn=10,Uo=function(){function u(a,i){Do(this,u),this._reg_id=1,this._ua=a,this._transport=i,this._registrar=a.configuration.registrar_server,this._expires=a.configuration.register_expires,this._call_id=kr.createRandomToken(22),this._cseq=0,this._to_uri=a.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance)}return xo(u,[{key:"setExtraHeaders",value:function(i){Array.isArray(i)||(i=[]),this._extraHeaders=i.slice()}},{key:"setExtraContactParams",value:function(i){i instanceof Object||(i={}),this._extraContactParams="";for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)){var s=i[r];this._extraContactParams+=";".concat(r),s&&(this._extraContactParams+="=".concat(s))}}},{key:"register",value:function(){var i=this;if(this._registering){Dt.debug("Register request in progress...");return}var r=this._extraHeaders.slice();r.push("Contact: ".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams)),r.push("Expires: ".concat(this._expires));var s=new bi.OutgoingRequest(ut.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},r),c=new Ai(this._ua,s,{onRequestTimeout:function(){i._registrationFailure(null,ut.causes.REQUEST_TIMEOUT)},onTransportError:function(){i._registrationFailure(null,ut.causes.CONNECTION_ERROR)},onAuthenticated:function(){i._cseq+=1},onReceiveResponse:function(d){if(d.cseq===i._cseq)switch(i._registrationTimer!==null&&(clearTimeout(i._registrationTimer),i._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(d.status_code):break;case/^2[0-9]{2}$/.test(d.status_code):{if(i._registering=!1,!d.hasHeader("Contact")){Dt.debug("no Contact header in response to REGISTER, response ignored");break}var m=d.headers.Contact.reduce(function(S,E){return S.concat(E.parsed)},[]),f=m.find(function(S){return i._sipInstance===S.getParam("+sip.instance")&&i._reg_id===parseInt(S.getParam("reg-id"))});if(f||(f=m.find(function(S){return S.uri.user===i._ua.contact.uri.user})),!f){Dt.debug("no Contact header pointing to us, response ignored");break}var p=f.getParam("expires");!p&&d.hasHeader("expires")&&(p=d.getHeader("expires")),p||(p=i._expires),p=Number(p),p<vn&&(p=vn);var v=p>64?p*1e3/2+Math.floor((p/2-32)*1e3*Math.random()):p*1e3-5e3;i._registrationTimer=setTimeout(function(){i._registrationTimer=null,i._ua.listeners("registrationExpiring").length===0?i.register():i._ua.emit("registrationExpiring")},v),f.hasParam("temp-gruu")&&(i._ua.contact.temp_gruu=f.getParam("temp-gruu").replace(/"/g,"")),f.hasParam("pub-gruu")&&(i._ua.contact.pub_gruu=f.getParam("pub-gruu").replace(/"/g,"")),i._registered||(i._registered=!0,i._ua.registered({response:d}));break}case/^423$/.test(d.status_code):{d.hasHeader("min-expires")?(i._expires=Number(d.getHeader("min-expires")),i._expires<vn&&(i._expires=vn),i.register()):(Dt.debug("423 response received for REGISTER without Min-Expires"),i._registrationFailure(d,ut.causes.SIP_FAILURE_CODE));break}default:{var g=kr.sipErrorCause(d.status_code);i._registrationFailure(d,g)}}}});this._registering=!0,c.send()}},{key:"unregister",value:function(){var i=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this._registered){Dt.debug("already unregistered");return}this._registered=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);var s=this._extraHeaders.slice();r.all?s.push("Contact: *".concat(this._extraContactParams)):s.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),s.push("Expires: 0");var c=new bi.OutgoingRequest(ut.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},s),e=new Ai(this._ua,c,{onRequestTimeout:function(){i._unregistered(null,ut.causes.REQUEST_TIMEOUT)},onTransportError:function(){i._unregistered(null,ut.causes.CONNECTION_ERROR)},onAuthenticated:function(){i._cseq+=1},onReceiveResponse:function(m){switch(!0){case/^1[0-9]{2}$/.test(m.status_code):break;case/^2[0-9]{2}$/.test(m.status_code):i._unregistered(m);break;default:{var f=kr.sipErrorCause(m.status_code);i._unregistered(m,f)}}}});e.send()}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,this._registrationTimer!==null&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(i,r){this._registering=!1,this._ua.registrationFailed({response:i||null,cause:r}),this._registered&&(this._registered=!1,this._ua.unregistered({response:i||null,cause:r}))}},{key:"_unregistered",value:function(i,r){this._registering=!1,this._registered=!1,this._ua.unregistered({response:i||null,cause:r||null})}},{key:"registered",get:function(){return this._registered}}]),u}();function Mo(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Ri(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Ho(u,a,i){return a&&Ri(u.prototype,a),i&&Ri(u,i),u}var Dr=he,mn=Jt,Lo=Xt,xr={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}},Fo=function(){function u(a,i,r){Mo(this,u),this._dialog=a,this._ua=a._ua,this._request=i,this._eventHandlers=r,this._reattempt=!1,this._reattemptTimer=null;for(var s in xr)Object.prototype.hasOwnProperty.call(xr,s)&&(this._eventHandlers[s]||(this._eventHandlers[s]=xr[s]))}return Ho(u,[{key:"send",value:function(){var i=this,r=new Lo(this._ua,this._request,{onRequestTimeout:function(){i._eventHandlers.onRequestTimeout()},onTransportError:function(){i._eventHandlers.onTransportError()},onAuthenticated:function(e){i._eventHandlers.onAuthenticated(e)},onReceiveResponse:function(e){i._receiveResponse(e)}});if(r.send(),(this._request.method===Dr.INVITE||this._request.method===Dr.UPDATE&&this._request.body)&&r.clientTransaction.state!==mn.C.STATUS_TERMINATED){this._dialog.uac_pending_reply=!0;var s=function c(){(r.clientTransaction.state===mn.C.STATUS_ACCEPTED||r.clientTransaction.state===mn.C.STATUS_COMPLETED||r.clientTransaction.state===mn.C.STATUS_TERMINATED)&&(r.clientTransaction.removeListener("stateChanged",c),i._dialog.uac_pending_reply=!1)};r.clientTransaction.on("stateChanged",s)}}},{key:"_receiveResponse",value:function(i){var r=this;i.status_code===408||i.status_code===481?this._eventHandlers.onDialogError(i):i.method===Dr.INVITE&&i.status_code===491?this._reattempt?i.status_code>=200&&i.status_code<300?this._eventHandlers.onSuccessResponse(i):i.status_code>=300&&this._eventHandlers.onErrorResponse(i):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(function(){r._dialog.isTerminated()||(r._reattempt=!0,r.send())},1e3)):i.status_code>=200&&i.status_code<300?this._eventHandlers.onSuccessResponse(i):i.status_code>=300&&this._eventHandlers.onErrorResponse(i)}},{key:"request",get:function(){return this._request}}]),u}();function $o(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function wi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Ii(u,a,i){return a&&wi(u.prototype,a),i&&wi(u,i),u}var qo=_e,Oi=qe,Ye=he,xt=Jt,jo=Fo,Pr=ye(),Ur=new qo("Dialog"),Je={STATUS_EARLY:1,STATUS_CONFIRMED:2,STATUS_TERMINATED:3},Bo=function(){Ii(u,null,[{key:"C",get:function(){return Je}}]);function u(a,i,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Je.STATUS_CONFIRMED;if($o(this,u),this._owner=a,this._ua=a._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!i.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};i instanceof Oi.IncomingResponse&&(s=i.status_code<200?Je.STATUS_EARLY:Je.STATUS_CONFIRMED);var c=i.parseHeader("contact");r==="UAS"?(this._id={call_id:i.call_id,local_tag:i.to_tag,remote_tag:i.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=s,this._remote_seqnum=i.cseq,this._local_uri=i.parseHeader("to").uri,this._remote_uri=i.parseHeader("from").uri,this._remote_target=c.uri,this._route_set=i.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):r==="UAC"&&(this._id={call_id:i.call_id,local_tag:i.from_tag,remote_tag:i.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=s,this._local_seqnum=i.cseq,this._local_uri=i.parseHeader("from").uri,this._remote_uri=i.parseHeader("to").uri,this._remote_target=c.uri,this._route_set=i.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),Ur.debug("new ".concat(r," dialog created with status ").concat(this._state===Je.STATUS_EARLY?"EARLY":"CONFIRMED"))}return Ii(u,[{key:"isTerminated",value:function(){return this._status===Je.STATUS_TERMINATED}},{key:"update",value:function(i,r){this._state=Je.STATUS_CONFIRMED,Ur.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),r==="UAC"&&(this._route_set=i.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){Ur.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this),this._state=Je.STATUS_TERMINATED}},{key:"sendRequest",value:function(i){var r=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=Pr.cloneArray(s.extraHeaders),e=Pr.cloneObject(s.eventHandlers),d=s.body||null,m=this._createRequest(i,c,d);e.onAuthenticated=function(){r._local_seqnum+=1};var f=new jo(this,m,e);return f.send(),m}},{key:"receiveRequest",value:function(i){this._checkInDialogRequest(i)&&(i.method===Ye.ACK&&this._ack_seqnum!==null?this._ack_seqnum=null:i.method===Ye.INVITE&&(this._ack_seqnum=i.cseq),this._owner.receiveRequest(i))}},{key:"_createRequest",value:function(i,r,s){r=Pr.cloneArray(r),this._local_seqnum||(this._local_seqnum=Math.floor(Math.random()*1e4));var c=i===Ye.CANCEL||i===Ye.ACK?this._local_seqnum:this._local_seqnum+=1,e=new Oi.OutgoingRequest(i,this._remote_target,this._ua,{cseq:c,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},r,s);return e}},{key:"_checkInDialogRequest",value:function(i){var r=this;if(!this._remote_seqnum)this._remote_seqnum=i.cseq;else if(i.cseq<this._remote_seqnum)if(i.method===Ye.ACK){if(this._ack_seqnum===null||i.cseq!==this._ack_seqnum)return!1}else return i.reply(500),!1;else i.cseq>this._remote_seqnum&&(this._remote_seqnum=i.cseq);if(i.method===Ye.INVITE||i.method===Ye.UPDATE&&i.body){if(this._uac_pending_reply===!0)i.reply(491);else if(this._uas_pending_reply===!0){var s=(Math.random()*10|0)+1;return i.reply(500,null,["Retry-After:".concat(s)]),!1}else{this._uas_pending_reply=!0;var c=function e(){(i.server_transaction.state===xt.C.STATUS_ACCEPTED||i.server_transaction.state===xt.C.STATUS_COMPLETED||i.server_transaction.state===xt.C.STATUS_TERMINATED)&&(i.server_transaction.removeListener("stateChanged",e),r._uas_pending_reply=!1)};i.server_transaction.on("stateChanged",c)}i.hasHeader("contact")&&i.server_transaction.on("stateChanged",function(){i.server_transaction.state===xt.C.STATUS_ACCEPTED&&(r._remote_target=i.parseHeader("contact").uri)})}else i.method===Ye.NOTIFY&&i.hasHeader("contact")&&i.server_transaction.on("stateChanged",function(){i.server_transaction.state===xt.C.STATUS_COMPLETED&&(r._remote_target=i.parseHeader("contact").uri)});return!0}},{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(i){this._local_seqnum=i}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(i){this._uac_pending_reply=i}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}}]),u}(),cs={exports:{}};function kn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?kn=function(i){return typeof i}:kn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},kn(u)}function Go(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Ni(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Wo(u,a,i){return a&&Ni(u.prototype,a),i&&Ni(u,i),u}function Vo(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&Yr(u,a)}function Yr(u,a){return Yr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Yr(u,a)}function Ko(u){var a=Jo();return function(){var r=qn(u),s;if(a){var c=qn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return zo(this,s)}}function zo(u,a){return a&&(kn(a)==="object"||typeof a=="function")?a:Yo(u)}function Yo(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function Jo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function qn(u){return qn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},qn(u)}var Xo=et.EventEmitter,Qo=_e,Zo=he,ef=Qe,ki=ye(),tf=new Qo("RTCSession:DTMF"),wa={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};cs.exports=function(u){Vo(i,u);var a=Ko(i);function i(r){var s;return Go(this,i),s=a.call(this),s._session=r,s._direction=null,s._tone=null,s._duration=null,s._request=null,s}return Wo(i,[{key:"send",value:function(s){var c=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(s===void 0)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new ef.InvalidStateError(this._session.status);var d=ki.cloneArray(e.extraHeaders);if(this.eventHandlers=ki.cloneObject(e.eventHandlers),typeof s=="string")s=s.toUpperCase();else if(typeof s=="number")s=s.toString();else throw new TypeError("Invalid tone: ".concat(s));if(s.match(/^[0-9A-DR#*]$/))this._tone=s;else throw new TypeError("Invalid tone: ".concat(s));this._duration=e.duration,d.push("Content-Type: application/dtmf-relay");var m="Signal=".concat(this._tone,`\r
`);m+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(Zo.INFO,{extraHeaders:d,eventHandlers:{onSuccessResponse:function(p){c.emit("succeeded",{originator:"remote",response:p})},onErrorResponse:function(p){c.eventHandlers.onFailed&&c.eventHandlers.onFailed(),c.emit("failed",{originator:"remote",response:p})},onRequestTimeout:function(){c._session.onRequestTimeout()},onTransportError:function(){c._session.onTransportError()},onDialogError:function(){c._session.onDialogError()}},body:m})}},{key:"init_incoming",value:function(s){var c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,e=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",this._request=s,s.reply(200),s.body){var d=s.body.split(`
`);d.length>=1&&c.test(d[0])&&(this._tone=d[0].replace(c,"$2")),d.length>=2&&e.test(d[1])&&(this._duration=parseInt(d[1].replace(e,"$2"),10))}this._duration||(this._duration=wa.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:s}):tf.debug("invalid INFO DTMF received, discarded")}},{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}}]),i}(Xo);cs.exports.C=wa;var nf=cs.exports;function Dn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Dn=function(i){return typeof i}:Dn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Dn(u)}function rf(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Di(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function sf(u,a,i){return a&&Di(u.prototype,a),i&&Di(u,i),u}function lf(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&Jr(u,a)}function Jr(u,a){return Jr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Jr(u,a)}function af(u){var a=ff();return function(){var r=jn(u),s;if(a){var c=jn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return uf(this,s)}}function uf(u,a){return a&&(Dn(a)==="object"||typeof a=="function")?a:of(u)}function of(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function ff(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function jn(u){return jn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},jn(u)}var cf=et.EventEmitter,hf=he,df=Qe,_f=ye(),pf=function(u){lf(i,u);var a=af(i);function i(r){var s;return rf(this,i),s=a.call(this),s._session=r,s._direction=null,s._contentType=null,s._body=null,s}return sf(i,[{key:"send",value:function(s,c){var e=this,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._direction="outgoing",s===void 0)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new df.InvalidStateError(this._session.status);this._contentType=s,this._body=c;var m=_f.cloneArray(d.extraHeaders);m.push("Content-Type: ".concat(s)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(hf.INFO,{extraHeaders:m,eventHandlers:{onSuccessResponse:function(p){e.emit("succeeded",{originator:"remote",response:p})},onErrorResponse:function(p){e.emit("failed",{originator:"remote",response:p})},onTransportError:function(){e._session.onTransportError()},onRequestTimeout:function(){e._session.onRequestTimeout()},onDialogError:function(){e._session.onDialogError()}},body:c})}},{key:"init_incoming",value:function(s){this._direction="incoming",this.request=s,s.reply(200),this._contentType=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0,this._body=s.body,this._session.newInfo({originator:"remote",info:this,request:s})}},{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}}]),i}(cf);function vf(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function xi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function mf(u,a,i){return a&&xi(u.prototype,a),i&&xi(u,i),u}var gf=_e,Pi=he,yf=new gf("RTCSession:ReferNotifier"),Mr={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},Tf=function(){function u(a,i,r){vf(this,u),this._session=a,this._id=i,this._expires=r||Mr.expires,this._active=!0,this.notify(100)}return mf(u,[{key:"notify",value:function(i,r){if(yf.debug("notify()"),this._active!==!1){r=r||Pi.REASON_PHRASE[i]||"";var s;i>=200?s="terminated;reason=noresource":s="active;expires=".concat(this._expires),this._session.sendRequest(Pi.NOTIFY,{extraHeaders:["Event: ".concat(Mr.event_type,";id=").concat(this._id),"Subscription-State: ".concat(s),"Content-Type: ".concat(Mr.body_type)],body:"SIP/2.0 ".concat(i," ").concat(r),eventHandlers:{onErrorResponse:function(){this._active=!1}}})}}}]),u}();function xn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xn=function(i){return typeof i}:xn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},xn(u)}function Sf(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Ui(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Ef(u,a,i){return a&&Ui(u.prototype,a),i&&Ui(u,i),u}function Cf(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&Xr(u,a)}function Xr(u,a){return Xr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Xr(u,a)}function bf(u){var a=wf();return function(){var r=Bn(u),s;if(a){var c=Bn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return Af(this,s)}}function Af(u,a){return a&&(xn(a)==="object"||typeof a=="function")?a:Rf(u)}function Rf(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function wf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Bn(u){return Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Bn(u)}var If=et.EventEmitter,Of=_e,Pt=he,Nf=Pe(),Mi=ye(),ot=new Of("RTCSession:ReferSubscriber"),kf=function(u){Cf(i,u);var a=bf(i);function i(r){var s;return Sf(this,i),s=a.call(this),s._id=null,s._session=r,s}return Ef(i,[{key:"sendRefer",value:function(s){var c=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ot.debug("sendRefer()");var d=Mi.cloneArray(e.extraHeaders),m=Mi.cloneObject(e.eventHandlers);for(var f in m)Object.prototype.hasOwnProperty.call(m,f)&&this.on(f,m[f]);var p=null;e.replaces&&(p=e.replaces._request.call_id,p+=";to-tag=".concat(e.replaces._to_tag),p+=";from-tag=".concat(e.replaces._from_tag),p=encodeURIComponent(p));var v="Refer-To: <".concat(s).concat(p?"?Replaces=".concat(p):"",">");if(d.push(v),!d.some(function(E){return E.toLowerCase().startsWith("referred-by:")})){var g="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">");d.push(g)}d.push("Contact: ".concat(this._session.contact));var S=this._session.sendRequest(Pt.REFER,{extraHeaders:d,eventHandlers:{onSuccessResponse:function(N){c._requestSucceeded(N)},onErrorResponse:function(N){c._requestFailed(N,Pt.causes.REJECTED)},onTransportError:function(){c._requestFailed(null,Pt.causes.CONNECTION_ERROR)},onRequestTimeout:function(){c._requestFailed(null,Pt.causes.REQUEST_TIMEOUT)},onDialogError:function(){c._requestFailed(null,Pt.causes.DIALOG_ERROR)}}});this._id=S.cseq}},{key:"receiveNotify",value:function(s){if(ot.debug("receiveNotify()"),!!s.body){var c=Nf.parse(s.body.trim().split(`\r
`,1)[0],"Status_Line");if(c===-1){ot.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(s.body,'"'));return}switch(!0){case/^100$/.test(c.status_code):this.emit("trying",{request:s,status_line:c});break;case/^1[0-9]{2}$/.test(c.status_code):this.emit("progress",{request:s,status_line:c});break;case/^2[0-9]{2}$/.test(c.status_code):this.emit("accepted",{request:s,status_line:c});break;default:this.emit("failed",{request:s,status_line:c});break}}}},{key:"_requestSucceeded",value:function(s){ot.debug("REFER succeeded"),ot.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:s})}},{key:"_requestFailed",value:function(s,c){ot.debug("REFER failed"),ot.debug('emit "requestFailed"'),this.emit("requestFailed",{response:s||null,cause:c})}},{key:"id",get:function(){return this._id}}]),i}(If);function Pn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Pn=function(i){return typeof i}:Pn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Pn(u)}function $e(u,a){var i;if(typeof Symbol>"u"||u[Symbol.iterator]==null){if(Array.isArray(u)||(i=Df(u))||a&&u&&typeof u.length=="number"){i&&(u=i);var r=0,s=function(){};return{s,n:function(){return r>=u.length?{done:!0}:{done:!1,value:u[r++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,e=!1,d;return{s:function(){i=u[Symbol.iterator]()},n:function(){var f=i.next();return c=f.done,f},e:function(f){e=!0,d=f},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(e)throw d}}}}function Df(u,a){if(u){if(typeof u=="string")return Hi(u,a);var i=Object.prototype.toString.call(u).slice(8,-1);if(i==="Object"&&u.constructor&&(i=u.constructor.name),i==="Map"||i==="Set")return Array.from(u);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Hi(u,a)}}function Hi(u,a){(a==null||a>u.length)&&(a=u.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=u[i];return r}function xf(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Li(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Fi(u,a,i){return a&&Li(u.prototype,a),i&&Li(u,i),u}function Pf(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&Qr(u,a)}function Qr(u,a){return Qr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Qr(u,a)}function Uf(u){var a=Lf();return function(){var r=Gn(u),s;if(a){var c=Gn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return Mf(this,s)}}function Mf(u,a){return a&&(Pn(a)==="object"||typeof a=="function")?a:Hf(u)}function Hf(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function Lf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Gn(u){return Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Gn(u)}var Ff=et.EventEmitter,$i=Ue,$f=_e,M=he,ft=Qe,qi=Jt,ie=ye(),Ut=Ra,qf=qe,gn=Bo,jf=Xt,Ce=nf,ji=pf,Bf=Tf,Gf=kf,Bi=Ze(),R=new $f("RTCSession"),I={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},yn=["audio","video"],Wf=function(u){Pf(i,u);var a=Uf(i);Fi(i,null,[{key:"C",get:function(){return I}}]);function i(r){var s;return xf(this,i),R.debug("new"),s=a.call(this),s._id=null,s._ua=r,s._status=I.STATUS_NULL,s._dialog=null,s._earlyDialogs={},s._contact=null,s._from_tag=null,s._to_tag=null,s._connection=null,s._connectionPromiseQueue=Promise.resolve(),s._request=null,s._is_canceled=!1,s._cancel_reason="",s._is_confirmed=!1,s._late_sdp=!1,s._rtcOfferConstraints=null,s._rtcAnswerConstraints=null,s._localMediaStream=null,s._localMediaStreamLocallyGenerated=!1,s._rtcReady=!0,s._iceReady=!1,s._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},s._direction=null,s._local_identity=null,s._remote_identity=null,s._start_time=null,s._end_time=null,s._tones=null,s._audioMuted=!1,s._videoMuted=!1,s._localHold=!1,s._remoteHold=!1,s._sessionTimers={enabled:s._ua.configuration.session_timers,refreshMethod:s._ua.configuration.session_timers_refresh_method,defaultExpires:M.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},s._referSubscribers={},s._data={},s}return Fi(i,[{key:"isInProgress",value:function(){switch(this._status){case I.STATUS_NULL:case I.STATUS_INVITE_SENT:case I.STATUS_1XX_RECEIVED:case I.STATUS_INVITE_RECEIVED:case I.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case I.STATUS_ANSWERED:case I.STATUS_WAITING_FOR_ACK:case I.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case I.STATUS_CANCELED:case I.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;R.debug("connect()");var d=s,m=ie.cloneObject(c.eventHandlers),f=ie.cloneArray(c.extraHeaders),p=ie.cloneObject(c.mediaConstraints,{audio:!0,video:!0}),v=c.mediaStream||null,g=ie.cloneObject(c.pcConfig,{iceServers:[]}),S=c.rtcConstraints||null,E=c.rtcOfferConstraints||null;if(this._rtcOfferConstraints=E,this._rtcAnswerConstraints=c.rtcAnswerConstraints||null,this._data=c.data||this._data,s===void 0)throw new TypeError("Not enough arguments");if(this._status!==I.STATUS_NULL)throw new ft.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new ft.NotSupportedError("WebRTC not supported");if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(d));this._sessionTimers.enabled&&ie.isDecimal(c.sessionTimersExpires)&&(c.sessionTimersExpires>=M.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=c.sessionTimersExpires:this._sessionTimers.defaultExpires=M.SESSION_EXPIRES);for(var N in m)Object.prototype.hasOwnProperty.call(m,N)&&this.on(N,m[N]);this._from_tag=ie.newTag();var L=c.anonymous||!1,U={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:L,outbound:!0}),L?(U.from_display_name="Anonymous",U.from_uri=new Bi("sip","anonymous","anonymous.invalid"),f.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),f.push("Privacy: id")):c.fromUserName&&(U.from_uri=new Bi("sip",c.fromUserName,this._ua.configuration.uri.host),f.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),c.fromDisplayName&&(U.from_display_name=c.fromDisplayName),f.push("Contact: ".concat(this._contact)),f.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&f.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new qf.InitialOutgoingInviteRequest(s,this._ua,U,f),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(g,S),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,e&&e(this),this._newRTCSession("local",this._request),this._sendInitialRequest(p,E,v)}},{key:"init_incoming",value:function(s,c){var e=this;R.debug("init_incoming()");var d,m=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0;if(s.body&&m!=="application/sdp"){s.reply(415);return}if(this._status=I.STATUS_INVITE_RECEIVED,this._from_tag=s.from_tag,this._id=s.call_id+this._from_tag,this._request=s,this._contact=this._ua.contact.toString(),s.hasHeader("expires")&&(d=s.getHeader("expires")*1e3),s.to_tag=ie.newTag(),!this._createDialog(s,"UAS",!0)){s.reply(500,"Missing Contact header field");return}s.body?this._late_sdp=!1:this._late_sdp=!0,this._status=I.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(function(){s.reply(408),e._failed("local",null,M.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),d&&(this._timers.expiresTimer=setTimeout(function(){e._status===I.STATUS_WAITING_FOR_ANSWER&&(s.reply(487),e._failed("system",null,M.causes.EXPIRES))},d)),this._direction="incoming",this._local_identity=s.to,this._remote_identity=s.from,c&&c(this),this._newRTCSession("remote",s),this._status!==I.STATUS_TERMINATED&&(s.reply(180,null,["Contact: ".concat(this._contact)]),this._progress("local",null))}},{key:"answer",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};R.debug("answer()");var e=this._request,d=ie.cloneArray(c.extraHeaders),m=ie.cloneObject(c.mediaConstraints),f=c.mediaStream||null,p=ie.cloneObject(c.pcConfig,{iceServers:[]}),v=c.rtcConstraints||null,g=c.rtcAnswerConstraints||null,S=ie.cloneObject(c.rtcOfferConstraints),E,N=!1,L=!1,U=!1,q=!1;if(this._rtcAnswerConstraints=g,this._rtcOfferConstraints=c.rtcOfferConstraints||null,this._data=c.data||this._data,this._direction!=="incoming")throw new ft.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==I.STATUS_WAITING_FOR_ANSWER)throw new ft.InvalidStateError(this._status);if(this._sessionTimers.enabled&&ie.isDecimal(c.sessionTimersExpires)&&(c.sessionTimersExpires>=M.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=c.sessionTimersExpires:this._sessionTimers.defaultExpires=M.SESSION_EXPIRES),this._status=I.STATUS_ANSWERED,!this._createDialog(e,"UAS")){e.reply(500,"Error creating dialog");return}clearTimeout(this._timers.userNoAnswerTimer),d.unshift("Contact: ".concat(this._contact));var G=e.parseSDP();Array.isArray(G.media)||(G.media=[G.media]);var z=$e(G.media),Y;try{for(z.s();!(Y=z.n()).done;){var ue=Y.value;ue.type==="audio"&&(N=!0,(!ue.direction||ue.direction==="sendrecv")&&(U=!0)),ue.type==="video"&&(L=!0,(!ue.direction||ue.direction==="sendrecv")&&(q=!0))}}catch(Q){z.e(Q)}finally{z.f()}if(f&&m.audio===!1){E=f.getAudioTracks();var Z=$e(E),D;try{for(Z.s();!(D=Z.n()).done;){var O=D.value;f.removeTrack(O)}}catch(Q){Z.e(Q)}finally{Z.f()}}if(f&&m.video===!1){E=f.getVideoTracks();var Ie=$e(E),je;try{for(Ie.s();!(je=Ie.n()).done;){var be=je.value;f.removeTrack(be)}}catch(Q){Ie.e(Q)}finally{Ie.f()}}!f&&m.audio===void 0&&(m.audio=U),!f&&m.video===void 0&&(m.video=q),!f&&!N&&!S.offerToReceiveAudio&&(m.audio=!1),!f&&!L&&!S.offerToReceiveVideo&&(m.video=!1),this._createRTCConnection(p,v),Promise.resolve().then(function(){if(f)return f;if(m.audio||m.video)return s._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(m).catch(function(Q){throw s._status===I.STATUS_TERMINATED?new Error("terminated"):(e.reply(480),s._failed("local",null,M.causes.USER_DENIED_MEDIA_ACCESS),R.warn('emit "getusermediafailed" [error:%o]',Q),s.emit("getusermediafailed",Q),new Error("getUserMedia() failed"))})}).then(function(Q){if(s._status===I.STATUS_TERMINATED)throw new Error("terminated");s._localMediaStream=Q,Q&&Q.getTracks().forEach(function(k){s._connection.addTrack(k,Q)})}).then(function(){if(!s._late_sdp){var Q={originator:"remote",type:"offer",sdp:e.body};R.debug('emit "sdp"'),s.emit("sdp",Q);var k=new RTCSessionDescription({type:"offer",sdp:Q.sdp});return s._connectionPromiseQueue=s._connectionPromiseQueue.then(function(){return s._connection.setRemoteDescription(k)}).catch(function(x){throw e.reply(488),s._failed("system",null,M.causes.WEBRTC_ERROR),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',x),s.emit("peerconnection:setremotedescriptionfailed",x),new Error("peerconnection.setRemoteDescription() failed")}),s._connectionPromiseQueue}}).then(function(){if(s._status===I.STATUS_TERMINATED)throw new Error("terminated");return s._connecting(e),s._late_sdp?s._createLocalDescription("offer",s._rtcOfferConstraints).catch(function(){throw e.reply(500),new Error("_createLocalDescription() failed")}):s._createLocalDescription("answer",g).catch(function(){throw e.reply(500),new Error("_createLocalDescription() failed")})}).then(function(Q){if(s._status===I.STATUS_TERMINATED)throw new Error("terminated");s._handleSessionTimersInIncomingRequest(e,d),e.reply(200,null,d,Q,function(){s._status=I.STATUS_WAITING_FOR_ACK,s._setInvite2xxTimer(e,Q),s._setACKTimer(),s._accepted("local")},function(){s._failed("system",null,M.causes.CONNECTION_ERROR)})}).catch(function(Q){s._status!==I.STATUS_TERMINATED&&R.warn(Q)})}},{key:"terminate",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};R.debug("terminate()");var e=c.cause||M.causes.BYE,d=ie.cloneArray(c.extraHeaders),m=c.body,f,p=c.status_code,v=c.reason_phrase;if(this._status===I.STATUS_TERMINATED)throw new ft.InvalidStateError(this._status);switch(this._status){case I.STATUS_NULL:case I.STATUS_INVITE_SENT:case I.STATUS_1XX_RECEIVED:if(R.debug("canceling session"),p&&(p<200||p>=700))throw new TypeError("Invalid status_code: ".concat(p));p&&(v=v||M.REASON_PHRASE[p]||"",f="SIP ;cause=".concat(p,' ;text="').concat(v,'"')),this._status===I.STATUS_NULL||this._status===I.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=f):this._status===I.STATUS_1XX_RECEIVED&&this._request.cancel(f),this._status=I.STATUS_CANCELED,this._failed("local",null,M.causes.CANCELED);break;case I.STATUS_WAITING_FOR_ANSWER:case I.STATUS_ANSWERED:if(R.debug("rejecting session"),p=p||480,p<300||p>=700)throw new TypeError("Invalid status_code: ".concat(p));this._request.reply(p,v,d,m),this._failed("local",null,M.causes.REJECTED);break;case I.STATUS_WAITING_FOR_ACK:case I.STATUS_CONFIRMED:if(R.debug("terminating session"),v=c.reason_phrase||M.REASON_PHRASE[p]||"",p&&(p<200||p>=700))throw new TypeError("Invalid status_code: ".concat(p));if(p&&d.push("Reason: SIP ;cause=".concat(p,'; text="').concat(v,'"')),this._status===I.STATUS_WAITING_FOR_ACK&&this._direction==="incoming"&&this._request.server_transaction.state!==qi.C.STATUS_TERMINATED){var g=this._dialog;this.receiveRequest=function(S){var E=S.method;E===M.ACK&&(s.sendRequest(M.BYE,{extraHeaders:d,body:m}),g.terminate())},this._request.server_transaction.on("stateChanged",function(){s._request.server_transaction.state===qi.C.STATUS_TERMINATED&&(s.sendRequest(M.BYE,{extraHeaders:d,body:m}),g.terminate())}),this._ended("local",null,e),this._dialog=g,this._ua.newDialog(g)}else this.sendRequest(M.BYE,{extraHeaders:d,body:m}),this._ended("local",null,e)}}},{key:"sendDTMF",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};R.debug("sendDTMF() | tones: %s",s);var e=0,d=c.duration||null,m=c.interToneGap||null,f=c.transportType||M.DTMF_TRANSPORT.INFO;if(s===void 0)throw new TypeError("Not enough arguments");if(this._status!==I.STATUS_CONFIRMED&&this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_1XX_RECEIVED)throw new ft.InvalidStateError(this._status);if(f!==M.DTMF_TRANSPORT.INFO&&f!==M.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(f));if(typeof s=="number"&&(s=s.toString()),!s||typeof s!="string"||!s.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(s));if(d&&!ie.isDecimal(d))throw new TypeError("Invalid tone duration: ".concat(d));if(d?d<Ce.C.MIN_DURATION?(R.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(Ce.C.MIN_DURATION," milliseconds")),d=Ce.C.MIN_DURATION):d>Ce.C.MAX_DURATION?(R.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(Ce.C.MAX_DURATION," milliseconds")),d=Ce.C.MAX_DURATION):d=Math.abs(d):d=Ce.C.DEFAULT_DURATION,c.duration=d,m&&!ie.isDecimal(m))throw new TypeError("Invalid interToneGap: ".concat(m));if(m?m<Ce.C.MIN_INTER_TONE_GAP?(R.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(Ce.C.MIN_INTER_TONE_GAP," milliseconds")),m=Ce.C.MIN_INTER_TONE_GAP):m=Math.abs(m):m=Ce.C.DEFAULT_INTER_TONE_GAP,f===M.DTMF_TRANSPORT.RFC2833){var p=this._getDTMFRTPSender();p&&(s=p.toneBuffer+s,p.insertDTMF(s,d,m));return}if(this._tones){this._tones+=s;return}this._tones=s,v.call(this);function v(){var g=this,S;if(this._status===I.STATUS_TERMINATED||!this._tones||e>=this._tones.length){this._tones=null;return}var E=this._tones[e];if(e+=1,E===",")S=2e3;else{var N=new Ce(this);c.eventHandlers={onFailed:function(){g._tones=null}},N.send(E,c),S=d+m}setTimeout(v.bind(this),S)}}},{key:"sendInfo",value:function(s,c){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(R.debug("sendInfo()"),this._status!==I.STATUS_CONFIRMED&&this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_1XX_RECEIVED)throw new ft.InvalidStateError(this._status);var d=new ji(this);d.send(s,c,e)}},{key:"mute",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{audio:!0,video:!1};R.debug("mute()");var c=!1,e=!1;this._audioMuted===!1&&s.audio&&(c=!0,this._audioMuted=!0,this._toggleMuteAudio(!0)),this._videoMuted===!1&&s.video&&(e=!0,this._videoMuted=!0,this._toggleMuteVideo(!0)),(c===!0||e===!0)&&this._onmute({audio:c,video:e})}},{key:"unmute",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{audio:!0,video:!0};R.debug("unmute()");var c=!1,e=!1;this._audioMuted===!0&&s.audio&&(c=!0,this._audioMuted=!1,this._localHold===!1&&this._toggleMuteAudio(!1)),this._videoMuted===!0&&s.video&&(e=!0,this._videoMuted=!1,this._localHold===!1&&this._toggleMuteVideo(!1)),(c===!0||e===!0)&&this._onunmute({audio:c,video:e})}},{key:"hold",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(R.debug("hold()"),this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED||this._localHold===!0||!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var d={succeeded:function(){e&&e()},failed:function(){s.terminate({cause:M.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return c.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:d,extraHeaders:c.extraHeaders}):this._sendReinvite({eventHandlers:d,extraHeaders:c.extraHeaders}),!0}},{key:"unhold",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(R.debug("unhold()"),this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED||this._localHold===!1||!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var d={succeeded:function(){e&&e()},failed:function(){s.terminate({cause:M.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return c.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:d,extraHeaders:c.extraHeaders}):this._sendReinvite({eventHandlers:d,extraHeaders:c.extraHeaders}),!0}},{key:"renegotiate",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;R.debug("renegotiate()");var d=c.rtcOfferConstraints||null;if(this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED||!this._isReadyToReOffer())return!1;var m={succeeded:function(){e&&e()},failed:function(){s.terminate({cause:M.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),c.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:m,rtcOfferConstraints:d,extraHeaders:c.extraHeaders}):this._sendReinvite({eventHandlers:m,rtcOfferConstraints:d,extraHeaders:c.extraHeaders}),!0}},{key:"refer",value:function(s,c){var e=this;R.debug("refer()");var d=s;if(this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(d));var m=new Gf(this);m.sendRefer(s,c);var f=m.id;return this._referSubscribers[f]=m,m.on("requestFailed",function(){delete e._referSubscribers[f]}),m.on("accepted",function(){delete e._referSubscribers[f]}),m.on("failed",function(){delete e._referSubscribers[f]}),m}},{key:"sendRequest",value:function(s,c){return R.debug("sendRequest()"),this._dialog.sendRequest(s,c)}},{key:"receiveRequest",value:function(s){var c=this;if(R.debug("receiveRequest()"),s.method===M.CANCEL)(this._status===I.STATUS_WAITING_FOR_ANSWER||this._status===I.STATUS_ANSWERED)&&(this._status=I.STATUS_CANCELED,this._request.reply(487),this._failed("remote",s,M.causes.CANCELED));else switch(s.method){case M.ACK:if(this._status!==I.STATUS_WAITING_FOR_ACK)return;if(this._status=I.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!s.body){this.terminate({cause:M.causes.MISSING_SDP,status_code:400});break}var e={originator:"remote",type:"answer",sdp:s.body};R.debug('emit "sdp"'),this.emit("sdp",e);var d=new RTCSessionDescription({type:"answer",sdp:e.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return c._connection.setRemoteDescription(d)}).then(function(){c._is_confirmed||c._confirmed("remote",s)}).catch(function(f){c.terminate({cause:M.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',f),c.emit("peerconnection:setremotedescriptionfailed",f)})}else this._is_confirmed||this._confirmed("remote",s);break;case M.BYE:this._status===I.STATUS_CONFIRMED||this._status===I.STATUS_WAITING_FOR_ACK?(s.reply(200),this._ended("remote",s,M.causes.BYE)):this._status===I.STATUS_INVITE_RECEIVED||this._status===I.STATUS_WAITING_FOR_ANSWER?(s.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",s,M.causes.BYE)):s.reply(403,"Wrong Status");break;case M.INVITE:this._status===I.STATUS_CONFIRMED?s.hasHeader("replaces")?this._receiveReplaces(s):this._receiveReinvite(s):s.reply(403,"Wrong Status");break;case M.INFO:if(this._status===I.STATUS_1XX_RECEIVED||this._status===I.STATUS_WAITING_FOR_ANSWER||this._status===I.STATUS_ANSWERED||this._status===I.STATUS_WAITING_FOR_ACK||this._status===I.STATUS_CONFIRMED){var m=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0;m&&m.match(/^application\/dtmf-relay/i)?new Ce(this).init_incoming(s):m!==void 0?new ji(this).init_incoming(s):s.reply(415)}else s.reply(403,"Wrong Status");break;case M.UPDATE:this._status===I.STATUS_CONFIRMED?this._receiveUpdate(s):s.reply(403,"Wrong Status");break;case M.REFER:this._status===I.STATUS_CONFIRMED?this._receiveRefer(s):s.reply(403,"Wrong Status");break;case M.NOTIFY:this._status===I.STATUS_CONFIRMED?this._receiveNotify(s):s.reply(403,"Wrong Status");break;default:s.reply(501)}}},{key:"onTransportError",value:function(){R.warn("onTransportError()"),this._status!==I.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:M.causes.CONNECTION_ERROR,cause:M.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){R.warn("onRequestTimeout()"),this._status!==I.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:M.causes.REQUEST_TIMEOUT,cause:M.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){R.warn("onDialogError()"),this._status!==I.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:M.causes.DIALOG_ERROR,cause:M.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(s){R.debug("newDTMF()"),this.emit("newDTMF",s)}},{key:"newInfo",value:function(s){R.debug("newInfo()"),this.emit("newInfo",s)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?this._dialog.uac_pending_reply===!0||this._dialog.uas_pending_reply===!0?(R.debug("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):!0:(R.debug("_isReadyToReOffer() | session not established yet"),!1):(R.debug("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(R.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(R.debug("close() | closing local MediaStream"),ie.closeMediaStream(this._localMediaStream)),this._status!==I.STATUS_TERMINATED){if(this._status=I.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(d){R.warn("close() | error closing the RTCPeerConnection: %o",d)}for(var s in this._timers)Object.prototype.hasOwnProperty.call(this._timers,s)&&clearTimeout(this._timers[s]);clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog);for(var c in this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,c)&&(this._earlyDialogs[c].terminate(),delete this._earlyDialogs[c]);for(var e in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,e)&&delete this._referSubscribers[e];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(s,c){var e=Ut.T1;function d(){this._status===I.STATUS_WAITING_FOR_ACK&&(s.reply(200,null,["Contact: ".concat(this._contact)],c),e<Ut.T2&&(e=e*2,e>Ut.T2&&(e=Ut.T2)),this._timers.invite2xxTimer=setTimeout(d.bind(this),e))}this._timers.invite2xxTimer=setTimeout(d.bind(this),e)}},{key:"_setACKTimer",value:function(){var s=this;this._timers.ackTimer=setTimeout(function(){s._status===I.STATUS_WAITING_FOR_ACK&&(R.debug("no ACK received, terminating the session"),clearTimeout(s._timers.invite2xxTimer),s.sendRequest(M.BYE),s._ended("remote",null,M.causes.NO_ACK))},Ut.TIMER_H)}},{key:"_createRTCConnection",value:function(s,c){var e=this;this._connection=new RTCPeerConnection(s,c),this._connection.addEventListener("iceconnectionstatechange",function(){var d=e._connection.iceConnectionState;d==="failed"&&e.terminate({cause:M.causes.RTP_TIMEOUT,status_code:408,reason_phrase:M.causes.RTP_TIMEOUT})}),R.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(s,c){var e=this;if(R.debug("createLocalDescription()"),s!=="offer"&&s!=="answer")throw new Error('createLocalDescription() | invalid type "'.concat(s,'"'));var d=this._connection;return this._rtcReady=!1,Promise.resolve().then(function(){return s==="offer"?d.createOffer(c).catch(function(m){return R.warn('emit "peerconnection:createofferfailed" [error:%o]',m),e.emit("peerconnection:createofferfailed",m),Promise.reject(m)}):d.createAnswer(c).catch(function(m){return R.warn('emit "peerconnection:createanswerfailed" [error:%o]',m),e.emit("peerconnection:createanswerfailed",m),Promise.reject(m)})}).then(function(m){return d.setLocalDescription(m).catch(function(f){return e._rtcReady=!0,R.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',f),e.emit("peerconnection:setlocaldescriptionfailed",f),Promise.reject(f)})}).then(function(){var m=c&&c.iceRestart;if(d.iceGatheringState==="complete"&&!m||d.iceGatheringState==="gathering"&&e._iceReady){e._rtcReady=!0;var f={originator:"local",type:s,sdp:d.localDescription.sdp};return R.debug('emit "sdp"'),e.emit("sdp",f),Promise.resolve(f.sdp)}return new Promise(function(p){var v=!1,g,S;e._iceReady=!1;var E=function(){if(!v){d.removeEventListener("icecandidate",g),d.removeEventListener("icegatheringstatechange",S),v=!0,e._rtcReady=!0,e._iceReady=!0;var L={originator:"local",type:s,sdp:d.localDescription.sdp};R.debug('emit "sdp"'),e.emit("sdp",L),p(L.sdp)}};d.addEventListener("icecandidate",g=function(L){var U=L.candidate;U?e.emit("icecandidate",{candidate:U,ready:E}):E()}),d.addEventListener("icegatheringstatechange",S=function(){d.iceGatheringState==="complete"&&E()})})})}},{key:"_createDialog",value:function(s,c,e){var d=c==="UAS"?s.to_tag:s.from_tag,m=c==="UAS"?s.from_tag:s.to_tag,f=s.call_id+d+m,p=this._earlyDialogs[f];if(e)return p?!0:(p=new gn(this,s,c,gn.C.STATUS_EARLY),p.error?(R.debug(p.error),this._failed("remote",s,M.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[f]=p,!0));if(this._from_tag=s.from_tag,this._to_tag=s.to_tag,p)return p.update(s,c),this._dialog=p,delete this._earlyDialogs[f],!0;var v=new gn(this,s,c);return v.error?(R.debug(v.error),this._failed("remote",s,M.causes.INTERNAL_ERROR),!1):(this._dialog=v,!0)}},{key:"_receiveReinvite",value:function(s){var c=this;R.debug("receiveReinvite()");var e=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0,d={request:s,callback:void 0,reject:f.bind(this)},m=!1;function f(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m=!0;var g=v.status_code||403,S=v.reason_phrase||"",E=ie.cloneArray(v.extraHeaders);if(this._status!==I.STATUS_CONFIRMED)return!1;if(g<300||g>=700)throw new TypeError("Invalid status_code: ".concat(g));s.reply(g,S,E)}if(this.emit("reinvite",d),m)return;if(this._late_sdp=!1,!s.body){this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return c._createLocalDescription("offer",c._rtcOfferConstraints)}).then(function(v){p.call(c,v)}).catch(function(){s.reply(500)});return}if(e!=="application/sdp"){R.debug("invalid Content-Type"),s.reply(415);return}this._processInDialogSdpOffer(s).then(function(v){c._status!==I.STATUS_TERMINATED&&p.call(c,v)}).catch(function(v){R.warn(v)});function p(v){var g=this,S=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(s,S),this._late_sdp&&(v=this._mangleOffer(v)),s.reply(200,null,S,v,function(){g._status=I.STATUS_WAITING_FOR_ACK,g._setInvite2xxTimer(s,v),g._setACKTimer()}),typeof d.callback=="function"&&d.callback()}}},{key:"_receiveUpdate",value:function(s){var c=this;R.debug("receiveUpdate()");var e=s.hasHeader("Content-Type")?s.getHeader("Content-Type").toLowerCase():void 0,d={request:s,callback:void 0,reject:f.bind(this)},m=!1;function f(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m=!0;var g=v.status_code||403,S=v.reason_phrase||"",E=ie.cloneArray(v.extraHeaders);if(this._status!==I.STATUS_CONFIRMED)return!1;if(g<300||g>=700)throw new TypeError("Invalid status_code: ".concat(g));s.reply(g,S,E)}if(this.emit("update",d),m)return;if(!s.body){p.call(this,null);return}if(e!=="application/sdp"){R.debug("invalid Content-Type"),s.reply(415);return}this._processInDialogSdpOffer(s).then(function(v){c._status!==I.STATUS_TERMINATED&&p.call(c,v)}).catch(function(v){R.warn(v)});function p(v){var g=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(s,g),s.reply(200,null,g,v),typeof d.callback=="function"&&d.callback()}}},{key:"_processInDialogSdpOffer",value:function(s){var c=this;R.debug("_processInDialogSdpOffer()");var e=s.parseSDP(),d=!1,m=$e(e.media),f;try{for(m.s();!(f=m.n()).done;){var p=f.value;if(yn.indexOf(p.type)!==-1){var v=p.direction||e.direction||"sendrecv";if(v==="sendonly"||v==="inactive")d=!0;else{d=!1;break}}}}catch(E){m.e(E)}finally{m.f()}var g={originator:"remote",type:"offer",sdp:s.body};R.debug('emit "sdp"'),this.emit("sdp",g);var S=new RTCSessionDescription({type:"offer",sdp:g.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(c._status===I.STATUS_TERMINATED)throw new Error("terminated");return c._connection.setRemoteDescription(S).catch(function(E){throw s.reply(488),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',E),c.emit("peerconnection:setremotedescriptionfailed",E),E})}).then(function(){if(c._status===I.STATUS_TERMINATED)throw new Error("terminated");c._remoteHold===!0&&d===!1?(c._remoteHold=!1,c._onunhold("remote")):c._remoteHold===!1&&d===!0&&(c._remoteHold=!0,c._onhold("remote"))}).then(function(){if(c._status===I.STATUS_TERMINATED)throw new Error("terminated");return c._createLocalDescription("answer",c._rtcAnswerConstraints).catch(function(E){throw s.reply(500),R.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',E),E})}).catch(function(E){R.warn("_processInDialogSdpOffer() failed [error: %o]",E)}),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(s){var c=this;if(R.debug("receiveRefer()"),!s.refer_to){R.debug("no Refer-To header field present in REFER"),s.reply(400);return}if(s.refer_to.uri.scheme!==M.SIP){R.debug("Refer-To header field points to a non-SIP URI scheme"),s.reply(416);return}s.reply(202);var e=new Bf(this,s.cseq);R.debug('emit "refer"'),this.emit("refer",{request:s,accept:function(p,v){d.call(c,p,v)},reject:function(){m.call(c)}});function d(f){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(f=typeof f=="function"?f:null,this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;var v=new i(this._ua);if(v.on("progress",function(S){var E=S.response;e.notify(E.status_code,E.reason_phrase)}),v.on("accepted",function(S){var E=S.response;e.notify(E.status_code,E.reason_phrase)}),v.on("_failed",function(S){var E=S.message,N=S.cause;E?e.notify(E.status_code,E.reason_phrase):e.notify(487,N)}),s.refer_to.uri.hasHeader("replaces")){var g=decodeURIComponent(s.refer_to.uri.getHeader("replaces"));p.extraHeaders=ie.cloneArray(p.extraHeaders),p.extraHeaders.push("Replaces: ".concat(g))}v.connect(s.refer_to.uri.toAor(),p,f)}function m(){e.notify(603)}}},{key:"_receiveNotify",value:function(s){switch(R.debug("receiveNotify()"),s.event||s.reply(400),s.event.event){case"refer":{var c,e;if(s.event.params&&s.event.params.id)c=s.event.params.id,e=this._referSubscribers[c];else if(Object.keys(this._referSubscribers).length===1)e=this._referSubscribers[Object.keys(this._referSubscribers)[0]];else{s.reply(400,"Missing event id parameter");return}if(!e){s.reply(481,"Subscription does not exist");return}e.receiveNotify(s),s.reply(200);break}default:s.reply(489)}}},{key:"_receiveReplaces",value:function(s){var c=this;R.debug("receiveReplaces()");function e(m){var f=this;if(this._status!==I.STATUS_WAITING_FOR_ACK&&this._status!==I.STATUS_CONFIRMED)return!1;var p=new i(this._ua);p.on("confirmed",function(){f.terminate()}),p.init_incoming(s,m)}function d(){R.debug("Replaced INVITE rejected by the user"),s.reply(486)}this.emit("replaces",{request:s,accept:function(f){e.call(c,f)},reject:function(){d.call(c)}})}},{key:"_sendInitialRequest",value:function(s,c,e){var d=this,m=new jf(this._ua,this._request,{onRequestTimeout:function(){d.onRequestTimeout()},onTransportError:function(){d.onTransportError()},onAuthenticated:function(p){d._request=p},onReceiveResponse:function(p){d._receiveInviteResponse(p)}});Promise.resolve().then(function(){if(e)return e;if(s.audio||s.video)return d._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(s).catch(function(f){throw d._status===I.STATUS_TERMINATED?new Error("terminated"):(d._failed("local",null,M.causes.USER_DENIED_MEDIA_ACCESS),R.warn('emit "getusermediafailed" [error:%o]',f),d.emit("getusermediafailed",f),f)})}).then(function(f){if(d._status===I.STATUS_TERMINATED)throw new Error("terminated");return d._localMediaStream=f,f&&f.getTracks().forEach(function(p){d._connection.addTrack(p,f)}),d._connecting(d._request),d._createLocalDescription("offer",c).catch(function(p){throw d._failed("local",null,M.causes.WEBRTC_ERROR),p})}).then(function(f){if(d._is_canceled||d._status===I.STATUS_TERMINATED)throw new Error("terminated");d._request.body=f,d._status=I.STATUS_INVITE_SENT,R.debug('emit "sending" [request:%o]',d._request),d.emit("sending",{request:d._request}),m.send()}).catch(function(f){d._status!==I.STATUS_TERMINATED&&R.warn(f)})}},{key:"_getDTMFRTPSender",value:function(){var s=this._connection.getSenders().find(function(c){return c.track&&c.track.kind==="audio"});if(!(s&&s.dtmf)){R.warn("sendDTMF() | no local audio track to send DTMF with");return}return s.dtmf}},{key:"_receiveInviteResponse",value:function(s){var c=this;if(R.debug("receiveInviteResponse()"),this._dialog&&s.status_code>=200&&s.status_code<=299)if(this._dialog.id.call_id===s.call_id&&this._dialog.id.local_tag===s.from_tag&&this._dialog.id.remote_tag===s.to_tag){this.sendRequest(M.ACK);return}else{var e=new gn(this,s,"UAC");if(e.error!==void 0){R.debug(e.error);return}this.sendRequest(M.ACK),this.sendRequest(M.BYE);return}if(this._is_canceled){s.status_code>=100&&s.status_code<200?this._request.cancel(this._cancel_reason):s.status_code>=200&&s.status_code<299&&this._acceptAndTerminate(s);return}if(!(this._status!==I.STATUS_INVITE_SENT&&this._status!==I.STATUS_1XX_RECEIVED))switch(!0){case/^100$/.test(s.status_code):this._status=I.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(s.status_code):{if(!s.to_tag){R.debug("1xx response received without to tag");break}if(s.hasHeader("contact")&&!this._createDialog(s,"UAC",!0))break;if(this._status=I.STATUS_1XX_RECEIVED,!s.body){this._progress("remote",s);break}var d={originator:"remote",type:"answer",sdp:s.body};R.debug('emit "sdp"'),this.emit("sdp",d);var m=new RTCSessionDescription({type:"answer",sdp:d.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return c._connection.setRemoteDescription(m)}).then(function(){return c._progress("remote",s)}).catch(function(g){R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',g),c.emit("peerconnection:setremotedescriptionfailed",g)});break}case/^2[0-9]{2}$/.test(s.status_code):{if(this._status=I.STATUS_CONFIRMED,!s.body){this._acceptAndTerminate(s,400,M.causes.MISSING_SDP),this._failed("remote",s,M.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(s,"UAC"))break;var f={originator:"remote",type:"answer",sdp:s.body};R.debug('emit "sdp"'),this.emit("sdp",f);var p=new RTCSessionDescription({type:"answer",sdp:f.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(c._connection.signalingState==="stable")return c._connection.createOffer(c._rtcOfferConstraints).then(function(g){return c._connection.setLocalDescription(g)}).catch(function(g){c._acceptAndTerminate(s,500,g.toString()),c._failed("local",s,M.causes.WEBRTC_ERROR)})}).then(function(){c._connection.setRemoteDescription(p).then(function(){c._handleSessionTimersInIncomingResponse(s),c._accepted("remote",s),c.sendRequest(M.ACK),c._confirmed("local",null)}).catch(function(g){c._acceptAndTerminate(s,488,"Not Acceptable Here"),c._failed("remote",s,M.causes.BAD_MEDIA_DESCRIPTION),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',g),c.emit("peerconnection:setremotedescriptionfailed",g)})});break}default:{var v=ie.sipErrorCause(s.status_code);this._failed("remote",s,v)}}}},{key:"_sendReinvite",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};R.debug("sendReinvite()");var e=ie.cloneArray(c.extraHeaders),d=ie.cloneObject(c.eventHandlers),m=c.rtcOfferConstraints||this._rtcOfferConstraints||null,f=!1;e.push("Contact: ".concat(this._contact)),e.push("Content-Type: application/sdp"),this._sessionTimers.running&&e.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return s._createLocalDescription("offer",m)}).then(function(g){g=s._mangleOffer(g);var S={originator:"local",type:"offer",sdp:g};R.debug('emit "sdp"'),s.emit("sdp",S),s.sendRequest(M.INVITE,{extraHeaders:e,body:g,eventHandlers:{onSuccessResponse:function(N){p.call(s,N),f=!0},onErrorResponse:function(N){v.call(s,N)},onTransportError:function(){s.onTransportError()},onRequestTimeout:function(){s.onRequestTimeout()},onDialogError:function(){s.onDialogError()}}})}).catch(function(){v()});function p(g){var S=this;if(this._status!==I.STATUS_TERMINATED&&(this.sendRequest(M.ACK),!f)){if(this._handleSessionTimersInIncomingResponse(g),g.body){if(!g.hasHeader("Content-Type")||g.getHeader("Content-Type").toLowerCase()!=="application/sdp"){v.call(this);return}}else{v.call(this);return}var E={originator:"remote",type:"answer",sdp:g.body};R.debug('emit "sdp"'),this.emit("sdp",E);var N=new RTCSessionDescription({type:"answer",sdp:E.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return S._connection.setRemoteDescription(N)}).then(function(){d.succeeded&&d.succeeded(g)}).catch(function(L){v.call(S),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',L),S.emit("peerconnection:setremotedescriptionfailed",L)})}}function v(g){d.failed&&d.failed(g)}}},{key:"_sendUpdate",value:function(){var s=this,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};R.debug("sendUpdate()");var e=ie.cloneArray(c.extraHeaders),d=ie.cloneObject(c.eventHandlers),m=c.rtcOfferConstraints||this._rtcOfferConstraints||null,f=c.sdpOffer||!1,p=!1;e.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&e.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),f?(e.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return s._createLocalDescription("offer",m)}).then(function(S){S=s._mangleOffer(S);var E={originator:"local",type:"offer",sdp:S};R.debug('emit "sdp"'),s.emit("sdp",E),s.sendRequest(M.UPDATE,{extraHeaders:e,body:S,eventHandlers:{onSuccessResponse:function(L){v.call(s,L),p=!0},onErrorResponse:function(L){g.call(s,L)},onTransportError:function(){s.onTransportError()},onRequestTimeout:function(){s.onRequestTimeout()},onDialogError:function(){s.onDialogError()}}})}).catch(function(){g.call(s)})):this.sendRequest(M.UPDATE,{extraHeaders:e,eventHandlers:{onSuccessResponse:function(E){v.call(s,E)},onErrorResponse:function(E){g.call(s,E)},onTransportError:function(){s.onTransportError()},onRequestTimeout:function(){s.onRequestTimeout()},onDialogError:function(){s.onDialogError()}}});function v(S){var E=this;if(this._status!==I.STATUS_TERMINATED&&!p)if(this._handleSessionTimersInIncomingResponse(S),f){if(S.body){if(!S.hasHeader("Content-Type")||S.getHeader("Content-Type").toLowerCase()!=="application/sdp"){g.call(this);return}}else{g.call(this);return}var N={originator:"remote",type:"answer",sdp:S.body};R.debug('emit "sdp"'),this.emit("sdp",N);var L=new RTCSessionDescription({type:"answer",sdp:N.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return E._connection.setRemoteDescription(L)}).then(function(){d.succeeded&&d.succeeded(S)}).catch(function(U){g.call(E),R.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',U),E.emit("peerconnection:setremotedescriptionfailed",U)})}else d.succeeded&&d.succeeded(S)}function g(S){d.failed&&d.failed(S)}}},{key:"_acceptAndTerminate",value:function(s,c,e){R.debug("acceptAndTerminate()");var d=[];c&&(e=e||M.REASON_PHRASE[c]||"",d.push("Reason: SIP ;cause=".concat(c,'; text="').concat(e,'"'))),(this._dialog||this._createDialog(s,"UAC"))&&(this.sendRequest(M.ACK),this.sendRequest(M.BYE,{extraHeaders:d})),this._status=I.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(s){if(!this._localHold&&!this._remoteHold)return s;if(s=$i.parse(s),this._localHold&&!this._remoteHold){R.debug("mangleOffer() | me on hold, mangling offer");var c=$e(s.media),e;try{for(c.s();!(e=c.n()).done;){var d=e.value;yn.indexOf(d.type)!==-1&&(d.direction?d.direction==="sendrecv"?d.direction="sendonly":d.direction==="recvonly"&&(d.direction="inactive"):d.direction="sendonly")}}catch(E){c.e(E)}finally{c.f()}}else if(this._localHold&&this._remoteHold){R.debug("mangleOffer() | both on hold, mangling offer");var m=$e(s.media),f;try{for(m.s();!(f=m.n()).done;){var p=f.value;yn.indexOf(p.type)!==-1&&(p.direction="inactive")}}catch(E){m.e(E)}finally{m.f()}}else if(this._remoteHold){R.debug("mangleOffer() | remote on hold, mangling offer");var v=$e(s.media),g;try{for(v.s();!(g=v.n()).done;){var S=g.value;yn.indexOf(S.type)!==-1&&(S.direction?S.direction==="sendrecv"?S.direction="recvonly":S.direction==="recvonly"&&(S.direction="inactive"):S.direction="recvonly")}}catch(E){v.e(E)}finally{v.f()}}return $i.write(s)}},{key:"_setLocalMediaStatus",value:function(){var s=!0,c=!0;(this._localHold||this._remoteHold)&&(s=!1,c=!1),this._audioMuted&&(s=!1),this._videoMuted&&(c=!1),this._toggleMuteAudio(!s),this._toggleMuteVideo(!c)}},{key:"_handleSessionTimersInIncomingRequest",value:function(s,c){if(this._sessionTimers.enabled){var e;s.session_expires&&s.session_expires>=M.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=s.session_expires,e=s.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,e="uas"),c.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(e)),this._sessionTimers.refresher=e==="uas",this._runSessionTimer()}}},{key:"_handleSessionTimersInIncomingResponse",value:function(s){if(this._sessionTimers.enabled){var c;s.session_expires&&s.session_expires>=M.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=s.session_expires,c=s.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,c="uac"),this._sessionTimers.refresher=c==="uac",this._runSessionTimer()}}},{key:"_runSessionTimer",value:function(){var s=this,c=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(function(){s._status!==I.STATUS_TERMINATED&&s._isReadyToReOffer()&&(R.debug("runSessionTimer() | sending session refresh request"),s._sessionTimers.refreshMethod===M.UPDATE?s._sendUpdate():s._sendReinvite())},c*500):this._sessionTimers.timer=setTimeout(function(){s._status!==I.STATUS_TERMINATED&&(R.warn("runSessionTimer() | timer expired, terminating the session"),s.terminate({cause:M.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},c*1100)}},{key:"_toggleMuteAudio",value:function(s){var c=this._connection.getSenders().filter(function(f){return f.track&&f.track.kind==="audio"}),e=$e(c),d;try{for(e.s();!(d=e.n()).done;){var m=d.value;m.track.enabled=!s}}catch(f){e.e(f)}finally{e.f()}}},{key:"_toggleMuteVideo",value:function(s){var c=this._connection.getSenders().filter(function(f){return f.track&&f.track.kind==="video"}),e=$e(c),d;try{for(e.s();!(d=e.n()).done;){var m=d.value;m.track.enabled=!s}}catch(f){e.e(f)}finally{e.f()}}},{key:"_newRTCSession",value:function(s,c){R.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:s,session:this,request:c})}},{key:"_connecting",value:function(s){R.debug("session connecting"),R.debug('emit "connecting"'),this.emit("connecting",{request:s})}},{key:"_progress",value:function(s,c){R.debug("session progress"),R.debug('emit "progress"'),this.emit("progress",{originator:s,response:c||null})}},{key:"_accepted",value:function(s,c){R.debug("session accepted"),this._start_time=new Date,R.debug('emit "accepted"'),this.emit("accepted",{originator:s,response:c||null})}},{key:"_confirmed",value:function(s,c){R.debug("session confirmed"),this._is_confirmed=!0,R.debug('emit "confirmed"'),this.emit("confirmed",{originator:s,ack:c||null})}},{key:"_ended",value:function(s,c,e){R.debug("session ended"),this._end_time=new Date,this._close(),R.debug('emit "ended"'),this.emit("ended",{originator:s,message:c||null,cause:e})}},{key:"_failed",value:function(s,c,e){R.debug("session failed"),R.debug('emit "_failed"'),this.emit("_failed",{originator:s,message:c||null,cause:e}),this._close(),R.debug('emit "failed"'),this.emit("failed",{originator:s,message:c||null,cause:e})}},{key:"_onhold",value:function(s){R.debug("session onhold"),this._setLocalMediaStatus(),R.debug('emit "hold"'),this.emit("hold",{originator:s})}},{key:"_onunhold",value:function(s){R.debug("session onunhold"),this._setLocalMediaStatus(),R.debug('emit "unhold"'),this.emit("unhold",{originator:s})}},{key:"_onmute",value:function(s){var c=s.audio,e=s.video;R.debug("session onmute"),this._setLocalMediaStatus(),R.debug('emit "muted"'),this.emit("muted",{audio:c,video:e})}},{key:"_onunmute",value:function(s){var c=s.audio,e=s.video;R.debug("session onunmute"),this._setLocalMediaStatus(),R.debug('emit "unmuted"'),this.emit("unmuted",{audio:c,video:e})}},{key:"C",get:function(){return I}},{key:"causes",get:function(){return M.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(s){this._data=s}},{key:"status",get:function(){return this._status}}]),i}(Ff);function Un(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Un=function(i){return typeof i}:Un=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Un(u)}function Vf(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Gi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Kf(u,a,i){return a&&Gi(u.prototype,a),i&&Gi(u,i),u}function zf(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&Zr(u,a)}function Zr(u,a){return Zr=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},Zr(u,a)}function Yf(u){var a=Qf();return function(){var r=Wn(u),s;if(a){var c=Wn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return Jf(this,s)}}function Jf(u,a){return a&&(Un(a)==="object"||typeof a=="function")?a:Xf(u)}function Xf(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function Qf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Wn(u){return Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Wn(u)}var Zf=et.EventEmitter,ec=_e,Hr=he,tc=qe,Mt=ye(),nc=Xt,Wi=Qe,rc=Ze(),Tn=new ec("Message"),sc=function(u){zf(i,u);var a=Yf(i);function i(r){var s;return Vf(this,i),s=a.call(this),s._ua=r,s._request=null,s._closed=!1,s._direction=null,s._local_identity=null,s._remote_identity=null,s._is_replied=!1,s._data={},s}return Kf(i,[{key:"send",value:function(s,c){var e=this,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},m=s;if(s===void 0||c===void 0)throw new TypeError("Not enough arguments");if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(m));var f=Mt.cloneArray(d.extraHeaders),p=Mt.cloneObject(d.eventHandlers),v=d.contentType||"text/plain",g={};d.fromUserName&&(g.from_uri=new rc("sip",d.fromUserName,this._ua.configuration.uri.host),f.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),d.fromDisplayName&&(g.from_display_name=d.fromDisplayName);for(var S in p)Object.prototype.hasOwnProperty.call(p,S)&&this.on(S,p[S]);f.push("Content-Type: ".concat(v)),this._request=new tc.OutgoingRequest(Hr.MESSAGE,s,this._ua,g,f),c&&(this._request.body=c);var E=new nc(this._ua,this._request,{onRequestTimeout:function(){e._onRequestTimeout()},onTransportError:function(){e._onTransportError()},onReceiveResponse:function(L){e._receiveResponse(L)}});this._newMessage("local",this._request),E.send()}},{key:"init_incoming",value:function(s){this._request=s,this._newMessage("remote",s),this._is_replied||(this._is_replied=!0,s.reply(200)),this._close()}},{key:"accept",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=Mt.cloneArray(s.extraHeaders),e=s.body;if(this._direction!=="incoming")throw new Wi.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,c,e)}},{key:"reject",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.status_code||480,e=s.reason_phrase,d=Mt.cloneArray(s.extraHeaders),m=s.body;if(this._direction!=="incoming")throw new Wi.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(c<300||c>=700)throw new TypeError("Invalid status_code: ".concat(c));this._is_replied=!0,this._request.reply(c,e,d,m)}},{key:"_receiveResponse",value:function(s){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(s.status_code):break;case/^2[0-9]{2}$/.test(s.status_code):this._succeeded("remote",s);break;default:{var c=Mt.sipErrorCause(s.status_code);this._failed("remote",s,c);break}}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,Hr.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,Hr.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(s,c){s==="remote"?(this._direction="incoming",this._local_identity=c.to,this._remote_identity=c.from):s==="local"&&(this._direction="outgoing",this._local_identity=c.from,this._remote_identity=c.to),this._ua.newMessage(this,{originator:s,message:this,request:c})}},{key:"_failed",value:function(s,c,e){Tn.debug("MESSAGE failed"),this._close(),Tn.debug('emit "failed"'),this.emit("failed",{originator:s,response:c||null,cause:e})}},{key:"_succeeded",value:function(s,c){Tn.debug("MESSAGE succeeded"),this._close(),Tn.debug('emit "succeeded"'),this.emit("succeeded",{originator:s,response:c})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}]),i}(Zf);function Mn(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Mn=function(i){return typeof i}:Mn=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Mn(u)}function lc(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function Vi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function ic(u,a,i){return a&&Vi(u.prototype,a),i&&Vi(u,i),u}function ac(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&es(u,a)}function es(u,a){return es=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},es(u,a)}function uc(u){var a=cc();return function(){var r=Vn(u),s;if(a){var c=Vn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return oc(this,s)}}function oc(u,a){return a&&(Mn(a)==="object"||typeof a=="function")?a:fc(u)}function fc(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function cc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Vn(u){return Vn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Vn(u)}var hc=et.EventEmitter,dc=_e,Lr=he,_c=qe,Ht=ye(),pc=Xt,Ki=Qe,Sn=new dc("Options"),vc=function(u){ac(i,u);var a=uc(i);function i(r){var s;return lc(this,i),s=a.call(this),s._ua=r,s._request=null,s._closed=!1,s._direction=null,s._local_identity=null,s._remote_identity=null,s._is_replied=!1,s._data={},s}return ic(i,[{key:"send",value:function(s,c){var e=this,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},m=s;if(s===void 0)throw new TypeError("A target is required for OPTIONS");if(s=this._ua.normalizeTarget(s),!s)throw new TypeError("Invalid target: ".concat(m));var f=Ht.cloneArray(d.extraHeaders),p=Ht.cloneObject(d.eventHandlers),v=d.contentType||"application/sdp";for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&this.on(g,p[g]);f.push("Content-Type: ".concat(v)),this._request=new _c.OutgoingRequest(Lr.OPTIONS,s,this._ua,null,f),c&&(this._request.body=c);var S=new pc(this._ua,this._request,{onRequestTimeout:function(){e._onRequestTimeout()},onTransportError:function(){e._onTransportError()},onReceiveResponse:function(N){e._receiveResponse(N)}});this._newOptions("local",this._request),S.send()}},{key:"init_incoming",value:function(s){this._request=s,this._newOptions("remote",s),this._is_replied||(this._is_replied=!0,s.reply(200)),this._close()}},{key:"accept",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=Ht.cloneArray(s.extraHeaders),e=s.body;if(this._direction!=="incoming")throw new Ki.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,c,e)}},{key:"reject",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.status_code||480,e=s.reason_phrase,d=Ht.cloneArray(s.extraHeaders),m=s.body;if(this._direction!=="incoming")throw new Ki.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(c<300||c>=700)throw new TypeError("Invalid status_code: ".concat(c));this._is_replied=!0,this._request.reply(c,e,d,m)}},{key:"_receiveResponse",value:function(s){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(s.status_code):break;case/^2[0-9]{2}$/.test(s.status_code):this._succeeded("remote",s);break;default:{var c=Ht.sipErrorCause(s.status_code);this._failed("remote",s,c);break}}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,Lr.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,Lr.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newOptions",value:function(s,c){s==="remote"?(this._direction="incoming",this._local_identity=c.to,this._remote_identity=c.from):s==="local"&&(this._direction="outgoing",this._local_identity=c.from,this._remote_identity=c.to),this._ua.newOptions(this,{originator:s,message:this,request:c})}},{key:"_failed",value:function(s,c,e){Sn.debug("OPTIONS failed"),this._close(),Sn.debug('emit "failed"'),this.emit("failed",{originator:s,response:c||null,cause:e})}},{key:"_succeeded",value:function(s,c){Sn.debug("OPTIONS succeeded"),this._close(),Sn.debug('emit "succeeded"'),this.emit("succeeded",{originator:s,response:c})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}]),i}(hc),hs={},mc=_e,Fr=ye(),gc=Pe(),Lt=new mc("Socket");hs.isSocket=function(u){if(Array.isArray(u))return!1;if(typeof u>"u")return Lt.warn("undefined JsSIP.Socket instance"),!1;try{if(!Fr.isString(u.url))throw Lt.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!Fr.isString(u.via_transport))throw Lt.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(gc.parse(u.sip_uri,"SIP_URI")===-1)throw Lt.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch{return!1}try{["connect","disconnect","send"].forEach(function(a){if(!Fr.isFunction(u[a]))throw Lt.warn("missing or invalid JsSIP.Socket method: ".concat(a)),new Error("Missing or invalid JsSIP.Socket method: ".concat(a))})}catch{return!1}return!0};function yc(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function zi(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function Tc(u,a,i){return a&&zi(u.prototype,a),i&&zi(u,i),u}var Sc=_e,Ec=hs,Yi=he,ge=new Sc("Transport"),Ae={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:Yi.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:Yi.CONNECTION_RECOVERY_MAX_INTERVAL}},Cc=function(){function u(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ae.recovery_options;yc(this,u),ge.debug("new()"),this.status=Ae.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=i,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(r){ge.warn("cannot use TextDecoder: ".concat(r))}if(typeof a>"u")throw new TypeError("Invalid argument. undefined 'sockets' argument");a instanceof Array||(a=[a]),a.forEach(function(r){if(!Ec.isSocket(r.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(r.weight&&!Number(r.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:r.socket,weight:r.weight||0,status:Ae.SOCKET_STATUS_READY})},this),this._getSocket()}return Tc(u,[{key:"connect",value:function(){if(ge.debug("connect()"),this.isConnected()){ge.debug("Transport is already connected");return}else if(this.isConnecting()){ge.debug("Transport is connecting");return}this.close_requested=!1,this.status=Ae.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect())}},{key:"disconnect",value:function(){ge.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=Ae.STATUS_DISCONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(i){if(ge.debug("send()"),!this.isConnected())return ge.warn("unable to send message, transport is not connected"),!1;var r=i.toString();return ge.debug(`sending message:

`.concat(r,`
`)),this.socket.send(r)}},{key:"isConnected",value:function(){return this.status===Ae.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===Ae.STATUS_CONNECTING}},{key:"_reconnect",value:function(){var i=this;this.recover_attempts+=1;var r=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);r<this.recovery_options.min_interval?r=this.recovery_options.min_interval:r>this.recovery_options.max_interval&&(r=this.recovery_options.max_interval),ge.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(r," seconds")),this.recovery_timer=setTimeout(function(){!i.close_requested&&!(i.isConnected()||i.isConnecting())&&(i._getSocket(),i.connect())},r*1e3)}},{key:"_getSocket",value:function(){var i=[];if(this.sockets.forEach(function(s){s.status!==Ae.SOCKET_STATUS_ERROR&&(i.length===0?i.push(s):s.weight>i[0].weight?i=[s]:s.weight===i[0].weight&&i.push(s))}),i.length===0){this.sockets.forEach(function(s){s.status=Ae.SOCKET_STATUS_READY}),this._getSocket();return}var r=Math.floor(Math.random()*i.length);this.socket=i[r].socket}},{key:"_onConnect",value:function(){this.recover_attempts=0,this.status=Ae.STATUS_CONNECTED,this.recovery_timer!==null&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(i,r,s){this.status=Ae.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:i,code:r,reason:s}),!this.close_requested&&(this.sockets.forEach(function(c){this.socket===c.socket&&(c.status=Ae.SOCKET_STATUS_ERROR)},this),this._reconnect(i))}},{key:"_onData",value:function(i){if(i===`\r
\r
`){ge.debug("received message with double-CRLF Keep Alive request");try{this.socket.send(`\r
`)}catch(r){ge.warn("error sending Keep Alive response: ".concat(r))}return}if(i===`\r
`){ge.debug("received message with CRLF Keep Alive response");return}else if(typeof i!="string"){try{this.textDecoder?i=this.textDecoder.decode(i):i=String.fromCharCode.apply(null,new Uint8Array(i))}catch{ge.debug("received binary message failed to be converted into string, message discarded");return}ge.debug(`received binary message:

`.concat(i,`
`))}else ge.debug(`received text message:

`.concat(i,`
`));this.ondata({transport:this,message:i})}},{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}}]),u}(),Ia={};function Ji(u,a){var i;if(typeof Symbol>"u"||u[Symbol.iterator]==null){if(Array.isArray(u)||(i=bc(u))||a&&u&&typeof u.length=="number"){i&&(u=i);var r=0,s=function(){};return{s,n:function(){return r>=u.length?{done:!0}:{done:!1,value:u[r++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,e=!1,d;return{s:function(){i=u[Symbol.iterator]()},n:function(){var f=i.next();return c=f.done,f},e:function(f){e=!0,d=f},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(e)throw d}}}}function bc(u,a){if(u){if(typeof u=="string")return Xi(u,a);var i=Object.prototype.toString.call(u).slice(8,-1);if(i==="Object"&&u.constructor&&(i=u.constructor.name),i==="Map"||i==="Set")return Array.from(u);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Xi(u,a)}}function Xi(u,a){(a==null||a>u.length)&&(a=u.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=u[i];return r}var Ac=_e,ts=Pe(),ns=qe,En=new Ac("Parser");Ia.parseMessage=function(u,a){var i,r,s=u.indexOf(`\r
`);if(s===-1){En.warn("parseMessage() | no CRLF found, not a SIP message");return}var c=u.substring(0,s),e=ts.parse(c,"Request_Response");if(e===-1){En.warn('parseMessage() | error parsing first line of SIP message: "'.concat(c,'"'));return}else e.status_code?(i=new ns.IncomingResponse,i.status_code=e.status_code,i.reason_phrase=e.reason_phrase):(i=new ns.IncomingRequest(a),i.method=e.method,i.ruri=e.uri);i.data=u;for(var d=s+2;;){if(s=Rc(u,d),s===-2){r=d+2;break}else if(s===-1){En.warn("parseMessage() | malformed message");return}if(e=wc(i,u,d,s),e!==!0){En.warn("parseMessage() |",e.error);return}d=s+2}if(i.hasHeader("content-length")){var m=i.getHeader("content-length");i.body=u.substr(r,m)}else i.body=u.substring(r);return i};function Rc(u,a){var i=a,r=0,s=0;if(u.substring(i,i+2).match(/(^\r\n)/))return-2;for(;r===0;){if(s=u.indexOf(`\r
`,i),s===-1)return s;!u.substring(s+2,s+4).match(/(^\r\n)/)&&u.charAt(s+2).match(/(^\s+)/)?i=s+2:r=s}return r}function wc(u,a,i,r){var s,c=a.indexOf(":",i),e=a.substring(i,c).trim(),d=a.substring(c+1,r).trim();switch(e.toLowerCase()){case"via":case"v":u.addHeader("via",d),u.getHeaders("via").length===1?(s=u.parseHeader("Via"),s&&(u.via=s,u.via_branch=s.branch)):s=0;break;case"from":case"f":u.setHeader("from",d),s=u.parseHeader("from"),s&&(u.from=s,u.from_tag=s.getParam("tag"));break;case"to":case"t":u.setHeader("to",d),s=u.parseHeader("to"),s&&(u.to=s,u.to_tag=s.getParam("tag"));break;case"record-route":if(s=ts.parse(d,"Record_Route"),s===-1)s=void 0;else{var m=Ji(s),f;try{for(m.s();!(f=m.n()).done;){var p=f.value;u.addHeader("record-route",d.substring(p.possition,p.offset)),u.headers["Record-Route"][u.getHeaders("record-route").length-1].parsed=p.parsed}}catch(E){m.e(E)}finally{m.f()}}break;case"call-id":case"i":u.setHeader("call-id",d),s=u.parseHeader("call-id"),s&&(u.call_id=d);break;case"contact":case"m":if(s=ts.parse(d,"Contact"),s===-1)s=void 0;else{var v=Ji(s),g;try{for(v.s();!(g=v.n()).done;){var S=g.value;u.addHeader("contact",d.substring(S.possition,S.offset)),u.headers.Contact[u.getHeaders("contact").length-1].parsed=S.parsed}}catch(E){v.e(E)}finally{v.f()}}break;case"content-length":case"l":u.setHeader("content-length",d),s=u.parseHeader("content-length");break;case"content-type":case"c":u.setHeader("content-type",d),s=u.parseHeader("content-type");break;case"cseq":u.setHeader("cseq",d),s=u.parseHeader("cseq"),s&&(u.cseq=s.value),u instanceof ns.IncomingResponse&&(u.method=s.method);break;case"max-forwards":u.setHeader("max-forwards",d),s=u.parseHeader("max-forwards");break;case"www-authenticate":u.setHeader("www-authenticate",d),s=u.parseHeader("www-authenticate");break;case"proxy-authenticate":u.setHeader("proxy-authenticate",d),s=u.parseHeader("proxy-authenticate");break;case"session-expires":case"x":u.setHeader("session-expires",d),s=u.parseHeader("session-expires"),s&&(u.session_expires=s.expires,u.session_expires_refresher=s.refresher);break;case"refer-to":case"r":u.setHeader("refer-to",d),s=u.parseHeader("refer-to"),s&&(u.refer_to=s);break;case"replaces":u.setHeader("replaces",d),s=u.parseHeader("replaces"),s&&(u.replaces=s);break;case"event":case"o":u.setHeader("event",d),s=u.parseHeader("event"),s&&(u.event=s);break;default:u.addHeader(e,d),s=0}return s===void 0?{error:'error parsing header "'.concat(e,'"')}:!0}function Hn(u,a){var i;if(typeof Symbol>"u"||u[Symbol.iterator]==null){if(Array.isArray(u)||(i=Ic(u))||a&&u&&typeof u.length=="number"){i&&(u=i);var r=0,s=function(){};return{s,n:function(){return r>=u.length?{done:!0}:{done:!1,value:u[r++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,e=!1,d;return{s:function(){i=u[Symbol.iterator]()},n:function(){var f=i.next();return c=f.done,f},e:function(f){e=!0,d=f},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(e)throw d}}}}function Ic(u,a){if(u){if(typeof u=="string")return Qi(u,a);var i=Object.prototype.toString.call(u).slice(8,-1);if(i==="Object"&&u.constructor&&(i=u.constructor.name),i==="Map"||i==="Set")return Array.from(u);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Qi(u,a)}}function Qi(u,a){(a==null||a>u.length)&&(a=u.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=u[i];return r}var Oc=_e,Oa=he,Zi=qe,ds=ye(),_s=new Oc("sanityCheck"),Nc=[$c],kc=[Pc,Uc,Mc,Hc],Dc=[Lc,Fc],ne,ke,Na,xc=function(u,a,i){ne=u,ke=a,Na=i;var r=Hn(Nc),s;try{for(r.s();!(s=r.n()).done;){var c=s.value;if(c()===!1)return!1}}catch(g){r.e(g)}finally{r.f()}if(ne instanceof Zi.IncomingRequest){var e=Hn(kc),d;try{for(e.s();!(d=e.n()).done;){var m=d.value;if(m()===!1)return!1}}catch(g){e.e(g)}finally{e.f()}}else if(ne instanceof Zi.IncomingResponse){var f=Hn(Dc),p;try{for(f.s();!(p=f.n()).done;){var v=p.value;if(v()===!1)return!1}}catch(g){f.e(g)}finally{f.f()}}return!0};function Pc(){if(ne.s("to").uri.scheme!=="sip")return jt(416),!1}function Uc(){if(!ne.to_tag&&ne.call_id.substr(0,5)===ke.configuration.jssip_id)return jt(482),!1}function Mc(){var u=ds.str_utf8_length(ne.body),a=ne.getHeader("content-length");if(u<a)return jt(400),!1}function Hc(){var u=ne.from_tag,a=ne.call_id,i=ne.cseq,r;if(!ne.to_tag)if(ne.method===Oa.INVITE){if(ke._transactions.ist[ne.via_branch])return!1;for(var s in ke._transactions.ist)if(Object.prototype.hasOwnProperty.call(ke._transactions.ist,s)&&(r=ke._transactions.ist[s],r.request.from_tag===u&&r.request.call_id===a&&r.request.cseq===i))return jt(482),!1}else{if(ke._transactions.nist[ne.via_branch])return!1;for(var c in ke._transactions.nist)if(Object.prototype.hasOwnProperty.call(ke._transactions.nist,c)&&(r=ke._transactions.nist[c],r.request.from_tag===u&&r.request.call_id===a&&r.request.cseq===i))return jt(482),!1}}function Lc(){if(ne.getHeaders("via").length>1)return _s.debug("more than one Via header field present in the response, dropping the response"),!1}function Fc(){var u=ds.str_utf8_length(ne.body),a=ne.getHeader("content-length");if(u<a)return _s.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}function $c(){for(var u=["from","to","call_id","cseq","via"],a=0,i=u;a<i.length;a++){var r=i[a];if(!ne.hasHeader(r))return _s.debug("missing mandatory header field : ".concat(r,", dropping the response")),!1}}function jt(u){var a=ne.getHeaders("via"),i,r="SIP/2.0 ".concat(u," ").concat(Oa.REASON_PHRASE[u],`\r
`),s=Hn(a),c;try{for(s.s();!(c=s.n()).done;){var e=c.value;r+="Via: ".concat(e,`\r
`)}}catch(d){s.e(d)}finally{s.f()}i=ne.getHeader("To"),ne.to_tag||(i+=";tag=".concat(ds.newTag())),r+="To: ".concat(i,`\r
`),r+="From: ".concat(ne.getHeader("From"),`\r
`),r+="Call-ID: ".concat(ne.call_id,`\r
`),r+="CSeq: ".concat(ne.cseq," ").concat(ne.method,`\r
`),r+=`\r
`,Na.send(r)}var ps={};function ea(u,a){var i;if(typeof Symbol>"u"||u[Symbol.iterator]==null){if(Array.isArray(u)||(i=qc(u))||a&&u&&typeof u.length=="number"){i&&(u=i);var r=0,s=function(){};return{s,n:function(){return r>=u.length?{done:!0}:{done:!1,value:u[r++]}},e:function(f){throw f},f:s}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,e=!1,d;return{s:function(){i=u[Symbol.iterator]()},n:function(){var f=i.next();return c=f.done,f},e:function(f){e=!0,d=f},f:function(){try{!c&&i.return!=null&&i.return()}finally{if(e)throw d}}}}function qc(u,a){if(u){if(typeof u=="string")return ta(u,a);var i=Object.prototype.toString.call(u).slice(8,-1);if(i==="Object"&&u.constructor&&(i=u.constructor.name),i==="Map"||i==="Set")return Array.from(u);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ta(u,a)}}function ta(u,a){(a==null||a>u.length)&&(a=u.length);for(var i=0,r=new Array(a);i<a;i++)r[i]=u[i];return r}var yt=ye(),ct=he,$r=Pe(),na=Ze(),qr=hs,jr=Qe;ps.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:ct.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:ct.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:ct.CONNECTION_RECOVERY_MIN_INTERVAL,extra_headers:null,via_host:"".concat(yt.createRandomToken(12),".invalid")};var Cn={mandatory:{sockets:function(a){var i=[];if(qr.isSocket(a))i.push({socket:a});else if(Array.isArray(a)&&a.length){var r=ea(a),s;try{for(r.s();!(s=r.n()).done;){var c=s.value;Object.prototype.hasOwnProperty.call(c,"socket")&&qr.isSocket(c.socket)?i.push(c):qr.isSocket(c)&&i.push({socket:c})}}catch(e){r.e(e)}finally{r.f()}}else return;return i},uri:function(a){/^sip:/i.test(a)||(a="".concat(ct.SIP,":").concat(a));var i=na.parse(a);if(i)return i.user?i:void 0}},optional:{authorization_user:function(a){if($r.parse('"'.concat(a,'"'),"quoted_string")!==-1)return a},authorization_jwt:function(a){if(typeof a=="string")return a},user_agent:function(a){if(typeof a=="string")return a},connection_recovery_max_interval:function(a){if(yt.isDecimal(a)){var i=Number(a);if(i>0)return i}},connection_recovery_min_interval:function(a){if(yt.isDecimal(a)){var i=Number(a);if(i>0)return i}},contact_uri:function(a){if(typeof a=="string"){var i=$r.parse(a,"SIP_URI");if(i!==-1)return i}},display_name:function(a){return a},instance_id:function(a){if(/^uuid:/i.test(a)&&(a=a.substr(5)),$r.parse(a,"uuid")!==-1)return a},no_answer_timeout:function(a){if(yt.isDecimal(a)){var i=Number(a);if(i>0)return i}},session_timers:function(a){if(typeof a=="boolean")return a},session_timers_refresh_method:function(a){if(typeof a=="string"&&(a=a.toUpperCase(),a===ct.INVITE||a===ct.UPDATE))return a},session_timers_force_refresher:function(a){if(typeof a=="boolean")return a},password:function(a){return String(a)},realm:function(a){return String(a)},ha1:function(a){return String(a)},register:function(a){if(typeof a=="boolean")return a},register_expires:function(a){if(yt.isDecimal(a)){var i=Number(a);if(i>0)return i}},registrar_server:function(a){/^sip:/i.test(a)||(a="".concat(ct.SIP,":").concat(a));var i=na.parse(a);if(i)return i.user?void 0:i},use_preloaded_route:function(a){if(typeof a=="boolean")return a},extra_headers:function(a){var i=[];if(Array.isArray(a)&&a.length){var r=ea(a),s;try{for(r.s();!(s=r.n()).done;){var c=s.value;typeof c=="string"&&i.push(c)}}catch(e){r.e(e)}finally{r.f()}}else return;return i}}};ps.load=function(u,a){for(var i in Cn.mandatory)if(a.hasOwnProperty(i)){var r=a[i],s=Cn.mandatory[i](r);if(s!==void 0)u[i]=s;else throw new jr.ConfigurationError(i,r)}else throw new jr.ConfigurationError(i);for(var c in Cn.optional)if(a.hasOwnProperty(c)){var e=a[c];if(yt.isEmpty(e))continue;var d=Cn.optional[c](e);if(d!==void 0)u[c]=d;else throw new jr.ConfigurationError(c,e)}};function Ln(u){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ln=function(i){return typeof i}:Ln=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Ln(u)}function jc(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function ra(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function sa(u,a,i){return a&&ra(u.prototype,a),i&&ra(u,i),u}function Bc(u,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(a&&a.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),a&&rs(u,a)}function rs(u,a){return rs=Object.setPrototypeOf||function(r,s){return r.__proto__=s,r},rs(u,a)}function Gc(u){var a=Vc();return function(){var r=Kn(u),s;if(a){var c=Kn(this).constructor;s=Reflect.construct(r,arguments,c)}else s=r.apply(this,arguments);return Wc(this,s)}}function Wc(u,a){return a&&(Ln(a)==="object"||typeof a=="function")?a:ka(u)}function ka(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function Vc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Kn(u){return Kn=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},Kn(u)}var Kc=et.EventEmitter,zc=_e,pe=he,Yc=Uo,la=Wf,ia=sc,aa=vc,Br=Jt,Jc=Cc,bn=ye(),Xc=Qe,Qc=Ze(),Zc=Ia,Gr=qe,eh=xc,Wr=ps,se=new zc("UA"),ve={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2},th=function(u){Bc(i,u);var a=Gc(i);sa(i,null,[{key:"C",get:function(){return ve}}]);function i(r){var s;if(jc(this,i),se.debug("new() [configuration:%o]",r),s=a.call(this),s._cache={credentials:{}},s._configuration=Object.assign({},Wr.settings),s._dynConfiguration={},s._dialogs={},s._applicants={},s._sessions={},s._transport=null,s._contact=null,s._status=ve.STATUS_INIT,s._error=null,s._transactions={nist:{},nict:{},ist:{},ict:{}},s._data={},s._closeTimer=null,r===void 0)throw new TypeError("Not enough arguments");try{s._loadConfig(r)}catch(c){throw s._status=ve.STATUS_NOT_READY,s._error=ve.CONFIGURATION_ERROR,c}return s._registrator=new Yc(ka(s)),s}return sa(i,[{key:"start",value:function(){se.debug("start()"),this._status===ve.STATUS_INIT?this._transport.connect():this._status===ve.STATUS_USER_CLOSED?(se.debug("restarting UA"),this._closeTimer!==null&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=ve.STATUS_INIT,this._transport.connect()):this._status===ve.STATUS_READY?se.debug("UA is in READY status, not restarted"):se.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){se.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(s){se.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(s)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(s,c){se.debug("call()");var e=new la(this);return e.connect(s,c),e}},{key:"sendMessage",value:function(s,c,e){se.debug("sendMessage()");var d=new ia(this);return d.send(s,c,e),d}},{key:"sendOptions",value:function(s,c,e){se.debug("sendOptions()");var d=new aa(this);return d.send(s,c,e),d}},{key:"terminateSessions",value:function(s){se.debug("terminateSessions()");for(var c in this._sessions)this._sessions[c].isEnded()||this._sessions[c].terminate(s)}},{key:"stop",value:function(){var s=this;if(se.debug("stop()"),this._dynConfiguration={},this._status===ve.STATUS_USER_CLOSED){se.debug("UA already closed");return}this._registrator.close();var c=Object.keys(this._sessions).length;for(var e in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,e)){se.debug("closing session ".concat(e));try{this._sessions[e].terminate()}catch{}}for(var d in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,d))try{this._applicants[d].close()}catch{}this._status=ve.STATUS_USER_CLOSED;var m=Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length;m===0&&c===0?this._transport.disconnect():this._closeTimer=setTimeout(function(){s._closeTimer=null,s._transport.disconnect()},2e3)}},{key:"normalizeTarget",value:function(s){return bn.normalizeTarget(s,this._configuration.hostport_params)}},{key:"get",value:function(s){switch(s){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:se.warn('get() | cannot get "%s" parameter in runtime',s);return}}},{key:"set",value:function(s,c){switch(s){case"authorization_user":{this._configuration.authorization_user=String(c);break}case"password":{this._configuration.password=String(c);break}case"realm":{this._configuration.realm=String(c);break}case"ha1":{this._configuration.ha1=String(c),this._configuration.password=null;break}case"authorization_jwt":{this._configuration.authorization_jwt=String(c);break}case"display_name":{this._configuration.display_name=c;break}case"extra_headers":{this._configuration.extra_headers=c;break}default:return se.warn('set() | cannot set "%s" parameter in runtime',s),!1}return!0}},{key:"newTransaction",value:function(s){this._transactions[s.type][s.id]=s,this.emit("newTransaction",{transaction:s})}},{key:"destroyTransaction",value:function(s){delete this._transactions[s.type][s.id],this.emit("transactionDestroyed",{transaction:s})}},{key:"newDialog",value:function(s){this._dialogs[s.id]=s}},{key:"destroyDialog",value:function(s){delete this._dialogs[s.id]}},{key:"newMessage",value:function(s,c){this._applicants[s]=s,this.emit("newMessage",c)}},{key:"newOptions",value:function(s,c){this._applicants[s]=s,this.emit("newOptions",c)}},{key:"destroyMessage",value:function(s){delete this._applicants[s]}},{key:"newRTCSession",value:function(s,c){this._sessions[s.id]=s,this.emit("newRTCSession",c)}},{key:"destroyRTCSession",value:function(s){delete this._sessions[s.id]}},{key:"registered",value:function(s){this.emit("registered",s)}},{key:"unregistered",value:function(s){this.emit("unregistered",s)}},{key:"registrationFailed",value:function(s){this.emit("registrationFailed",s)}},{key:"receiveRequest",value:function(s){var c=s.method;if(s.ruri.user!==this._configuration.uri.user&&s.ruri.user!==this._contact.uri.user){se.debug("Request-URI does not point to us"),s.method!==pe.ACK&&s.reply_sl(404);return}if(s.ruri.scheme===pe.SIPS){s.reply_sl(416);return}if(!Br.checkTransaction(this,s)){if(c===pe.INVITE?new Br.InviteServerTransaction(this,this._transport,s):c!==pe.ACK&&c!==pe.CANCEL&&new Br.NonInviteServerTransaction(this,this._transport,s),c===pe.OPTIONS){if(this.listeners("newOptions").length===0){s.reply(200);return}var e=new aa(this);e.init_incoming(s)}else if(c===pe.MESSAGE){if(this.listeners("newMessage").length===0){s.reply(405);return}var d=new ia(this);d.init_incoming(s)}else if(c===pe.INVITE&&!s.to_tag&&this.listeners("newRTCSession").length===0){s.reply(405);return}var m,f;if(s.to_tag)m=this._findDialog(s.call_id,s.from_tag,s.to_tag),m?m.receiveRequest(s):c===pe.NOTIFY?(f=this._findSession(s),f?f.receiveRequest(s):(se.debug("received NOTIFY request for a non existent subscription"),s.reply(481,"Subscription does not exist"))):c!==pe.ACK&&s.reply(481);else switch(c){case pe.INVITE:if(window.RTCPeerConnection)if(s.hasHeader("replaces")){var p=s.replaces;m=this._findDialog(p.call_id,p.from_tag,p.to_tag),m?(f=m.owner,f.isEnded()?s.reply(603):f.receiveRequest(s)):s.reply(481)}else f=new la(this),f.init_incoming(s);else se.warn("INVITE received but WebRTC is not supported"),s.reply(488);break;case pe.BYE:s.reply(481);break;case pe.CANCEL:f=this._findSession(s),f?f.receiveRequest(s):se.debug("received CANCEL request for a non existent session");break;case pe.ACK:break;case pe.NOTIFY:this.emit("sipEvent",{event:s.event,request:s}),s.reply(200);break;default:s.reply(405);break}}}},{key:"_findSession",value:function(s){var c=s.call_id,e=s.from_tag,d=s.to_tag,m=c+e,f=this._sessions[m],p=c+d,v=this._sessions[p];return f||v||null}},{key:"_findDialog",value:function(s,c,e){var d=s+c+e,m=this._dialogs[d];return m||(d=s+e+c,m=this._dialogs[d],m||null)}},{key:"_loadConfig",value:function(s){try{Wr.load(this._configuration,s)}catch(p){throw p}this._configuration.display_name===0&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=bn.newUUID()),this._configuration.jssip_id=bn.createRandomToken(5);var c=this._configuration.uri.clone();c.user=null,this._configuration.hostport_params=c.toString().replace(/^sip:/i,"");try{this._transport=new Jc(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=nh.bind(this),this._transport.onconnect=rh.bind(this),this._transport.ondisconnect=sh.bind(this),this._transport.ondata=lh.bind(this)}catch(p){throw se.warn(p),new Xc.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){var e=this._configuration.uri.clone();e.user=null,e.clearParams(),e.clearHeaders(),this._configuration.registrar_server=e}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new Qc("sip",bn.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=v.anonymous||null,S=v.outbound||null,E="<";return g?E+=this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":E+=this.pub_gruu||this.uri.toString(),S&&(g?!this.temp_gruu:!this.pub_gruu)&&(E+=";ob"),E+=">",E}};var d=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register","extra_headers"];for(var m in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,m)&&(d.indexOf(m)!==-1?Object.defineProperty(this._configuration,m,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,m,{writable:!1,configurable:!1}));se.debug("configuration parameters after validation:");for(var f in this._configuration)if(Object.prototype.hasOwnProperty.call(Wr.settings,f))switch(f){case"uri":case"registrar_server":se.debug("- ".concat(f,": ").concat(this._configuration[f]));break;case"password":case"ha1":case"authorization_jwt":se.debug("- ".concat(f,": NOT SHOWN"));break;default:se.debug("- ".concat(f,": ").concat(JSON.stringify(this._configuration[f])))}}},{key:"C",get:function(){return ve}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}}]),i}(Kc);function nh(u){this.emit("connecting",u)}function rh(u){this._status!==ve.STATUS_USER_CLOSED&&(this._status=ve.STATUS_READY,this._error=null,this.emit("connected",u),this._dynConfiguration.register&&this._registrator.register())}function sh(u){for(var a=["nict","ict","nist","ist"],i=0,r=a;i<r.length;i++){var s=r[i];for(var c in this._transactions[s])Object.prototype.hasOwnProperty.call(this._transactions[s],c)&&this._transactions[s][c].onTransportError()}this.emit("disconnected",u),this._registrator.onTransportClosed(),this._status!==ve.STATUS_USER_CLOSED&&(this._status=ve.STATUS_NOT_READY,this._error=ve.NETWORK_ERROR)}function lh(u){var a=u.transport,i=u.message;if(i=Zc.parseMessage(i,this),!!i&&!(this._status===ve.STATUS_USER_CLOSED&&i instanceof Gr.IncomingRequest)&&eh(i,this,a)){if(i instanceof Gr.IncomingRequest)i.transport=a,this.receiveRequest(i);else if(i instanceof Gr.IncomingResponse){var r;switch(i.method){case pe.INVITE:r=this._transactions.ict[i.via_branch],r&&r.receiveResponse(i);break;case pe.ACK:break;default:r=this._transactions.nict[i.via_branch],r&&r.receiveResponse(i);break}}}}function ih(u,a){if(!(u instanceof a))throw new TypeError("Cannot call a class as a function")}function ua(u,a){for(var i=0;i<a.length;i++){var r=a[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(u,r.key,r)}}function ah(u,a,i){return a&&ua(u.prototype,a),i&&ua(u,i),u}var uh=_e,oh=Pe(),Te=new uh("WebSocketInterface"),fh=function(){function u(a){ih(this,u),Te.debug('new() [url:"%s"]',a),this._url=a,this._sip_uri=null,this._via_transport=null,this._ws=null;var i=oh.parse(a,"absoluteURI");if(i===-1)throw Te.warn("invalid WebSocket URI: ".concat(a)),new TypeError("Invalid argument: ".concat(a));if(i.scheme!=="wss"&&i.scheme!=="ws")throw Te.warn("invalid WebSocket URI scheme: ".concat(i.scheme)),new TypeError("Invalid argument: ".concat(a));this._sip_uri="sip:".concat(i.host).concat(i.port?":".concat(i.port):"",";transport=ws"),this._via_transport=i.scheme.toUpperCase()}return ah(u,[{key:"connect",value:function(){if(Te.debug("connect()"),this.isConnected()){Te.debug("WebSocket ".concat(this._url," is already connected"));return}else if(this.isConnecting()){Te.debug("WebSocket ".concat(this._url," is connecting"));return}this._ws&&this.disconnect(),Te.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(i){this._onError(i)}}},{key:"disconnect",value:function(){Te.debug("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(i){return Te.debug("send()"),this.isConnected()?(this._ws.send(i),!0):(Te.warn("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){Te.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}},{key:"_onClose",value:function(i){var r=i.wasClean,s=i.code,c=i.reason;Te.debug("WebSocket ".concat(this._url," closed")),r===!1&&Te.debug("WebSocket abrupt disconnection"),this.ondisconnect(!r,s,c)}},{key:"_onMessage",value:function(i){var r=i.data;Te.debug("received WebSocket message"),this.ondata(r)}},{key:"_onError",value:function(i){Te.warn("WebSocket ".concat(this._url," error: "),i)}},{key:"via_transport",get:function(){return this._via_transport},set:function(i){this._via_transport=i.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}}]),u}(),ss=fa,ch=he,hh=Qe,dh=ye(),_h=th,ph=Ze(),vh=is(),mh=Pe(),gh=fh,yh=us("JsSIP");yh("version %s",ss.version);var Th={C:ch,Exceptions:hh,Utils:dh,UA:_h,URI:ph,NameAddrHeader:vh,WebSocketInterface:gh,Grammar:mh,debug:us,get name(){return ss.title},get version(){return ss.version}};const oa=mu(Th),Sh=()=>{document.getElementById("callList"),[{number:"1234567890",date:"2024-02-19 09:30:00"},{number:"9876543210",date:"2024-02-18 15:45:00"},{number:"5555555555",date:"2024-02-17 11:20:00"}].forEach(a=>{const i=document.createElement("li");i.classList.add("callItem"),i.innerHTML=`
    <div class="number">${a.number}</div>
    <div class="date">${a.date}</div>
  `,i.addEventListener("click",()=>{const r=window.opener.document.getElementById("number");r.value=a.number})})},Eh=u=>{const a=document.querySelector(".hangUpButton"),i=document.querySelector(".contactNumber");i.innerHTML=u,console.log("ua",De),ls.getItem("auth").then(r=>{const s=JSON.parse(r).server;De.call(`sip:${u}@${s}`)}),a.addEventListener("click",()=>{ht("dialer")})},Ch=()=>{const u=document.querySelectorAll(".numberButton"),a=document.getElementById("numberInput"),i=document.querySelector(".dialerCallButton");u.forEach(r=>{r.addEventListener("click",()=>{a.value+=r.innerHTML})}),i.addEventListener("click",()=>{a.value&&ht("currentCall",a.value)})},bh=()=>{const u=document.getElementById("registerForm"),a=document.getElementById("username"),i=document.getElementById("password"),r=document.getElementById("server"),s=document.getElementById("status");u.addEventListener("submit",c=>{c.preventDefault();const e=a.value,d=i.value,m=r.value;e&&d&&m?Da(e,d,m):s.innerHTML="Заполните все поля"})};function An(u,a){fetch(u).then(i=>i.text()).then(i=>{content.innerHTML=i,a&&a()})}const ht=(u,...a)=>{switch(u){case"dialer":An("/dialer.html",()=>Ch(...a));break;case"login":An("/login.html",()=>bh(...a));break;case"callHistory":An("/callHistory.html",()=>Sh(...a));break;case"currentCall":An("/currentCall.html",()=>Eh(...a));break}};let De;const Da=(u,a,i,r)=>{const c={sockets:[new oa.WebSocketInterface(`wss://${i}`)],uri:`sip:${u}@${i}`,password:a};De=new oa.UA(c),De.on("registrationFailed",e=>{console.log("Registration failed",e),r&&r()}),De.on("connected",()=>{console.log("Connected")}),De.on("registered",()=>{console.log("Registered"),ls.setItem("auth",JSON.stringify({username:u,password:a,server:i})),ht("dialer")}),De.on("disconnected",e=>{console.log("disconnected",e)}),De.on("newRTCSession",e=>{console.log("newRTCSession",e)}),De.start(),setTimeout(()=>{const e=De.call("sip:0332739@voip.uiscom.ru",{pcConfig:{hackStripTcp:!0,rtcpMuxPolicy:"negotiate",iceServers:[]},mediaConstraints:{audio:!0,video:!1},rtcOfferConstraints:{offerToReceiveAudio:1,offerToReceiveVideo:0}});console.log("session.connection",e.connection),console.log("session.isEstablished",e.isEstablished()),e.on("connecting",()=>{console.log("Установление соединения...")}),e.on("progress",()=>{console.log("Прогресс звонка...")}),e.on("accepted",()=>{console.log("Звонок принят")}),e.on("failed",d=>{console.error("Ошибка звонка",d)}),e.on("ended",()=>{console.log("Звонок завершен")})},5e3)};document.getElementById("content");const Ah=document.getElementById("dialerBtn"),Rh=document.getElementById("callHistoryBtn");Ah.addEventListener("click",()=>ht("dialer"));Rh.addEventListener("click",()=>ht("callHistory"));ls.getItem("auth").then(u=>{if(!u)ht("login");else{const a=JSON.parse(u);Da(a.username,a.password,a.server,()=>ht("login"))}});
